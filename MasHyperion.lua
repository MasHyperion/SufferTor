-- Obfuscated by Mas (base64 wrapper)
local _b = [[LS0gLy8gU2FrdXJhIEh1YiDwn4y4IFxcIC0tIHwgKFZlcnNpb24gMi4zKSAgQ29udGludWUgYnkgQiZNIDozIA0KDQotLVtbLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICAgVGhpcyBzY3JpcHQgbm90IHVwZGF0ZXMgYSBsb3QsIGRvbid0IFVzZSB0aGlzIGxvYWRzdHJpbmcgdG8gYmUgaW4gdGhlIGxhdGVzdCB2ZXJzaW9uOg0KDQogICAgZ2V0Z2VudigpLlRvZ2dsZVVJID0gIkoiIC0tIC8vICBLZXkgVG9nZ2xlICJKIiBzZXQgYnkgZGVmYXVsdCBob3dldmVyIHlvdSBjYW4gY2hhbmdlIGl0Lg0KICAgIGdldGdlbnYoKS5TYWt1cmFIdWIgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL01hc0h5cGVyaW9uL1N1ZmZlclRvci9yZWZzL2hlYWRzL21haW4vc2FrdXJhLmx1YSI7DQoNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KGdldGdlbnYoKS5TYWt1cmFIdWIpKSgpOw0KICAgIGVuZCkNCl1dLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCmdldGdlbnYoKS5DdXJyZW50VmVyc2lvbiA9ICIwLjIzIjsNCg0KLS0gLy8gQXV0byBMb2FkZXIgXFwgLS0NCnJlcGVhdCB0YXNrLndhaXQoMC4yNSkgdW50aWwgZ2FtZTpJc0xvYWRlZCgpO3Rhc2suc3Bhd24oZnVuY3Rpb24oKSBwY2FsbChmdW5jdGlvbigpIGlmIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpOkZpbmRGaXJzdENoaWxkKCJEclJheSIpIHRoZW4gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXk6RGVzdHJveSgpIGVuZCBlbmQpIGVuZCkNCg0KLS0gLy8gRml4IHNjcmlwdCBjYW5ub3QgcnVuIGJ5IGFub3RoZXIgc2NyaXB0IFxcIC0tDQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQnlvcmwvQnlvcmwtU2NyaXB0LUh1Yi9yZWZzL2hlYWRzL21haW4vU2FrdXJhJTIwU3RhbmQvU2FrdXJhJTIwSHViLmx1YSIpKSgpDQogICAgZW5kKQ0KZW5kKQ0KDQoNCi0tIC8vIEF1dG8gRml4IENhbWVyYSBcXCAtLQ0KdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKWlmIG5vdCBnZXRnZW52KCkuRml4ZWRDYW1lcmEgPT0gdHJ1ZSB0aGVuIGdldGdlbnYoKS5GaXhlZENhbWVyYSA9IHRydWU7DQogICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KDEuNDUpIHVudGlsIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aTpGaW5kRmlyc3RDaGlsZCgiU3RhdHMiKTsNCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmVHdWlFbmFibGVkKEVudW0uQ29yZUd1aVR5cGUuQ2hhdCx0cnVlKTsNCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmVHdWlFbmFibGVkKEVudW0uQ29yZUd1aVR5cGUuUGxheWVyTGlzdCx0cnVlKTsNCiAgICAgICAgICAgIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOnJlbW92ZSgpO3Rhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgICAgIHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNhbWVyYVN1YmplY3QgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIik7DQogICAgICAgICAgICB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DYW1lcmFUeXBlID0gIkN1c3RvbSI7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLk1haW5NZW51OkRlc3Ryb3koKTsNCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DYW1lcmFNaW5ab29tRGlzdGFuY2UgPSAwLjU7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNhbWVyYU1heFpvb21EaXN0YW5jZSA9IDQwMDsNCiAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DYW1lcmFNb2RlID0gIkNsYXNzaWMiO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5BbmNob3JlZCA9IGZhbHNlOw0KICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLkVuYWJsZWQgPSB0cnVlOw0KICAgICAgICAgICAgZ2V0Z2VudigpLkNhbkxvYWRJbnRvU2FrdXJhU3RhbmQgPSB0cnVlOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCi0tIC8vIEFudGkgRmFsbCBGaXhlciBcXCAtLQ0KdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKWlmIG5vdCBnZXRnZW52KCkuQW50aUZhbGxMb2FkZWQgPT0gdHJ1ZSB0aGVuIGdldGdlbnYoKS5BbnRpRmFsbExvYWRlZCA9IHRydWU7DQogICAgICAgIGxvY2FsIEJhc2UxID0gSW5zdGFuY2UubmV3KCJQYXJ0Iik7DQogICAgICAgIEJhc2UxLlNpemUgPSBWZWN0b3IzLm5ldyg5OTk5OTk5OTk5LDE1MCw5OTk5OTk5OTk5KTsNCiAgICAgICAgQmFzZTEuUG9zaXRpb24gPSBWZWN0b3IzLm5ldygtMTIwMDAsLTEzMDAsMTIwMDApOw0KICAgICAgICBCYXNlMS5BbmNob3JlZCA9IHRydWU7QmFzZTEuVHJhbnNwYXJlbmN5ID0gMC41O0Jhc2UxLk5hbWUgPSAiQW50aUZhbGwxIjtCYXNlMS5QYXJlbnQgPSB3b3Jrc3BhY2U7DQogICAgICAgIGxvY2FsIEJhc2UyID0gSW5zdGFuY2UubmV3KCJQYXJ0Iik7DQogICAgICAgIEJhc2UyLlNpemUgPSBWZWN0b3IzLm5ldyg5OTk5OTk5OTk5LDE1MCw5OTk5OTk5OTk5KTsNCiAgICAgICAgQmFzZTIuUG9zaXRpb24gPSBWZWN0b3IzLm5ldygtOTMwNy40MzQ1NzAzMTI1LDExMC4xMDgwNjI3NDQxNDA2LDE0OTUuMTA0NjE0MjU3ODEyNSk7DQogICAgICAgIEJhc2UyLkFuY2hvcmVkID0gdHJ1ZTtCYXNlMi5UcmFuc3BhcmVuY3kgPSAwLjU7QmFzZTIuTmFtZSA9ICJBbnRpRmFsbDIiO0Jhc2UyLlBhcmVudCA9IHdvcmtzcGFjZTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQotLSAvLyBBbnRpIEFGSyBcXCAtLQ0KdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgaWYgbm90IGdldGdlbnYoKS5BbnRpQWZrID09IHRydWUgdGhlbiBnZXRnZW52KCkuQW50aUFmayA9IHRydWU7DQogICAgICAgIHdoaWxlIHRydWUgZG8gdGFzay53YWl0KDExMDApOw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLCJSaWdodEJyYWNrZXQiLGZhbHNlLGdhbWUpOw0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KLS0gLy8gU2V0dGluZ3MgTWFuYWdlciBcXCAtLQ0KZ2V0Z2VudigpLkNvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgLS0gW0dyaW5kaW5nIFNjcmlwdHNdDQogICAgICAgIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9LaWxsTmVhcmVzdE1vYiA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1JvbGxDaWRCYW5uZXIgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9TdGVhbGluZ0l0ZW1zID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvQ29udmVydFRva2VucyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1N0b3JlU3RhZ2VPbmUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CcmVha3Rocm91Z2ggPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9QaWNraW5nSXRlbXMgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9TcGF3bmluZ1RvamkgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9PbmVTaG90dGluZyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1N0ZWFsaW5nT2ZhID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvUm9sYW5kVGhlbWUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9Db21wYXNzVGhlbWUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9TcGF3bmluZ0R1byA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1NwYXduaW5nRGlvID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvTWFpbkZhcm1pbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9SZXNldEljaGlnbyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTIgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b0VxdWlwV2VhcG9uID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvUm9sbERlYXRocyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1JvbGxBcmNhZGUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9TYXZpbmdDYXNoID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvUm9sbEJhbm5lciA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b0JpbmFoVGhlbWUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9BbHRGYXJtaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvTGV2ZWxpbmdVcCA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1Jlc3Bhd25pbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9EZWt1VGhlbWUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9Nb25vdG9uZSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b0NpZFRoZW1lID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvU2FmZVpvbmUgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9SZWJpcnRoID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvU2VsbGluZyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1JhaW5pbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9DbG91ZHkgPSBmYWxzZTsNCg0KICAgICAgICAtLSBbRXhjaGFuZ2UgU2NyaXB0c10NCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CNFQgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CNFAgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CNFMgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CNEMgPSBmYWxzZTsNCg0KICAgICAgICAtLSBbUXVlc3QgU2NyaXB0c10NCiAgICAgICAgZ2V0Z2VudigpLkF1dG9QYXJyeWluZ0RhbWFnZSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b0Jsb2NraW5nRGFtYWdlID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvRGVhbGluZ0RhbWFnZSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b1Rha2luZ0RhbWFnZSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuQXV0b0R5aW5nRGFtYWdlID0gZmFsc2U7DQoNCiAgICAgICAgLS0gW1N0b3JhZ2UgU2NyaXB0c10NCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdBbnlFdmVyeXRoaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nU2luZ3VsYXJpdHkgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdOaWt5dU5pa3l1ID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nRGlvc0RpYXJ5ID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nSW52ZXJ0ZWQgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdEaW9zQm9uZSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuU3RvcmluZ0FyYXNha2EgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdLdWpvSGF0ID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nSG9neW9rdSA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuU3RvcmluZ0NyaW1zb24gPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdDb3J0ZXggPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdGaW5nZXIgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdHbG92ZXMgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdTcGxpdCA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuU3RvcmluZ0dyYWNlID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nQ2hhaW4gPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLlN0b3JpbmdDeWFuID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5TdG9yaW5nVGVjaCA9IGZhbHNlOw0KDQogICAgICAgIC0tIFtGaWdodGluZyBTY3JpcHRzXQ0KICAgICAgICBnZXRnZW52KCkuQXV0b1RlbGVwb3J0UHVuY2hpbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9GdWNraW5nU3lyZW50aWEgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9GdWNraW5nQXVkZHkgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9CbG9ja1dhcm5pbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9BaW1sb2NraW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvR2xpdGNoaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvRGVmZW5kaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvUm9hc3RpbmcgPSBmYWxzZTsNCiAgICAgICAgZ2V0Z2VudigpLkF1dG9EYXNoaW5nID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5BdXRvRG9kZ2luZyA9IGZhbHNlOw0KDQogICAgICAgIC0tIFtNb3ZlbWVudCBTY3JpcHRzXQ0KICAgICAgICBnZXRnZW52KCkuV2Fsa3NwZWVkQnlwYXNzID0gZmFsc2U7DQogICAgICAgIGdldGdlbnYoKS5KdW1wUG93ZXJCeXBhc3MgPSBmYWxzZTsNCg0KICAgICAgICAtLSBbRXNwIFNjcmlwdHNdDQogICAgICAgIGdldGdlbnYoKS5Fc3BFbnRpdGllcyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuRXNwUGxheWVycyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuRXNwTnBjcyA9IGZhbHNlOw0KICAgICAgICBnZXRnZW52KCkuRXNwSXRlbXMgPSBmYWxzZTsNCg0KICAgICAgICAtLSBbU2FrdXJhIEh1YiBVSSBTY3JpcHRzXQ0KICAgICAgICBnZXRnZW52KCkuQXV0b0dvaW5nUmFpbmJvdyA9IGZhbHNlOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5TdGF0aXN0aWNzR1VJLkVuYWJsZWQgPSBmYWxzZTsNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkNvbmZpZ3VyYXRpb25zKCk7DQpyZXBlYXQgdGFzay53YWl0KDAuMzUpIHVudGlsIGdldGdlbnYoKS5DYW5Mb2FkSW50b1Nha3VyYVN0YW5kID09IHRydWUgb3IgZ2FtZS5QbGFjZUlkID09IDE1NTUyMzY3NTQ4Ow0KZm9yIGksdiBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpOkdldENoaWxkcmVuKCkpIGRvIA0KICAgIGlmIHYuTmFtZSA9PSAiT05TVEFSVE1FTlVZRUFIIiB0aGVuIHY6RGVzdHJveSgpOw0KICAgICAgICBnYW1lLkxpZ2h0aW5nLkFtYmllbnQgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDI1NSk7Z2FtZS5MaWdodGluZy5CcmlnaHRuZXNzID0gMC41Ow0KICAgICAgICBnYW1lLkxpZ2h0aW5nLkNvbG9yU2hpZnRfQm90dG9tID0gQ29sb3IzLmZyb21SR0IoMjU1LDI1NSwyNTUpO2dhbWUuTGlnaHRpbmcuQ29sb3JTaGlmdF9Ub3AgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDI1NSk7DQogICAgICAgIGdhbWUuTGlnaHRpbmcuRXhwb3N1cmVDb21wZW5zYXRpb24gPSAwO2dhbWUuTGlnaHRpbmcuRm9nQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDI1NSk7DQogICAgICAgIGdhbWUuTGlnaHRpbmcuRm9nRW5kID0gOTk5OTk5OTk5O2dhbWUuTGlnaHRpbmcuR2VvZ3JhcGhpY0xhdGl0dWRlID0gNDEuNzMzOw0KICAgICAgICBnYW1lLkxpZ2h0aW5nLk91dGRvb3JBbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMjU1LDI1NSwyNTUpO2dhbWUuTGlnaHRpbmcuR2xvYmFsU2hhZG93cyA9IHRydWU7DQogICAgZW5kDQplbmQNCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1bWyBNYWluIFVpIExpYnMgXV0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCmxvY2FsIERyUmF5TGlicmFyeSA9IGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTWFzSHlwZXJpb24vU3VmZmVyVG9yL3JlZnMvaGVhZHMvbWFpbi9EcmF5VUkudHh0IikpKCk7DQpsb2NhbCBCb3JlZExpYnJhcnkgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL01hc0h5cGVyaW9uL1N1ZmZlclRvci9yZWZzL2hlYWRzL21haW4vQm9yZWRVSS50eHQiKSkoKTsNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tW1sgTWFpbiBVaSBMaWJzIF1dLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCmdldGdlbnYoKS5TdGFydExvYWRpbmcgPSBmdW5jdGlvbih6KQ0KICAgIHJldHVybiBmdW5jdGlvbih4KQ0KICAgICAgICByZXR1cm4gZnVuY3Rpb24oKQ0KICAgICAgICAgICAgaWYgZ2V0Z2VudigpW3pdID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgIGlmIHR5cGUoIGdldGdlbnYoKVt4XSkgPT0gImZ1bmN0aW9uIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpW3hdKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KDQpnZXRnZW52KCkuUmVzZXRDb25maWd1cmF0aW9ucyA9IGZ1bmN0aW9uKCkNCiAgICBpZiBpc2ZpbGUoIlNha3VyYV9IdWJfY29uZmlnLnR4dCIpIHRoZW4NCiAgICAgICAgZGVsZmlsZSgiU2FrdXJhX0h1Yl9jb25maWcudHh0Iik7DQogICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIkNvbmZpZ3VyYXRpb25zIERlbGV0ZWQhIiwxLjUpOw0KICAgIGVsc2UNCiAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiDwn4y4IiwiQ29uZmlndXJhdGlvbnMgRG9lc24ndCBFeGlzdC4uLiIsMS41KTsNCiAgICBlbmQNCmVuZA0KDQpnZXRnZW52KCkuU2F2ZUNvbmZpZ3VyYXRpb25zID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIERhdGEgPSAiIjsNCiAgICBmb3IgS2V5LFZhbCBpbiBwYWlycyhnZXRnZW52KCkpIGRvDQogICAgICAgIGlmIHR5cGUoVmFsKSA9PSAiYm9vbGVhbiIgYW5kIEtleSB+PSAiVG9nZ2xlVmlzaWJpbGl0eSIgYW5kIEtleSB+PSAiRXhlY3V0ZWRTdGF0aXN0aWNzR1VJIiB0aGVuDQogICAgICAgICAgICBEYXRhID0gRGF0YS4uS2V5Li4iPSIuLnRvc3RyaW5nKFZhbCkuLiJcbiI7DQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHdyaXRlZmlsZSgiU2FrdXJhX0h1Yl9jb25maWcudHh0IixEYXRhKTsNCiAgICBCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViIPCfjLgiLCJDb25maWd1cmF0aW9ucyBTYXZlZCEiLDEuNSk7DQplbmQNCg0KZ2V0Z2VudigpLkxvYWRDb25maWd1cmF0aW9ucyA9IGZ1bmN0aW9uKCkNCiAgICBpZiBpc2ZpbGUoIlNha3VyYV9IdWJfY29uZmlnLnR4dCIpIHRoZW4NCiAgICAgICAgbG9jYWwgRGF0YSA9IHJlYWRmaWxlKCJTYWt1cmFfSHViX2NvbmZpZy50eHQiKQ0KICAgICAgICBmb3IgTGluZSBpbiBzdHJpbmcuZ21hdGNoKERhdGEsIihbXlxuXSopXG4/IikgZG8NCiAgICAgICAgICAgIGxvY2FsIEtleSxWYWwgPSBzdHJpbmcubWF0Y2goTGluZSwiKFtePV0rKT0oW149XSspIik7DQogICAgICAgICAgICBpZiBLZXkgYW5kIFZhbCB0aGVuDQogICAgICAgICAgICAgICAgZ2V0Z2VudigpW0tleV0gPSAoVmFsID09ICJ0cnVlIik7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIkNvbmZpZ3VyYXRpb25zIExvYWRlZCEiLDEuNSk7DQoNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJXYWxrc3BlZWRCeXBhc3MiKSgiU3VwZXJTcGVlZCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJKdW1wUG93ZXJCeXBhc3MiKSgiU3VwZXJKdW1wIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkVzcFBsYXllcnMiKSgiRXNwT25QbGF5ZXJzIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkVzcEVudGl0aWVzIikoIkVzcE9uRW50aXRpZXMiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiRXNwSXRlbXMiKSgiRXNwT25JdGVtcyIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJFc3BOcGNzIikoIkVzcE9uTnBjcyIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvTW9ub3RvbmUiKSgiQmxhY2tBbmRXaGl0ZSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUmFpbmluZyIpKCJJdHNSYWluaW5nIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9DbG91ZHkiKSgiSXRzQ2xvdWR5IikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9EZWt1VGhlbWUiKSgiQWN0aXZhdGVEZWt1VGhlbWUiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0NvbXBhc3NUaGVtZSIpKCJBY3RpdmF0ZUNvbXBhc3NUaGVtZSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvQmluYWhUaGVtZSIpKCJBY3RpdmF0ZUJpbmFoVGhlbWUiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1JvbGFuZFRoZW1lIikoIkFjdGl2YXRlUm9sYW5kVGhlbWUiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0NpZFRoZW1lIikoIkFjdGl2YXRlQ2lkVGhlbWUiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0FpbWxvY2tpbmciKSgiQWltbG9ja2luZ09uUGxheWVycyIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUm9hc3RpbmciKSgiTW9ja2luZ1BsYXllcnMiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0Z1Y2tpbmdBdWRkeSIpKCJGdWNraW5nQXVkZHlzQmlnR3lhdHQiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0Z1Y2tpbmdTeXJlbnRpYSIpKCJGdWNraW5nU3lyZW50aWFNb3V0aCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvVGVsZXBvcnRQdW5jaGluZyIpKCJUZWxlcG9ydEhpdHRpbmdCZWhpbmQiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1Jlc3Bhd25pbmciKSgiQXV0b0dvZE1vZGRpbmciKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0RlZmVuZGluZyIpKCJEZWZlbmRBZ2FpbnN0TTFzIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9EYXNoaW5nIikoIkRvZGdlRnJvbUF0dGFja3MiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0RvZGdpbmciKSgiVXNpbmdVbHRyYUlzdGluY3QiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0Jsb2NrV2FybmluZyIpKCJBdXRvQmxvY2tpbmdSZWRBdHRhY2tzIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9HbGl0Y2hpbmciKSgiVXNpbmdWb2lkT25PdGhlcnMiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0dvaW5nUmFpbmJvdyIpKCJVc2luZ1JhaW5ib3dVSSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nQW55RXZlcnl0aGluZyIpKCJTdG9yZUV2ZXJ5dGhpbmciKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiU3RvcmluZ05pa3l1TmlreXUiKSgiU3RvcmVOaWt5dSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nRmluZ2VyIikoIlN0b3JlU3VrdW5hIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdJbnZlcnRlZCIpKCJTdG9yZUludmVydGVkIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdTcGxpdCIpKCJTdG9yZVNwbGl0IikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdDaGFpbiIpKCJTdG9yZUNoYWluIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdDb3J0ZXgiKSgiU3RvcmVDb3J0ZXgiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiU3RvcmluZ0NyaW1zb24iKSgiU3RvcmVDcmltc29uIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdDeWFuIikoIlN0b3JlQ3lhbiIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nVGVjaCIpKCJTdG9yZVRlY2giKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiU3RvcmluZ0FyYXNha2EiKSgiU3RvcmVBcmFzYWthIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdLdWpvSGF0IikoIlN0b3JlS3Vqb0hhdCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nRGlvc0JvbmUiKSgiU3RvcmVEaW9zQm9uZSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nRGlvc0RpYXJ5IikoIlN0b3JlRGlvc0RpYXJ5IikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdIb2d5b2t1IikoIlN0b3JlSG9neW9rdSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJTdG9yaW5nR2xvdmVzIikoIlN0b3JlR2xvdmVzIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIlN0b3JpbmdHcmFjZSIpKCJTdG9yZU9BcyIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvTGV2ZWxpbmdVcCIpKCJMZXZlbGluZ1VwIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9TYXZpbmdDYXNoIikoIlNhdmluZ1VwQ2FzaCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUmViaXJ0aCIpKCJSZWJpcnRoaW5nIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9CcmVha3Rocm91Z2giKSgiQnJlYWtpbmdUaHJvdWdoIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9QdWJsaWNHcmluZGluZyIpKCJQdWJsaWNTZXJ2ZXJBdXRvZmFybSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUHJpdmF0ZUdyaW5kaW5nIikoIlByaXZhdGVTZXJ2ZXJBdXRvZmFybSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvU2VsbGluZyIpKCJTZWxsaW5nQW55SXRlbSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvRXF1aXBXZWFwb24iKSgiV2VhcG9uRXF1aXBwZWQiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1Jlc2V0SWNoaWdvIikoIkljaGlnb1Jlc2V0dGVkIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9TdG9yZVN0YWdlT25lIikoIlN0b3JlZE9GQSIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvQWx0RmFybWluZyIpKCJVc2luZ0FsdEZhcm1pbmciKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b01haW5GYXJtaW5nIikoIlVzaW5nTWFpbkFjY291bnRGYXJtaW5nIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9mYXJtT25EZWt1MSIpKCJVc2luZ0Rla3VBdXRvZmFybTEiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b2Zhcm1PbkRla3UyIikoIlVzaW5nRGVrdUF1dG9mYXJtMiIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvZmFybU9uRGVrdTMiKSgiVXNpbmdEZWt1QXV0b2Zhcm0zIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9Db252ZXJ0VG9rZW5zIikoIlVzaW5nVG9rZW5zVG9DYXNoIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9TdGVhbGluZ09mYSIpKCJTdGVhbGluZ09uZUZvckFsbCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvU3RlYWxpbmdJdGVtcyIpKCJTdGVhbGluZ0FueUl0ZW0iKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1BpY2tpbmdJdGVtcyIpKCJQaWNrQXVyYUFueUl0ZW0iKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1NhZmVab25lIikoIlVzaW5nU2FmZVpvbmUiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b09uZVNob3R0aW5nIikoIk9uZVNob3RBbnlCb3NzQW5kTW9iIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9LaWxsTmVhcmVzdE1vYiIpKCJBdXRvZmFybU5lYXJlc3RNb2IiKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b1JvbGxCYW5uZXIiKSgiQmFubmVyUm9sbGluZyIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUm9sbENpZEJhbm5lciIpKCJDaWRCYW5uZXJSb2xsaW5nIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9Sb2xsS2FpanVCYW5uZXIiKSgiS2FpanVCYW5uZXJSb2xsaW5nIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9Sb2xsRGVhdGhzIikoIlJvbGxEZWF0aEJhbm5lciIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvUm9sbEFyY2FkZSIpKCJSb2xsQXJjYWRlQmFubmVyIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9CNFQiKSgiQnJlYWt0aHJvdWdoRm9yVG9rZW4iKSk7DQogICAgICAgIHRhc2suc3Bhd24oZ2V0Z2VudigpLlN0YXJ0TG9hZGluZygiQXV0b0I0UyIpKCJCcmVha3Rocm91Z2hGb3JTdG9yYWdlIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9CNFAiKSgiQnJlYWt0aHJvdWdoRm9yUHJlc2VudCIpKTsNCiAgICAgICAgdGFzay5zcGF3bihnZXRnZW52KCkuU3RhcnRMb2FkaW5nKCJBdXRvQjRDIikoIkJyZWFrdGhyb3VnaEZvckNhcGFjaXR5IikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9QYXJyeWluZ0RhbWFnZSIpKCJRdWVzdFBhcnJ5RGFtYWdlIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9CbG9ja2luZ0RhbWFnZSIpKCJRdWVzdEJsb2NrRGFtYWdlIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9EeWluZ0RhbWFnZSIpKCJRdWVzdERlYXRoRGFtYWdlIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9UYWtpbmdEYW1hZ2UiKSgiUXVlc3RUYWtlRGFtYWdlIikpOw0KICAgICAgICB0YXNrLnNwYXduKGdldGdlbnYoKS5TdGFydExvYWRpbmcoIkF1dG9EZWFsaW5nRGFtYWdlIikoIlF1ZXN0RGVhbERhbWFnZSIpKTsNCiAgICBlbHNlDQogICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIkNvbmZpZ3VyYXRpb25zIE5vdCBGb3VuZC4uLiIsMS41KTsNCiAgICBlbmQNCmVuZA0KDQpnZXRnZW52KCkuU3VwZXJTcGVlZCA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLldhbGtzcGVlZEJ5cGFzcyA9PSB0cnVlIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllciBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGNociA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlcg0KICAgICAgICAgICAgICAgIGlmIGNociB0aGVuDQogICAgICAgICAgICAgICAgICAgbG9jYWwgaHVtID0gY2hyOkZpbmRGaXJzdENoaWxkV2hpY2hJc0EoIkh1bWFub2lkIik7DQogICAgICAgICAgICAgICAgICAgIGlmIGh1bSBhbmQgaHVtLlBhcmVudCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBoYiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLkhlYXJ0YmVhdA0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGVsdGEgPSBoYjpXYWl0KCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGh1bS5Nb3ZlRGlyZWN0aW9uLk1hZ25pdHVkZSA+IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocjpUcmFuc2xhdGVCeShodW0uTW92ZURpcmVjdGlvbiAqIDQgKiBkZWx0YSAqIDQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNocjpUcmFuc2xhdGVCeShodW0uTW92ZURpcmVjdGlvbiAqIGRlbHRhICogNCk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4wMDE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdXBlckp1bXAgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5KdW1wUG93ZXJCeXBhc3MgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpOkdldFN0YXRlKCkgPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5KdW1waW5nIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Sb290UGFydC5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCw2MCwwKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAwMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkVzcE9uUGxheWVycyA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBGb2xkZXIgPSB3b3Jrc3BhY2UuTGl2aW5nDQoNCiAgICBsb2NhbCBmdW5jdGlvbiBDcmVhdGVCaWxib2FyZChYKQ0KICAgICAgICBsb2NhbCBIZWFkID0gWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpOw0KICAgICAgICBpZiBub3QgSGVhZCB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBCaWxsYm9hcmRHdWkgPSBJbnN0YW5jZS5uZXcoIkJpbGxib2FyZEd1aSIpOw0KICAgICAgICBsb2NhbCBUZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpOw0KDQogICAgICAgIEJpbGxib2FyZEd1aS5QYXJlbnQgPSBIZWFkDQogICAgICAgIEJpbGxib2FyZEd1aS5BbHdheXNPblRvcCA9IHRydWUNCiAgICAgICAgQmlsbGJvYXJkR3VpLlNpemUgPSBVRGltMi5uZXcoMCwxMDAsMCw1MCk7DQogICAgICAgIEJpbGxib2FyZEd1aS5TdHVkc09mZnNldCA9IFZlY3RvcjMubmV3KDAsMiwwKTsNCg0KICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gQmlsbGJvYXJkR3VpDQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygxLDEsMSk7DQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLDAsMSwwKTsNCiAgICAgICAgVGV4dExhYmVsLlRleHQgPSBYLk5hbWUNCiAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsMjU1LDApOw0KICAgICAgICBUZXh0TGFiZWwuVGV4dFNjYWxlZCA9IHRydWUNCiAgICAgICAgVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZA0KICAgICAgICBUZXh0TGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDANCiAgICAgICAgVGV4dExhYmVsLlRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLDAsMCk7DQogICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZmFsc2UNCg0KICAgICAgICByZXR1cm4gQmlsbGJvYXJkR3VpLFRleHRMYWJlbA0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gVXNlRVNQKFgpDQogICAgICAgIGxvY2FsIEhlYWQgPSBYOkZpbmRGaXJzdENoaWxkKCJIZWFkIik7DQogICAgICAgIGlmIG5vdCBIZWFkIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGxvY2FsIEJpbGxib2FyZEd1aSxUZXh0TGFiZWwgPSBDcmVhdGVCaWxib2FyZChYKQ0KICAgICAgICBsb2NhbCBSZW5kZXJTdGVwcGVkQ29uDQoNCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gRGlzY29ubmVjdENvbnMoKQ0KICAgICAgICAgICAgaWYgQmlsbGJvYXJkR3VpIHRoZW4NCiAgICAgICAgICAgICAgICBCaWxsYm9hcmRHdWk6RGVzdHJveSgpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBpZiBSZW5kZXJTdGVwcGVkQ29uIHRoZW4NCiAgICAgICAgICAgICAgICBSZW5kZXJTdGVwcGVkQ29uOkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICBSZW5kZXJTdGVwcGVkQ29uID0gbmlsDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQoNCiAgICAgICAgUmVuZGVyU3RlcHBlZENvbiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpDQogICAgICAgICAgICBsb2NhbCBIZWFkUG9zaXRpb24sSGVhZE9uU2NyZWVuID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6V29ybGRUb1ZpZXdwb3J0UG9pbnQoSGVhZC5Qb3NpdGlvbik7DQogICAgICAgICAgICBpZiBIZWFkT25TY3JlZW4gdGhlbg0KICAgICAgICAgICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZ2V0Z2VudigpLkVzcFBsYXllcnMNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVmlzaWJsZSA9IGZhbHNlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KDQogICAgICAgIFguQW5jZXN0cnlDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXyxiKQ0KICAgICAgICAgICAgaWYgbm90IGIgdGhlbg0KICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDb25zKCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gaXNQbGF5ZXIoWCkNCiAgICAgICAgcmV0dXJuIGdhbWUuUGxheWVyczpHZXRQbGF5ZXJGcm9tQ2hhcmFjdGVyKFgpIH49IG5pbA0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gWEFkZGVkKFgpDQogICAgICAgIGlmIGlzUGxheWVyKFgpIGFuZCBYOklzQSgiTW9kZWwiKSBhbmQgWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4NCiAgICAgICAgICAgIFVzZUVTUChYKTsNCiAgICAgICAgZW5kDQogICAgICAgIFguQ2hpbGRBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHYpDQogICAgICAgICAgICBpZiBpc1BsYXllcih2KSBhbmQgdjpJc0EoIk1vZGVsIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgICAgICAgICAgICAgVXNlRVNQKHYpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICBlbmQNCg0KICAgIGZvciBfLFggaW4gaXBhaXJzKEZvbGRlcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICBpZiBpc1BsYXllcihYKSBhbmQgWDpJc0EoIk1vZGVsIikgYW5kIFg6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgICAgICAgICBYQWRkZWQoWCk7DQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgRm9sZGVyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbih2KQ0KICAgICAgICB0YXNrLndhaXQoMC41KTtYQWRkZWQodik7DQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Fc3BPbkVudGl0aWVzID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEZvbGRlciA9IHdvcmtzcGFjZS5MaXZpbmcNCiAgICBsb2NhbCBEdW1taWVzID0geyJBdHRhY2tpbmcgRHVtbXkiLCJEdW1teSIsIkNvdW50ZXIgRHVtbXkiLCJCbG9ja2luZyBEdW1teSIsIlRvdWdoIER1bW15In07DQoNCiAgICBsb2NhbCBmdW5jdGlvbiBDcmVhdGVCaWxib2FyZChYKQ0KICAgICAgICBsb2NhbCBIZWFkID0gWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpOw0KICAgICAgICBpZiBub3QgSGVhZCB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBCaWxsYm9hcmRHdWkgPSBJbnN0YW5jZS5uZXcoIkJpbGxib2FyZEd1aSIpOw0KICAgICAgICBsb2NhbCBUZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpOw0KDQogICAgICAgIEJpbGxib2FyZEd1aS5QYXJlbnQgPSBIZWFkDQogICAgICAgIEJpbGxib2FyZEd1aS5BbHdheXNPblRvcCA9IHRydWUNCiAgICAgICAgQmlsbGJvYXJkR3VpLlNpemUgPSBVRGltMi5uZXcoMCwxMDAsMCw1MCk7DQogICAgICAgIEJpbGxib2FyZEd1aS5TdHVkc09mZnNldCA9IFZlY3RvcjMubmV3KDAsMiwwKTsNCg0KICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gQmlsbGJvYXJkR3VpDQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygxLDEsMSk7DQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLDAsMSwwKTsNCiAgICAgICAgVGV4dExhYmVsLlRleHQgPSBYLk5hbWUNCiAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsMCwwKTsNCiAgICAgICAgVGV4dExhYmVsLlRleHRTY2FsZWQgPSB0cnVlDQogICAgICAgIFRleHRMYWJlbC5Gb250ID0gRW51bS5Gb250LkdvdGhhbUJvbGQNCiAgICAgICAgVGV4dExhYmVsLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwDQogICAgICAgIFRleHRMYWJlbC5UZXh0U3Ryb2tlQ29sb3IzID0gQ29sb3IzLmZyb21SR0IoMCwwLDApOw0KICAgICAgICBUZXh0TGFiZWwuVmlzaWJsZSA9IGZhbHNlDQoNCiAgICAgICAgcmV0dXJuIEJpbGxib2FyZEd1aSxUZXh0TGFiZWwNCiAgICBlbmQNCg0KICAgIGxvY2FsIGZ1bmN0aW9uIFVzZUVTUChYKQ0KICAgICAgICBsb2NhbCBIZWFkID0gWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpOw0KICAgICAgICBpZiBub3QgSGVhZCB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBCaWxsYm9hcmRHdWksVGV4dExhYmVsID0gQ3JlYXRlQmlsYm9hcmQoWCkNCiAgICAgICAgbG9jYWwgUmVuZGVyU3RlcHBlZENvbg0KDQogICAgICAgIGxvY2FsIGZ1bmN0aW9uIERpc2Nvbm5lY3RDb25zKCkNCiAgICAgICAgICAgIGlmIEJpbGxib2FyZEd1aSB0aGVuDQogICAgICAgICAgICAgICAgQmlsbGJvYXJkR3VpOkRlc3Ryb3koKTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgaWYgUmVuZGVyU3RlcHBlZENvbiB0aGVuDQogICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZENvbjpEaXNjb25uZWN0KCk7DQogICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZENvbiA9IG5pbA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KDQogICAgICAgIFJlbmRlclN0ZXBwZWRDb24gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgbG9jYWwgSGVhZFBvc2l0aW9uLEhlYWRPblNjcmVlbiA9IHdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOldvcmxkVG9WaWV3cG9ydFBvaW50KEhlYWQuUG9zaXRpb24pOw0KICAgICAgICAgICAgaWYgSGVhZE9uU2NyZWVuIHRoZW4NCiAgICAgICAgICAgICAgICBUZXh0TGFiZWwuVmlzaWJsZSA9IGdldGdlbnYoKS5Fc3BFbnRpdGllcw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZmFsc2UNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQoNCiAgICAgICAgWC5BbmNlc3RyeUNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihfLGIpDQogICAgICAgICAgICBpZiBub3QgYiB0aGVuDQogICAgICAgICAgICAgICAgRGlzY29ubmVjdENvbnMoKTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQogICAgZW5kDQoNCiAgICBsb2NhbCBmdW5jdGlvbiBpc1BsYXllcihYKQ0KICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWUuUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvDQogICAgICAgICAgICBpZiBYLk5hbWUgPT0gay5OYW1lIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICBlbmQNCg0KICAgIGxvY2FsIGZ1bmN0aW9uIGlzRHVtbXkoWCkNCiAgICAgICAgZm9yIF8sbSBpbiBwYWlycyhEdW1taWVzKSBkbw0KICAgICAgICAgICAgaWYgWC5OYW1lID09IG0gdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gWEFkZGVkKFgpDQogICAgICAgIGlmIG5vdCBpc1BsYXllcihYKSBhbmQgbm90IGlzRHVtbXkoWCkgYW5kIFg6SXNBKCJNb2RlbCIpIGFuZCBYOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbg0KICAgICAgICAgICAgVXNlRVNQKFgpOw0KICAgICAgICBlbmQNCiAgICAgICAgWC5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24odikNCiAgICAgICAgICAgIGlmIG5vdCBpc1BsYXllcih2KSBhbmQgbm90IGlzRHVtbXkodikgYW5kIHY6SXNBKCJNb2RlbCIpIGFuZCB2OkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbg0KICAgICAgICAgICAgICAgIFVzZUVTUCh2KTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQogICAgZW5kDQoNCiAgICBmb3IgXyxYIGluIGlwYWlycyhGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgbm90IGlzUGxheWVyKFgpIGFuZCBub3QgaXNEdW1teShYKSBhbmQgWDpJc0EoIk1vZGVsIikgYW5kIFg6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgICAgICAgICBYQWRkZWQoWCk7DQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgRm9sZGVyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbih2KQ0KICAgICAgICB0YXNrLndhaXQoMC41KTtYQWRkZWQodik7DQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Fc3BPbkl0ZW1zID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEZvbGRlciA9IHt3b3Jrc3BhY2UuSXRlbSx3b3Jrc3BhY2UuSXRlbTJ9Ow0KICAgIGxvY2FsIENhc3VhbCA9IHsiQm94IiwiQ2hlc3QiLCJCYXJyZWwifTsNCiAgICANCiAgICBsb2NhbCBmdW5jdGlvbiBDcmVhdGVCaWxsYm9hcmQoWCxDb2xvcikNCiAgICAgICAgbG9jYWwgQmlsbGJvYXJkR3VpID0gSW5zdGFuY2UubmV3KCJCaWxsYm9hcmRHdWkiKTsNCiAgICAgICAgbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKTsNCiAgICANCiAgICAgICAgQmlsbGJvYXJkR3VpLlBhcmVudCA9IFgNCiAgICAgICAgQmlsbGJvYXJkR3VpLkFsd2F5c09uVG9wID0gdHJ1ZQ0KICAgICAgICBCaWxsYm9hcmRHdWkuU2l6ZSA9IFVEaW0yLm5ldygwLDEwMCwwLDUwKTsNCiAgICAgICAgQmlsbGJvYXJkR3VpLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwyLDApOw0KICAgIA0KICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gQmlsbGJvYXJkR3VpDQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLDAsMSwwKTsNCiAgICAgICAgVGV4dExhYmVsLlRleHQgPSBYLk5hbWUNCiAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcg0KICAgICAgICBUZXh0TGFiZWwuVGV4dFNjYWxlZCA9IHRydWUNCiAgICAgICAgVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZA0KICAgICAgICBUZXh0TGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDANCiAgICAgICAgVGV4dExhYmVsLlRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLDAsMCk7DQogICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZmFsc2UNCiAgICANCiAgICAgICAgcmV0dXJuIEJpbGxib2FyZEd1aSxUZXh0TGFiZWwNCiAgICBlbmQNCiAgICANCiAgICBsb2NhbCBmdW5jdGlvbiBTaG91bGRJZ25vcmUoWCkNCiAgICAgICAgcmV0dXJuIFguTmFtZSA9PSAiU291bFNwYXduIiBvciBYLlBvc2l0aW9uID09IFZlY3RvcjMubmV3KDE4MDQuNTM5MDYyNSwtMjk4LjE3MzU4Mzk4NDM3NSwtMzA5LjQ2NDk2NTgyMDMxMjUpOw0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGZ1bmN0aW9uIFVzZUVTUChYKQ0KICAgICAgICBpZiBTaG91bGRJZ25vcmUoWCkgdGhlbg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICBsb2NhbCBDb2xvciA9IHRhYmxlLmZpbmQoQ2FzdWFsLFguTmFtZSkgYW5kIENvbG9yMy5mcm9tUkdCKDI1NSwyNTUsMjU1KSBvciBDb2xvcjMuZnJvbVJHQigwLDI1NSwwKTsNCiAgICAgICAgbG9jYWwgQmlsbGJvYXJkR3VpLFRleHRMYWJlbCA9IENyZWF0ZUJpbGxib2FyZChYLENvbG9yKTsNCiAgICAgICAgbG9jYWwgUmVuZGVyU3RlcHBlZENvbg0KICAgIA0KICAgICAgICBsb2NhbCBmdW5jdGlvbiBEaXNjb25uZWN0Q29ucygpDQogICAgICAgICAgICBpZiBCaWxsYm9hcmRHdWkgdGhlbg0KICAgICAgICAgICAgICAgIEJpbGxib2FyZEd1aTpEZXN0cm95KCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGlmIFJlbmRlclN0ZXBwZWRDb24gdGhlbg0KICAgICAgICAgICAgICAgIFJlbmRlclN0ZXBwZWRDb246RGlzY29ubmVjdCgpOw0KICAgICAgICAgICAgICAgIFJlbmRlclN0ZXBwZWRDb24gPSBuaWwNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICANCiAgICAgICAgUmVuZGVyU3RlcHBlZENvbiA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpDQogICAgICAgICAgICBsb2NhbCBIZWFkUG9zaXRpb24sSGVhZE9uU2NyZWVuID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6V29ybGRUb1ZpZXdwb3J0UG9pbnQoWC5Qb3NpdGlvbik7DQogICAgICAgICAgICBpZiBIZWFkT25TY3JlZW4gdGhlbg0KICAgICAgICAgICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZ2V0Z2VudigpLkVzcEl0ZW1zDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlZpc2libGUgPSBmYWxzZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICANCiAgICAgICAgWC5BbmNlc3RyeUNoYW5nZWQ6Q29ubmVjdChmdW5jdGlvbihiKQ0KICAgICAgICAgICAgaWYgbm90IGIgdGhlbg0KICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDb25zKCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGZ1bmN0aW9uIFhBZGRlZChYKQ0KICAgICAgICBpZiBYOklzQSgiQmFzZVBhcnQiKSB0aGVuDQogICAgICAgICAgICBVc2VFU1AoWCk7DQogICAgICAgIGVuZA0KICAgICAgICBYLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbih2KQ0KICAgICAgICAgICAgaWYgdjpJc0EoIkJhc2VQYXJ0IikgdGhlbg0KICAgICAgICAgICAgICAgIFVzZUVTUCh2KTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQogICAgZW5kDQogICAgDQogICAgZm9yIF8sWCBpbiBpcGFpcnMoRm9sZGVyKSBkbw0KICAgICAgICBmb3IgXyxYIGluIGlwYWlycyhYOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICBpZiBYOklzQSgiQmFzZVBhcnQiKSB0aGVuDQogICAgICAgICAgICAgICAgaWYgbm90IFNob3VsZElnbm9yZShYKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIFhBZGRlZChYKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICANCiAgICAgICAgWC5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24odikNCiAgICAgICAgICAgIGlmIHY6SXNBKCJCYXNlUGFydCIpIGFuZCBub3QgU2hvdWxkSWdub3JlKHYpIHRoZW4NCiAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KTtYQWRkZWQodik7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KICAgIGVuZA0KZW5kDQoNCmdldGdlbnYoKS5Fc3BPbk5wY3MgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgRm9sZGVyID0gd29ya3NwYWNlLk1hcC5OUENzDQoNCiAgICBsb2NhbCBmdW5jdGlvbiBDcmVhdGVCaWxib2FyZChYKQ0KICAgICAgICBsb2NhbCBIZWFkID0gWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpOw0KICAgICAgICBpZiBub3QgSGVhZCB0aGVuIHJldHVybiBlbmQNCiAgICANCiAgICAgICAgbG9jYWwgQmlsbGJvYXJkR3VpID0gSW5zdGFuY2UubmV3KCJCaWxsYm9hcmRHdWkiKTsNCiAgICAgICAgbG9jYWwgVGV4dExhYmVsID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiKTsNCiAgICANCiAgICAgICAgQmlsbGJvYXJkR3VpLlBhcmVudCA9IEhlYWQNCiAgICAgICAgQmlsbGJvYXJkR3VpLkFsd2F5c09uVG9wID0gdHJ1ZQ0KICAgICAgICBCaWxsYm9hcmRHdWkuU2l6ZSA9IFVEaW0yLm5ldygwLDEwMCwwLDUwKTsNCiAgICAgICAgQmlsbGJvYXJkR3VpLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwyLDApOw0KICAgIA0KICAgICAgICBUZXh0TGFiZWwuUGFyZW50ID0gQmlsbGJvYXJkR3VpDQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygxLDEsMSk7DQogICAgICAgIFRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgICAgICBUZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygxLDAsMSwwKTsNCiAgICAgICAgVGV4dExhYmVsLlRleHQgPSBYLk5hbWUNCiAgICAgICAgVGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLDI1NSwyNTUpOw0KICAgICAgICBUZXh0TGFiZWwuVGV4dFNjYWxlZCA9IHRydWUNCiAgICAgICAgVGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZA0KICAgICAgICBUZXh0TGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDANCiAgICAgICAgVGV4dExhYmVsLlRleHRTdHJva2VDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLDAsMCk7DQogICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZmFsc2UNCiAgICANCiAgICAgICAgcmV0dXJuIEJpbGxib2FyZEd1aSxUZXh0TGFiZWwNCiAgICBlbmQNCiAgICANCiAgICBsb2NhbCBmdW5jdGlvbiBVc2VFU1AoWCkNCiAgICAgICAgbG9jYWwgSGVhZCA9IFg6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKTsNCiAgICAgICAgaWYgbm90IEhlYWQgdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgICAgIGxvY2FsIEJpbGxib2FyZEd1aSxUZXh0TGFiZWwgPSBDcmVhdGVCaWxib2FyZChYKQ0KICAgICAgICBsb2NhbCBSZW5kZXJTdGVwcGVkQ29uDQogICAgDQogICAgICAgIGxvY2FsIGZ1bmN0aW9uIERpc2Nvbm5lY3RDb25zKCkNCiAgICAgICAgICAgIGlmIEJpbGxib2FyZEd1aSB0aGVuDQogICAgICAgICAgICAgICAgQmlsbGJvYXJkR3VpOkRlc3Ryb3koKTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgaWYgUmVuZGVyU3RlcHBlZENvbiB0aGVuDQogICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZENvbjpEaXNjb25uZWN0KCk7DQogICAgICAgICAgICAgICAgUmVuZGVyU3RlcHBlZENvbiA9IG5pbA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICBSZW5kZXJTdGVwcGVkQ29uID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIGxvY2FsIEhlYWRQb3NpdGlvbixIZWFkT25TY3JlZW4gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludChIZWFkLlBvc2l0aW9uKTsNCiAgICAgICAgICAgIGlmIEhlYWRPblNjcmVlbiB0aGVuDQogICAgICAgICAgICAgICAgVGV4dExhYmVsLlZpc2libGUgPSBnZXRnZW52KCkuRXNwTnBjcw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIFRleHRMYWJlbC5WaXNpYmxlID0gZmFsc2UNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQogICAgDQogICAgICAgIFguQW5jZXN0cnlDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXyxiKQ0KICAgICAgICAgICAgaWYgbm90IGIgdGhlbg0KICAgICAgICAgICAgICAgIERpc2Nvbm5lY3RDb25zKCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGZ1bmN0aW9uIGlzUGxheWVyKFgpDQogICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZS5QbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8NCiAgICAgICAgICAgIGlmIFguTmFtZSA9PSBrLk5hbWUgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIHJldHVybiBmYWxzZQ0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGZ1bmN0aW9uIFhBZGRlZChYKQ0KICAgICAgICBpZiBub3QgaXNQbGF5ZXIoWCkgYW5kIFg6SXNBKCJNb2RlbCIpIGFuZCBYOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbg0KICAgICAgICAgICAgVXNlRVNQKFgpOw0KICAgICAgICBlbmQNCiAgICAgICAgWC5DaGlsZEFkZGVkOkNvbm5lY3QoZnVuY3Rpb24odikNCiAgICAgICAgICAgIGlmIG5vdCBpc1BsYXllcih2KSBhbmQgdjpJc0EoIk1vZGVsIikgYW5kIHY6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgICAgICAgICAgICAgVXNlRVNQKHYpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICBlbmQNCiAgICANCiAgICBmb3IgXyxYIGluIGlwYWlycyhGb2xkZXI6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgbm90IGlzUGxheWVyKFgpIGFuZCBYOklzQSgiTW9kZWwiKSBhbmQgWDpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4NCiAgICAgICAgICAgIFhBZGRlZChYKTsNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgDQogICAgRm9sZGVyLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbih2KQ0KICAgICAgICB0YXNrLndhaXQoMC41KTtYQWRkZWQodik7DQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5CbGFja0FuZFdoaXRlID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b01vbm90b25lID09IHRydWUgdGhlbg0KICAgICAgICAgICAgd29ya3NwYWNlLk1vbm90b25lLlZhbHVlID0gdHJ1ZTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgd29ya3NwYWNlLk1vbm90b25lLlZhbHVlID0gZmFsc2U7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuSXRzUmFpbmluZyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9SYWluaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgd29ya3NwYWNlLlJhaW5pbmcuVmFsdWUgPSB0cnVlOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICB3b3Jrc3BhY2UuUmFpbmluZy5WYWx1ZSA9IGZhbHNlOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkl0c0Nsb3VkeSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9DbG91ZHkgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICB3b3Jrc3BhY2UuQ2xvdWR5LlZhbHVlID0gdHJ1ZTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgd29ya3NwYWNlLkNsb3VkeS5WYWx1ZSA9IGZhbHNlOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkFjdGl2YXRlQ29tcGFzc1RoZW1lID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0NvbXBhc3NUaGVtZSA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIFN1a3VuYVRoZW1lID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTM2OTMwMDc0MTAxNjgxIg0KICAgICAgICAgICAgbG9jYWwgU291bmQgPSBJbnN0YW5jZS5uZXcoIlNvdW5kIik7U291bmQuTmFtZSA9ICJTb3VuZCI7U291bmQuU291bmRJZCA9IFN1a3VuYVRoZW1lDQogICAgICAgICAgICBTb3VuZC5Wb2x1bWUgPSA1O1NvdW5kLkxvb3BlZCA9IHRydWU7U291bmQuQXJjaGl2YWJsZSA9IGZhbHNlO1NvdW5kLlBhcmVudCA9IGdhbWUuV29ya3NwYWNlO1NvdW5kOlBsYXkoKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgZm9yIGksdiBpbiBpcGFpcnMod29ya3NwYWNlOmNoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgaWYgdjppc0EoIlNvdW5kIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICB2OkRlc3Ryb3koKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkFjdGl2YXRlRGVrdVRoZW1lID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0Rla3VUaGVtZSA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIERla3VUaGVtZSA9ICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTEzMDA2OTM5NTI4Ig0KICAgICAgICAgICAgbG9jYWwgU291bmQgPSBJbnN0YW5jZS5uZXcoIlNvdW5kIik7U291bmQuTmFtZSA9ICJTb3VuZCI7U291bmQuU291bmRJZCA9IERla3VUaGVtZQ0KICAgICAgICAgICAgU291bmQuVm9sdW1lID0gMTA7U291bmQuTG9vcGVkID0gdHJ1ZTtTb3VuZC5BcmNoaXZhYmxlID0gZmFsc2U7U291bmQuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2U7U291bmQ6UGxheSgpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBmb3IgaSx2IGluIGlwYWlycyh3b3Jrc3BhY2U6Y2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICBpZiB2OmlzQSgiU291bmQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQWN0aXZhdGVCaW5haFRoZW1lID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b0JpbmFoVGhlbWUgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICBsb2NhbCBCaW5haFRoZW1lID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTgyNDg2MjExNzUiDQogICAgICAgICAgICBsb2NhbCBTb3VuZCA9IEluc3RhbmNlLm5ldygiU291bmQiKTtTb3VuZC5OYW1lID0gIlNvdW5kIjtTb3VuZC5Tb3VuZElkID0gQmluYWhUaGVtZQ0KICAgICAgICAgICAgU291bmQuVm9sdW1lID0gNTtTb3VuZC5Mb29wZWQgPSB0cnVlO1NvdW5kLkFyY2hpdmFibGUgPSBmYWxzZTtTb3VuZC5QYXJlbnQgPSBnYW1lLldvcmtzcGFjZTtTb3VuZDpQbGF5KCk7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGZvciBpLHYgaW4gaXBhaXJzKHdvcmtzcGFjZTpjaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgIGlmIHY6aXNBKCJTb3VuZCIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgdjpEZXN0cm95KCk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5BY3RpdmF0ZVJvbGFuZFRoZW1lID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1JvbGFuZFRoZW1lID09IHRydWUgdGhlbg0KICAgICAgICAgICAgbG9jYWwgUm9sYW5kVGhlbWUgPSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0xNzEwNTkzOTE3NyINCiAgICAgICAgICAgIGxvY2FsIFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpO1NvdW5kLk5hbWUgPSAiU291bmQiO1NvdW5kLlNvdW5kSWQgPSBSb2xhbmRUaGVtZQ0KICAgICAgICAgICAgU291bmQuVm9sdW1lID0gMTA7U291bmQuTG9vcGVkID0gdHJ1ZTtTb3VuZC5BcmNoaXZhYmxlID0gZmFsc2U7U291bmQuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2U7U291bmQ6UGxheSgpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBmb3IgaSx2IGluIGlwYWlycyh3b3Jrc3BhY2U6Y2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICBpZiB2OmlzQSgiU291bmQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQWN0aXZhdGVDaWRUaGVtZSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9DaWRUaGVtZSA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIENpZFRoZW1lID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTUyNjI3ODIwNDYiDQogICAgICAgICAgICBsb2NhbCBTb3VuZCA9IEluc3RhbmNlLm5ldygiU291bmQiKTtTb3VuZC5OYW1lID0gIlNvdW5kIjtTb3VuZC5Tb3VuZElkID0gQ2lkVGhlbWUNCiAgICAgICAgICAgIFNvdW5kLlZvbHVtZSA9IDU7U291bmQuTG9vcGVkID0gdHJ1ZTtTb3VuZC5BcmNoaXZhYmxlID0gZmFsc2U7U291bmQuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2U7U291bmQ6UGxheSgpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICBmb3IgaSx2IGluIGlwYWlycyh3b3Jrc3BhY2U6Y2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICBpZiB2OmlzQSgiU291bmQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQWltbG9ja2luZ09uUGxheWVycyA9IGZ1bmN0aW9uKCkNCiAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKSBpZiBub3QgZ2V0Z2VudigpLkF1dG9BaW1sb2NraW5nID09IHRydWUgdGhlbiByZXR1cm4gZW5kIGxvY2FsIHgsYiBmb3IgXyx2IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKTpHZXRQbGF5ZXJzKCkpIGRvIGlmIHYuQ2hhcmFjdGVyIGFuZCB2IH49IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyIHRoZW4gaWYgbm90IHggb3IgKHYuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24gLSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbikuTWFnbml0dWRlIDwgYiB0aGVuIHggPSB2IGIgPSAodi5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbiAtIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uKS5NYWduaXR1ZGUgZW5kIGVuZCBlbmQgaWYgeCBhbmQgYiA8PSAzNSB0aGVuIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ3VycmVudENhbWVyYS5DRnJhbWUgPSBDRnJhbWUubmV3KGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuQ3VycmVudENhbWVyYS5DRnJhbWUucCx4LkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKSBlbmQgZW5kKTsNCmVuZA0KDQpnZXRnZW52KCkuTW9ja2luZ1BsYXllcnMgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgQW50YWdvbml6ZUxpc3QgPSB7DQogICAgICAgICJLZWVwIGR5aW5nLCBpdCdzIGFtdXNpbmciLA0KICAgICAgICAiQmV0dGVyIGx1Y2sgbmV4dCB0aW1lIiwNCiAgICAgICAgIlRoYXQgd2FzIGVtYmFycmFzc2luZyIsDQogICAgICAgICJDYW4ndCBoYW5kbGUgdGhlIHByZXNzdXJlPyIsDQogICAgICAgICJZb3UgY2FsbCB0aGF0IHBsYXlpbmc/IiwNCiAgICAgICAgIkdvIGNyeSB0byB5b3VyIG1vbW15IiwNCiAgICAgICAgIkhvdydzIHRoZSB2aWV3IGZyb20gZG93biB0aGVyZT8iLA0KICAgICAgICAiWW91J3JlIG1ha2luZyB0aGlzIHRvbyBlYXN5IiwNCiAgICAgICAgIkRpZCB5b3UgZm9yZ2V0IGhvdyB0byBwbGF5PyIsDQogICAgICAgICJJcyB0aGF0IGFsbCB5b3UndmUgZ290PyIsDQogICAgICAgICJJJ3ZlIHNlZW4gYmV0dGVyLiIsDQogICAgICAgICJZb3UncmUgYSBkaXNncmFjZSIsDQogICAgICAgICJXaHkgYXJlIHlvdSBldmVuIHBsYXlpbmc/IiwNCiAgICAgICAgIkp1c3QgdW5pbnN0YWxsLiIsDQogICAgICAgICJZb3UncmUgc28gYmFkIGl0J3MgZnVubnkiLA0KICAgICAgICAiSSdtIG5vdCBldmVuIHRyeWluZy4iLA0KICAgICAgICAiU3RvcCBlbWJhcnJhc3NpbmcgeW91cnNlbGYuIiwNCiAgICAgICAgIllvdSdyZSBhIGpva2UiLA0KICAgICAgICAiVHJ5IGhhcmRlciBuZXh0IHRpbWUuIiwNCiAgICAgICAgIkhvdydzIHRoZSB0YXN0ZSBvZiBkZWZlYXQ/IiwNCiAgICAgICAgIkRvIHlvdSBldmVuIHBsYXkgdGhpcyBnYW1lPyIsDQogICAgICAgICJZb3UgbXVzdCBiZSBuZXcgaGVyZS4iLA0KICAgICAgICAiSnVzdCBzdG9wIHRyeWluZy4iLA0KICAgICAgICAiSSdtIGp1c3QgdG95aW5nIHdpdGggeW91LiIsDQogICAgICAgICJUaGF0IHdhcyBwYWluZnVsIHRvIHdhdGNoLiIsDQogICAgICAgICJJcyB0aGlzIHlvdXIgZmlyc3QgdGltZSBwbGF5aW5nPyIsDQogICAgICAgICJZb3UncmUgb3V0Y2xhc3NlZC4iLA0KICAgICAgICAiRGlkIHNvbWVvbmUgZm9yZ2V0IHRoZWlyIHNraWxscz8iLA0KICAgICAgICAiTWF5YmUgZ2FtZXMgYXJlbid0IGZvciB5b3UuIiwNCiAgICAgICAgIlRoaXMgaXMgZW1iYXJyYXNzaW5nIGZvciB5b3UuIiwNCiAgICAgICAgIktlZXAgZHJlYW1pbmcgb2YgdmljdG9yeS4iLA0KICAgICAgICAiSSdtIHlhd25pbmcgb3ZlciBoZXJlLiIsDQogICAgICAgICJZb3UgbWFrZSB0aGlzIHRvbyBlYXN5LiIsDQogICAgICAgICJZb3UncmUgbm90IGV2ZW4gd29ydGggbXkgdGltZS4iLA0KICAgICAgICAiSSd2ZSBzZWVuIHRvZGRsZXJzIHBsYXkgYmV0dGVyLiIsDQogICAgICAgICJZb3UncmUgYSByZXNwYXduIG1hY2hpbmUiLA0KICAgICAgICAiRGlkIHlvdSBwYXkgdG8gYmUgdGhpcyBiYWQ/IiwNCiAgICAgICAgIllvdSdyZSB0aGUgbGF1Z2hpbmdzdG9jayBvZiB0aGUgc2VydmVyLiIsDQogICAgICAgICJFdmVuIGJvdHMgYXJlIGJldHRlciB0aGFuIHlvdS4iLA0KICAgICAgICAiSXQncyBsaWtlIHlvdSdyZSBwbGF5aW5nIGJsaW5kZm9sZGVkLiIsDQogICAgICAgICJNYXliZSBnYW1pbmcgaXNuJ3QgeW91ciB0aGluZy4iLA0KICAgICAgICAiQXJlIHlvdSBhbGxlcmdpYyB0byB3aW5uaW5nPyIsDQogICAgICAgICJJJ20gaGF2aW5nIGEgcGljbmljIHdoaWxlIHlvdSByZXNwYXduLiIsDQogICAgICAgICJJJ3ZlIHNlZW4gbW9yZSBza2lsbCBpbiBhIHBvdGF0by4iLA0KICAgICAgICAiVGhpcyBpcyB0aGUgc2FkZGVzdCBnYW1lcGxheSBJJ3ZlIHNlZW4uIiwNCiAgICAgICAgIkRpZCB5b3UgZG93bmxvYWQgeW91ciBza2lsbHMgZnJvbSB0aGUgaW50ZXJuZXQ/IiwNCiAgICAgICAgIkFyZSB5b3UgcGxheWluZyB3aXRoIHlvdXIgZXllcyBjbG9zZWQ/IiwNCiAgICAgICAgIkRpZCB5b3VyIG1vbSBpbnN0YWxsIHRoZSBnYW1lIGZvciB5b3U/IiwNCiAgICAgICAgIllvdSBzaG91bGQgY2hhbmdlIHlvdXIgbmFtZSB0byAnRmVlZGVyJy4iLA0KICAgICAgICAiSSBiZXQgeW91IHRoaW5rIHlvdSdyZSBnb29kIGF0IHRoaXMgZ2FtZS4iLA0KICAgICAgICAiSSBjb3VsZCBwbGF5IGJsaW5kZm9sZGVkIGFuZCBzdGlsbCB3aW4uIiwNCiAgICAgICAgIkFyZSB5b3UgaW50ZW50aW9uYWxseSB0cnlpbmcgdG8gbG9zZT8iLA0KICAgICAgICAiWW91J3JlIGEgcHJvZmVzc2lvbmFsIHJlc3Bhd24gYnV0dG9uIHByZXNzZXIuIiwNCiAgICAgICAgIllvdXIgZ2FtZXBsYXkgaXMgYSBjb21lZHkgc2hvdy4iLA0KICAgICAgICAiRG8geW91IG5lZWQgYSBHUFMgdG8gZmluZCB0aGUgJ0xlYXZlJyBidXR0b24/IiwNCiAgICAgICAgIkV2ZW4gdGhlIE5QQ3MgcGxheSBiZXR0ZXIgdGhhbiB5b3UuIiwNCiAgICAgICAgIkRvIHlvdSBoYXZlIGEgc3RyYXRlZ3kgb3IganVzdCBwcmVzc2luZyBidXR0b25zIHJhbmRvbWx5PyIsDQogICAgICAgICJZb3UgbXVzdCBiZSBhbGxlcmdpYyB0byB2aWN0b3J5LiIsDQogICAgICAgICJJIGNvdWxkIGdvIG1ha2UgYSBzYW5kd2ljaCBhbmQgc3RpbGwgd2luIGFnYWluc3QgeW91LiIsDQogICAgICAgICJBcmUgeW91IHRyeWluZyB0byBzZXQgYSB3b3JsZCByZWNvcmQgZm9yIG1vc3QgZGVhdGhzIGluIGEgbWludXRlPyIsDQogICAgICAgICJZb3VyIGdhbWVwbGF5IGlzIGEgdHV0b3JpYWwgb24gaG93IG5vdCB0byBwbGF5LiIsDQogICAgICAgICJJIGJldCB5b3UncmUgcHJvdWQgb2YgdGhhdCBkZWF0aCBzdHJlYWsuIiwNCiAgICAgICAgIlRoaXMgaXMgbGlrZSB3YXRjaGluZyBhIGNhciBjcmFzaCBpbiBzbG93IG1vdGlvbiwgYnV0IGxlc3MgZW50ZXJ0YWluaW5nLiIsDQogICAgICAgICJEbyB5b3UgbmVlZCBtZSB0byBjYWxsIHRlY2ggc3VwcG9ydCBmb3IgeW91PyIsDQogICAgICAgICJJIHRoaW5rIHlvdSBuZWVkIHRvIHJlc3RhcnQgeW91ciBnYW1pbmcgY2FyZWVyLiIsDQogICAgICAgICJJJ20gbm90IHN1cmUgd2hhdCdzIHdvcnNlLCB5b3VyIGdhbWVwbGF5IG9yIHlvdXIgZXhjdXNlcy4iLA0KICAgICAgICAiRXZlbiBteSBwZXQgY291bGQgcGxheSBiZXR0ZXIgdGhhbiB5b3UuIiwNCiAgICAgICAgIllvdSdyZSBsaWtlIGEgbXlzdGVyeSBib3guLi4gZnVsbCBvZiBkaXNhcHBvaW50bWVudHMuIiwNCiAgICAgICAgIkkndmUgc2VlbiBtb3JlIGNoYWxsZW5nZSBpbiBhIGdhbWUgb2YgY2hlY2tlcnMuIiwNCiAgICAgICAgIkRpZCB5b3UgcmVhZCB0aGUgaW5zdHJ1Y3Rpb25zPyBPaCB3YWl0LCB5b3UgZGlkbid0LiIsDQogICAgICAgICJJIGJldCB5b3UgdGhpbmsgZHlpbmcgaXMgYW4gYWNoaWV2ZW1lbnQuIiwNCiAgICAgICAgIllvdXIgZ2FtZXBsYXkgbWFrZXMgbWUgcXVlc3Rpb24gdGhlIG1lYW5pbmcgb2YgY29tcGV0aXRpb24uIiwNCiAgICAgICAgIllvdSdyZSBsaWtlIGEgbGVnZW5kLi4uIGluIGR5aW5nLiIsDQogICAgICAgICJEbyB5b3UgdGhpbmsgZHlpbmcgaXMgYSB0YWN0aWM/IiwNCiAgICAgICAgIkknbSBzdXJwcmlzZWQgeW91IGhhdmVuJ3QgcmFnZSBxdWl0IHlldC4iLA0KICAgICAgICAiWW91J3JlIGxpa2UgYSBtYXN0ZXIgYXQgZHlpbmcuLi4gYW5kIG5vdGhpbmcgZWxzZS4iLA0KICAgICAgICAiSSdtIHdpbm5pbmcgc28gaGFyZCwgaXQncyBhbG1vc3QgdW5mYWlyIHRvIHlvdS4iLA0KICAgIH0NCiAgICANCiAgICBsb2NhbCBMUGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyDQogICAgbG9jYWwgQ1Jvb3QNCiAgICANCiAgICBsb2NhbCBmdW5jdGlvbiBVcGRhdGVDUm9vdCgpDQogICAgICAgIGxvY2FsIExDaGFyID0gTFBsYXllci5DaGFyYWN0ZXINCiAgICAgICAgaWYgTENoYXIgdGhlbg0KICAgICAgICAgICAgQ1Jvb3QgPSBMQ2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgaWYgbm90IENSb290IHRoZW4NCiAgICAgICAgICAgICAgICBMQ2hhci5DaGlsZEFkZGVkOldhaXQoKTsNCiAgICAgICAgICAgICAgICBDUm9vdCA9IExDaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gaXNQbGF5ZXIoWCkNCiAgICAgICAgcmV0dXJuIGdhbWUuUGxheWVyczpHZXRQbGF5ZXJGcm9tQ2hhcmFjdGVyKFgpIH49IG5pbA0KICAgIGVuZA0KICAgIA0KICAgIGxvY2FsIGZ1bmN0aW9uIEZpbmROZWFyZXN0KCkNCiAgICAgICAgbG9jYWwgRGlzdCA9IDQ1DQogICAgICAgIGxvY2FsIE5lYXJlc3RQbHIgPSBuaWwNCiAgICANCiAgICAgICAgZm9yIF8sdiBpbiBwYWlycyhnYW1lLldvcmtzcGFjZS5MaXZpbmc6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgIGlmIGlzUGxheWVyKHYpIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBIdW1hbm9pZCA9IHY6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpOw0KICAgICAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkUm9vdCA9IHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKTsNCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgSHVtYW5vaWQgYW5kIEh1bWFub2lkUm9vdCBhbmQgdiB+PSBMUGxheWVyLkNoYXJhY3RlciB0aGVuDQogICAgICAgICAgICAgICAgICAgIGlmIEh1bWFub2lkLkhlYWx0aCA9PSAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE1hZyA9IChDUm9vdC5Qb3NpdGlvbiAtIEh1bWFub2lkUm9vdC5Qb3NpdGlvbikubWFnbml0dWRlDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBNYWcgPCBEaXN0IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXN0ID0gTWFnDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTmVhcmVzdFBsciA9IEh1bWFub2lkUm9vdA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICByZXR1cm4gTmVhcmVzdFBscg0KICAgIGVuZA0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUm9hc3RpbmcgPT0gdHJ1ZSAgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKClVcGRhdGVDUm9vdCgpOw0KICAgICAgICAgICAgICAgIGlmIENSb290IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgRm91bmQgPSBGaW5kTmVhcmVzdCgpOw0KICAgICAgICAgICAgICAgICAgICBpZiBGb3VuZCB0aGVuICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IEFudGFnb25pemVMaXN0W21hdGgucmFuZG9tKDEsI0FudGFnb25pemVMaXN0KV0sIkFsbCJ9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiRGVmYXVsdENoYXRTeXN0ZW1DaGF0RXZlbnRzIik6V2FpdEZvckNoaWxkKCJTYXlNZXNzYWdlUmVxdWVzdCIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMyk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICBMUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICB0YXNrLndhaXQoMyk7VXBkYXRlQ1Jvb3QoKTsNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlRlbGVwb3J0SGl0dGluZ0JlaGluZCA9IGZ1bmN0aW9uKCkNCiAgICBnZXRnZW52KCkuRGV0ZWN0aW9uRGlzdGFuY2UgPSA1NQ0KICAgIGdldGdlbnYoKS5UZWxlcG9ydERpc3RhbmNlID0gNQ0KDQogICAgbG9jYWwgTFBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcg0KICAgIGxvY2FsIENSb290DQoNCiAgICBsb2NhbCBmdW5jdGlvbiBVcGRhdGVDUm9vdCgpDQogICAgICAgIGxvY2FsIExDaGFyID0gTFBsYXllci5DaGFyYWN0ZXINCiAgICAgICAgaWYgTENoYXIgdGhlbg0KICAgICAgICAgICAgQ1Jvb3QgPSBMQ2hhcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgaWYgbm90IENSb290IHRoZW4NCiAgICAgICAgICAgICAgICBMQ2hhci5DaGlsZEFkZGVkOldhaXQoKTsNCiAgICAgICAgICAgICAgICBDUm9vdCA9IExDaGFyOldhaXRGb3JDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgbG9jYWwgZnVuY3Rpb24gRmluZE5lYXJlc3QoKQ0KICAgICAgICBsb2NhbCBEaXN0ID0gZ2V0Z2VudigpLkRldGVjdGlvbkRpc3RhbmNlDQogICAgICAgIGxvY2FsIE5lYXJlc3RQbHIgPSBuaWwNCg0KICAgICAgICBmb3IgXyx2IGluIHBhaXJzKGdhbWUuV29ya3NwYWNlLkxpdmluZzpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgbG9jYWwgSHVtYW5vaWQgPSB2OkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKTsNCiAgICAgICAgICAgIGxvY2FsIEh1bWFub2lkUm9vdCA9IHY6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKTsNCg0KICAgICAgICAgICAgaWYgSHVtYW5vaWQgYW5kIEh1bWFub2lkUm9vdCBhbmQgdiB+PSBMUGxheWVyLkNoYXJhY3RlciB0aGVuDQogICAgICAgICAgICAgICAgaWYgSHVtYW5vaWQuSGVhbHRoID4gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIE1hZyA9IChDUm9vdC5Qb3NpdGlvbiAtIEh1bWFub2lkUm9vdC5Qb3NpdGlvbikubWFnbml0dWRlDQogICAgICAgICAgICAgICAgICAgIGlmIE1hZyA8IERpc3QgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgRGlzdCA9IE1hZw0KICAgICAgICAgICAgICAgICAgICAgICAgTmVhcmVzdFBsciA9IEh1bWFub2lkUm9vdA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICByZXR1cm4gTmVhcmVzdFBscg0KICAgIGVuZA0KDQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKHQsaikNCiAgICAgICAgaWYgbm90IGogYW5kIHQuVXNlcklucHV0VHlwZSA9PSBFbnVtLlVzZXJJbnB1dFR5cGUuTW91c2VCdXR0b24xIHRoZW4NCiAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpOklzS2V5RG93bihFbnVtLktleUNvZGUuTGVmdENvbnRyb2wpIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1RlbGVwb3J0UHVuY2hpbmcgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKClVcGRhdGVDUm9vdCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgQ1Jvb3QgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIEZvdW5kID0gRmluZE5lYXJlc3QoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBGb3VuZCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFRhcmdldCA9IEZvdW5kLlBvc2l0aW9uICsgLUZvdW5kLkNGcmFtZS5Mb29rVmVjdG9yICogZ2V0Z2VudigpLlRlbGVwb3J0RGlzdGFuY2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTFBsYXllci5DaGFyYWN0ZXI6U2V0UHJpbWFyeVBhcnRDRnJhbWUoQ0ZyYW1lLm5ldyhUYXJnZXQsVGFyZ2V0ICsgKEZvdW5kLlBvc2l0aW9uIC0gVGFyZ2V0KS51bml0KSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIExQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbigpDQogICAgICAgIHRhc2sud2FpdCgzKTtVcGRhdGVDUm9vdCgpOw0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQXV0b0dvZE1vZGRpbmcgPSBmdW5jdGlvbigpDQogICAgZ2V0Z2VudigpLkhlYWx0aFJlc3Bhd24gPSAxOTU7DQogICAgZ2V0Z2VudigpLkd1aWxkTmFtZSA9ICJTemVjaHVhbiI7DQogICAgZ2V0Z2VudigpLlBhc3N3b3JkID0gInBlcHBlciI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9SZXNwYXduaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyDQogICAgICAgICAgICAgICAgaWYgTHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoIDwgZ2V0Z2VudigpLkhlYWx0aFJlc3Bhd24gdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBMb2NhdGlvbiA9IExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIEd1aWxkID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoTHBsYXllci5OYW1lKS5IZWFkOkZpbmRGaXJzdENoaWxkKCJHdWlsZEdVSSIpOw0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9IEd1aWxkIGFuZCBHdWlsZC5UZXh0LlRleHQgPT0gZ2V0Z2VudigpLkd1aWxkTmFtZSBhbmQgIkxlYXZlIiBvciAiSm9pbiIsWzJdID0gZ2V0Z2VudigpLkd1aWxkTmFtZSxbM10gPSBnZXRnZW52KCkuUGFzc3dvcmQsWzRdID0gIiJ9Ow0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJHbG9iYWxVc2VkUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiU2V0R3VpbGQiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgDQogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXJBZGRlZDpXYWl0KCk7DQogICAgDQogICAgICAgICAgICAgICAgICAgIHJlcGVhdCB0YXNrLndhaXQoMC4wMTUpIHVudGlsIExwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0Iik7dGFzay53YWl0KDAuMzUpOw0KICAgIA0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IExvY2F0aW9uOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMDAxNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuRGVmZW5kQWdhaW5zdE0xcyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgY29ubmVjdGlvbg0KICAgICAgICBjb25uZWN0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRGVmZW5kaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMod29ya3NwYWNlLkxpdmluZzpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgazpJc0EoIk1vZGVsIikgYW5kIGs6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSBhbmQgay5IZWFkOklzQSgiUGFydCIpIGFuZCBrLkhlYWQuTmFtZSA9PSAiSGVhZCIgYW5kIGsuSGVhZCB+PSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrLkhlYWQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSAxNSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpIGFuZCBrOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKS5IZWFsdGggPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIkxNQl9Db29sZG93biIpIGFuZCBub3Qgay5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiUG9zaW5nIikgYW5kIG5vdCBrLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJCbG9ja2luZyIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gay5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCwwLDUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbFVzZXIiKTpCdXR0b24xRG93bihWZWN0b3IyLm5ldygpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgY29ubmVjdGlvbjpEaXNjb25uZWN0KCk7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kKQ0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuRG9kZ2VGcm9tQXR0YWNrcyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgY29ubmVjdGlvbg0KICAgICAgICBjb25uZWN0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvRGFzaGluZyA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gaXBhaXJzKHdvcmtzcGFjZS5MaXZpbmc6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJNb2RlbCIpIGFuZCBrOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgYW5kIGsuSGVhZDpJc0EoIlBhcnQiKSBhbmQgay5IZWFkLk5hbWUgPT0gIkhlYWQiIGFuZCBrLkhlYWQgfj0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoay5IZWFkLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gMTUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBrOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKSBhbmQgazpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIikuSGVhbHRoID4gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBrLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJPbkNvb2xkb3duIikgYW5kIG5vdCB3b3Jrc3BhY2UuTGl2aW5nW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lXS5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiT25Db29sZG93biIpIGFuZCBub3Qgay5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiUG9zaW5nIikgYW5kIG5vdCBrLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJCbG9ja2luZyIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJEIixbMl0gPSBWZWN0b3IzLm5ldygwLDAsMCl9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJEYXNoIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOyAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlVzaW5nVWx0cmFJc3RpbmN0ID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEF1cmEgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIGZ1bmN0aW9uIHYwKHYyLHYzLHY0LHY1LHY2LHY3LHY4LHY5LHYxMCx2MTEsdjEyKWxvY2FsIHYxMz1JbnN0YW5jZS5uZXcoIlBhcnRpY2xlRW1pdHRlciIpO3YxMy5QYXJlbnQ9djY7djEzLlRleHR1cmU9djI7djEzLkRyYWc9MDt2MTMuTG9ja2VkVG9QYXJ0PXRydWU7djEzLlJhdGU9djEyO3YxMy5MaWZldGltZT1OdW1iZXJSYW5nZS5uZXcodjExLHYxMSk7djEzLkxpZ2h0RW1pc3Npb249djQ7djEzLkxpZ2h0SW5mbHVlbmNlPXY1O3YxMy5TcGVlZD1OdW1iZXJSYW5nZS5uZXcodjksdjkpO3YxMy5Sb3RhdGlvbj1OdW1iZXJSYW5nZS5uZXcodjEwLHYxMCk7djEzLkNvbG9yPUNvbG9yU2VxdWVuY2UubmV3KHYzKTtsb2NhbCB2MjU9e051bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDAsdjcpLE51bWJlclNlcXVlbmNlS2V5cG9pbnQubmV3KDEsMCl9O3YxMy5TaXplPU51bWJlclNlcXVlbmNlLm5ldyh2MjUpO3YxMy5TcHJlYWRBbmdsZT1WZWN0b3IyLm5ldyh2OCx2OCk7ZW5kIGxvY2FsIGZ1bmN0aW9uIHYxKHYyOClmb3IgdjI5LHYzMCBpbiBwYWlycyh2Mjg6R2V0RGVzY2VuZGFudHMoKSkgZG8gaWYgKHYzMDpJc0EoIkJhc2VQYXJ0IikgYW5kICh2MzAuTmFtZX49Ikh1bWFub2lkUm9vdFBhcnQiKSkgdGhlbiB2MCgicmJ4YXNzZXRpZDovLzEzMzYyODM5NTUiLENvbG9yMy5mcm9tUkdCKDYwLDYwLDYwKSwxLDAsdjMwLDEsOTAsMCw2MCwwLjUsNTApO3YwKCJyYnhhc3NldGlkOi8vMTM2ODQ4NTE4OCIsQ29sb3IzLmZyb21SR0IoMjU1LDI1NSwyNTUpLDEsMCx2MzAsMC41LDMwLDAuNSwtMTAsMiwxKTtlbmQgZW5kIGVuZCB2MShnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyKTsNCiAgICBlbmQNCg0KICAgIGxvY2FsIFVuYXVyYSA9IGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gdjAodjEpaWYgdjE6SXNBKCJQYXJ0aWNsZUVtaXR0ZXIiKSB0aGVuIHYxOkRlc3Ryb3koKTtlbmQgZm9yIHY0LHY1IGluIGlwYWlycyh2MTpHZXRDaGlsZHJlbigpKSBkbyB2MCh2NSk7ZW5kIGVuZCBmb3IgdjIsdjMgaW4gaXBhaXJzKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6R2V0RGVzY2VuZGFudHMoKSkgZG8gaWYgdjM6SXNBKCJCYXNlUGFydCIpIHRoZW4gdjAodjMpO2VuZCBlbmQNCiAgICBlbmQNCiAgICANCiAgICBsb2NhbCBTb3VuZE9OID0gZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCB2MD1JbnN0YW5jZS5uZXcoIlNvdW5kIik7djAuTmFtZT0iU291bmQiO3YwLlNvdW5kSWQ9Imh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTY3NzA5NDIxOSI7djAuVm9sdW1lPTc7djAuTG9vcGVkPXRydWU7djAuYXJjaGl2YWJsZT1mYWxzZTt2MC5QYXJlbnQ9Z2FtZS5Xb3Jrc3BhY2U7aWYgKGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoPjEwKSB0aGVuIHYwOlBsYXkoKTtlbmQNCiAgICBlbmQNCiAgICANCiAgICBsb2NhbCBTb3VuZE9GRiA9IGZ1bmN0aW9uKCkNCiAgICAgICAgZm9yIHYwLHYxIGluIHBhaXJzKHdvcmtzcGFjZTpjaGlsZHJlbigpKSBkbyBpZiB2MTppc0EoIlNvdW5kIikgdGhlbiB2MTpEZXN0cm95KCk7ZW5kIGVuZA0KICAgIGVuZA0KDQogICAgaWYgZ2V0Z2VudigpLkF1dG9Eb2RnaW5nID09IHRydWUgdGhlbg0KICAgICAgICBsb2NhbCBFbnRyYW5jZVRoZW1lID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTIxNjM0Mzc4NyI7DQogICAgICAgIGxvY2FsIFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpO1NvdW5kLk5hbWUgPSAiU291bmQiO1NvdW5kLlNvdW5kSWQgPSBFbnRyYW5jZVRoZW1lDQogICAgICAgIFNvdW5kLlZvbHVtZSA9IDEwO1NvdW5kLkxvb3BlZCA9IGZhbHNlO1NvdW5kLkFyY2hpdmFibGUgPSBmYWxzZTtTb3VuZC5QYXJlbnQgPSBnYW1lLldvcmtzcGFjZTtTb3VuZDpQbGF5KCk7DQogICAgICAgIHdvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdOkZpbmRGaXJzdENoaWxkKCJBbmltYXRlIikuaWRsZS5BbmltYXRpb24xLkFuaW1hdGlvbklkID0gInJieGFzc2V0aWQ6Ly8xMjUxMjQyMTQ4MCI7DQogICAgICAgIEF1cmEoKTtTb3VuZE9OKCk7DQogICAgZWxzZQ0KICAgICAgICBVbmF1cmEoKTtTb3VuZE9GRigpOw0KICAgIGVuZA0KDQogICAgbG9jYWwgQ29ubmVjDQogICAgQ29ubmVjID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3RlckFkZGVkOkNvbm5lY3QoZnVuY3Rpb24oKXRhc2sud2FpdCgzKTsNCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9Eb2RnaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgQXVyYSgpO3dvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdOkZpbmRGaXJzdENoaWxkKCJBbmltYXRlIikuaWRsZS5BbmltYXRpb24xLkFuaW1hdGlvbklkID0gInJieGFzc2V0aWQ6Ly8xMjUxMjQyMTQ4MCI7DQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIFVuYXVyYSgpO1NvdW5kT0ZGKCk7Q29uOkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBjb25uZWN0aW9uDQogICAgICAgIGNvbm5lY3Rpb24gPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9Eb2RnaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMod29ya3NwYWNlLkxpdmluZzpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgazpJc0EoIk1vZGVsIikgYW5kIGs6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSBhbmQgay5IZWFkOklzQSgiUGFydCIpIGFuZCBrLkhlYWQuTmFtZSA9PSAiSGVhZCIgYW5kIGsuSGVhZCB+PSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrLkhlYWQuUG9zaXRpb24gLSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuUG9zaXRpb24pLm1hZ25pdHVkZSA8PSA1NSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpIGFuZCBrOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKS5IZWFsdGggPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIk9uQ29vbGRvd24iKSBhbmQgbm90IHdvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJPbkNvb2xkb3duIikgYW5kIG5vdCBrLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJQb3NpbmciKSBhbmQgbm90IGsuQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIkJsb2NraW5nIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBrLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLDQ1LDI1KTt3b3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUgPSBrLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLDEwLDI1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEb2RnZUFuaW1hdGlvbiA9IEluc3RhbmNlLm5ldygiQW5pbWF0aW9uIik7RG9kZ2VBbmltYXRpb24uQW5pbWF0aW9uSWQgPSAicmJ4YXNzZXRpZDovLzEyMTQ2NzU3MzUwIiBsb2NhbCBrID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpMb2FkQW5pbWF0aW9uKERvZGdlQW5pbWF0aW9uKTtrOlBsYXkoKTtrOkFkanVzdFNwZWVkKDUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBjb25uZWN0aW9uOkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQpDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5BdXRvQmxvY2tpbmdSZWRBdHRhY2tzID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0Jsb2NrV2FybmluZyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgaWYgd29ya3NwYWNlLkxpdmluZzpGaW5kRmlyc3RDaGlsZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSkuSGVhZDpGaW5kRmlyc3RDaGlsZCgiV2FybmluZ0luZGkiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiRm9sZGVyIikgYW5kIGsuTmFtZTptYXRjaCgiUmVtb3RlJCIpIGFuZCBrOkZpbmRGaXJzdENoaWxkKCJCbG9jayIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrLkJsb2NrOkZpcmVTZXJ2ZXIodHJ1ZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgazpJc0EoIkZvbGRlciIpIGFuZCBrLk5hbWU6bWF0Y2goIlJlbW90ZSQiKSBhbmQgazpGaW5kRmlyc3RDaGlsZCgiQmxvY2siKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgay5CbG9jazpGaXJlU2VydmVyKGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Vc2luZ1ZvaWRPbk90aGVycyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgWCA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWU7DQogICAgICAgIGxvY2FsIFRlbGVwb3J0ZWQgPSBmYWxzZTsNCg0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0dsaXRjaGluZyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgT25Db29sZG93biA9IHdvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJPbkNvb2xkb3duIik7DQogICAgICAgICAgICAgICAgbG9jYWwgRGFzaGluZyA9IHdvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJEYXNoaW5nIik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgT25Db29sZG93biBhbmQgRGFzaGluZyBhbmQgbm90IFRlbGVwb3J0ZWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICBYID0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTkwMDAsLTE5MCw5MDAwKTsNCiAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgZWxzZWlmIG5vdCBPbkNvb2xkb3duIGFuZCBub3QgRGFzaGluZyBhbmQgVGVsZXBvcnRlZCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBYOw0KICAgICAgICAgICAgICAgICAgICBUZWxlcG9ydGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4xNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuVXNpbmdSYWluYm93VUkgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIGlmIGdldGdlbnYoKS5BdXRvR29pbmdSYWluYm93ID09IGZhbHNlIHRoZW4NCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5LlRvcEJhci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLDAsMCk7DQogICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5EclJheS5NYWluQmFyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKTsNCiAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5LlRvcEJhci5Ub3BCYXIuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5uZXcoMCwwLDApOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9Hb2luZ1JhaW5ib3cgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSAgDQogICAgICAgICAgICAgICAgbG9jYWwgVG9wQmFyID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIik6V2FpdEZvckNoaWxkKCJEclJheSIpOldhaXRGb3JDaGlsZCgiVG9wQmFyIik7DQogICAgICAgICAgICAgICAgbG9jYWwgTWFpbkJhciA9IGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpOldhaXRGb3JDaGlsZCgiRHJSYXkiKTpXYWl0Rm9yQ2hpbGQoIk1haW5CYXIiKTsNCg0KICAgICAgICAgICAgICAgIGxvY2FsIFQgPSB0aWNrKCkgJSAxDQogICAgICAgICAgICAgICAgbG9jYWwgUiA9IG1hdGguc2luKFQgKiAyICogbWF0aC5waSkgKiAwLjUgKyAwLjUNCiAgICAgICAgICAgICAgICBsb2NhbCBHID0gbWF0aC5zaW4oVCAqIDIgKiBtYXRoLnBpICsgMiAqIG1hdGgucGkgLyAzKSAqIDAuNSArIDAuNQ0KICAgICAgICAgICAgICAgIGxvY2FsIEIgPSBtYXRoLnNpbihUICogMiAqIG1hdGgucGkgKyA0ICogbWF0aC5waSAvIDMpICogMC41ICsgMC41DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgVG9wQmFyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KFIsRyxCKTsNCiAgICAgICAgICAgICAgICBNYWluQmFyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KFIsRyxCKTsNCiAgICAgICAgICAgICAgICBUb3BCYXIuVG9wQmFyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KFIsRyxCKTsNCiAgICAgICAgICAgICAgICBTdGF0cy5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldyhSLEcsQik7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4zNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuU3RvcmVFdmVyeXRoaW5nID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEl0ZW1zVG9TdG9yZSA9IHsiU2luZ3UiLCJOaWt5dU5pa3l1IiwiRGlvJ3MgRGlhcnkiLCJJbnZlcnRlZCIsIkRpbydzIEJvbmUiLCJBcmFzYWthIiwiS3VqbyIsIkhvZ3lva3UiLCJDcmltc29uIiwiQ29ydGV4IiwiU3VrdW4iLCJHbG92ZXMiLCJTcGxpdCIsIk9BJ3MiLCJDaGFpbiIsIkN5YW4iLCJUZWNoIn0NCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0FueUV2ZXJ5dGhpbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx2IGluIGlwYWlycyhJdGVtc1RvU3RvcmUpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKHY6bG93ZXIoKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiSXRlbVN0b3JhZ2VSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlVzZUl0ZW1TdG9yYWdlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMy4zNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuU3RvcmVOaWt5dSA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJOaWt5dSI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlN0b3JpbmdOaWt5dU5pa3l1ID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZVNpbmd1bGFyaXR5ID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEl0ZW1Ub1N0b3JlID0gIlNpbmd1IjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ1Npbmd1bGFyaXR5ID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZVN1a3VuYSA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJTdWt1biI7DQogICAgbG9jYWwgSXRlbVNsb3RzID0geyJTbG90MSIsIlNsb3QyIiwiU2xvdDMiLCJTbG90NCIsIlNsb3Q1IiwiU2xvdDYifTsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0ZpbmdlciA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZm9yIGksdiBpbiBpcGFpcnMoSXRlbVNsb3RzKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSXRlbVN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbdl0uVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHguTmFtZTpsb3dlcigpOmZpbmQoSXRlbVRvU3RvcmU6bG93ZXIoKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKHY6c3ViKDUpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZUludmVydGVkID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEl0ZW1Ub1N0b3JlID0gIkludmVydGVkIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0ludmVydGVkID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZVNwbGl0ID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEl0ZW1Ub1N0b3JlID0gIlNwbGl0IjsNCiAgICBsb2NhbCBJdGVtU2xvdHMgPSB7IlNsb3QxIiwiU2xvdDIiLCJTbG90MyIsIlNsb3Q0IiwiU2xvdDUiLCJTbG90NiJ9Ow0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5TdG9yaW5nU3BsaXQgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlQ2hhaW4gPSBmdW5jdGlvbigpDQogICAgbG9jYWwgSXRlbVRvU3RvcmUgPSAiQ2hhaW4iOw0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5TdG9yaW5nQ2hhaW4gPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlQ29ydGV4ID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEl0ZW1Ub1N0b3JlID0gIkNvcnRleCI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlN0b3JpbmdDb3J0ZXggPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlQ3JpbXNvbiA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJDcmltc29uIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0NyaW1zb24gPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlQ3lhbiA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJDeWFuIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0N5YW4gPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlVGVjaCA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJUZWNoIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ1RlY2ggPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlQXJhc2FrYSA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJBcmFzYWthIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0FyYXNha2EgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlS3Vqb0hhdCA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJLdWpvIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ0t1am9IYXQgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLklubmVyLklubmVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJJbWFnZUJ1dHRvbiIpIGFuZCBrLlZpc2libGUgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgay5UZXh0LlRleHQgPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyx4IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB4Lk5hbWU6bG93ZXIoKTpmaW5kKEl0ZW1Ub1N0b3JlOmxvd2VyKCkpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpFcXVpcFRvb2woeCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge3RvbnVtYmVyKGsuTmFtZTptYXRjaCgiJWQrIikpfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkl0ZW1TdG9yYWdlUmVtb3RlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtU3RvcmFnZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgxLjE1KTtnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6VW5lcXVpcFRvb2xzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlRGlvc0JvbmUgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgSXRlbVRvU3RvcmUgPSAiRGlvJ3MgQm9uZSI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlN0b3JpbmdEaW9zQm9uZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZm9yIF8sayBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSXRlbVN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXI6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgaWYgazpJc0EoIkltYWdlQnV0dG9uIikgYW5kIGsuVmlzaWJsZSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBrLlRleHQuVGV4dCA9PSAiTm9uZSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLHggaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHguTmFtZTpsb3dlcigpOmZpbmQoSXRlbVRvU3RvcmU6bG93ZXIoKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOkVxdWlwVG9vbCh4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7dG9udW1iZXIoay5OYW1lOm1hdGNoKCIlZCsiKSl9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiSXRlbVN0b3JhZ2VSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlVzZUl0ZW1TdG9yYWdlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuMTUpO2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpVbmVxdWlwVG9vbHMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS43NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuU3RvcmVEaW9zRGlhcnkgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgSXRlbVRvU3RvcmUgPSAiRGlvJ3MgRGlhcnkiOw0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5TdG9yaW5nRGlvc0RpYXJ5ID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZUhvZ3lva3UgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgSXRlbVRvU3RvcmUgPSAiSG9neW9rdSI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLlN0b3JpbmdIb2d5b2t1ID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZUdsb3ZlcyA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJHbG92ZXMiOw0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5TdG9yaW5nR2xvdmVzID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JdGVtU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiSW1hZ2VCdXR0b24iKSBhbmQgay5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGsuVGV4dC5UZXh0ID09ICJOb25lIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8seCBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQmFja3BhY2s6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgeC5OYW1lOmxvd2VyKCk6ZmluZChJdGVtVG9TdG9yZTpsb3dlcigpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIik6RXF1aXBUb29sKHgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHt0b251bWJlcihrLk5hbWU6bWF0Y2goIiVkKyIpKX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJJdGVtU3RvcmFnZVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbVN0b3JhZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7Z2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOlVuZXF1aXBUb29scygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdG9yZU9BcyA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBJdGVtVG9TdG9yZSA9ICJPQSdzIjsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuU3RvcmluZ09BcyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZm9yIF8sayBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSXRlbVN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXI6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgaWYgazpJc0EoIkltYWdlQnV0dG9uIikgYW5kIGsuVmlzaWJsZSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBrLlRleHQuVGV4dCA9PSAiTm9uZSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLHggaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHguTmFtZTpsb3dlcigpOmZpbmQoSXRlbVRvU3RvcmU6bG93ZXIoKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpOkVxdWlwVG9vbCh4KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7dG9udW1iZXIoay5OYW1lOm1hdGNoKCIlZCsiKSl9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiSXRlbVN0b3JhZ2VSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlVzZUl0ZW1TdG9yYWdlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDEuMTUpO2dhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKTpVbmVxdWlwVG9vbHMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS43NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuTGV2ZWxpbmdVcCA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9MZXZlbGluZ1VwID09IHRydWUgZG8gdGFzay53YWl0KDAuNSk7DQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuQ2FzaC5WYWx1ZSA+IDc1IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjk5In07DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJSb2tha2FrYSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBpcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI6V2FpdEZvckNoaWxkKCJCYWNrcGFjayIpOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKHsiQXJyb3ciLCJCYXJyZWwiLCJSb2tha2FrYSIsIlN0b3AgU2lnbiIsIk15c3RlcmlvdXMgQ2FtZXJhIiwiSGF1bnRlZCBTd29yZCIsIlNwaW4gTWFudWFsIiwiSGFtb24gTWFudWFsIiwiU3RvbmUgTWFzayIsIkJvbXUgQm9tdSBEZXZpbCBGcnVpdCIsIk1vY2hpIE1vY2hpIERldmlsIEZydWl0IiwiQmFyaSBCYXJpIERldmlsIEZydWl0In0sdi5OYW1lKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlNlbGxJdGVtIik6RmlyZVNlcnZlcih2Lk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgIA0KICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVB1cmNoYXNlUHJvbXB0KCk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgIGVuZCAgICANCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlNhdmluZ1VwQ2FzaCA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TYXZpbmdDYXNoID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBDYXNoMSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuQ2FzaDsNCiAgICAgICAgICAgICAgICBsb2NhbCBDYXNoMiA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5NZW51LkN1cnJlbmNpZXMuQ2FzaC5CYWNrZ3JvdW5kLklubmVyLlRleHRMYWJlbDsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBpZiBDYXNoMS5WYWx1ZSA9PSB0b251bWJlcihzdHJpbmcubWF0Y2goQ2FzaDIuVGV4dCwiJWQrIC8gKCVkKykiKSkgdGhlbiANCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkNhc2guVmFsdWUgPiA3NSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSAiOTkifTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJSb2tha2FrYSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICI5OSJ9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkJ1eUl0ZW1SZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlJva2FrYWthIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjk5In07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiQnV5SXRlbVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiUm9rYWtha2EiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKTpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoeyJBcnJvdyIsIkJhcnJlbCIsIlJva2FrYWthIiwiU3RvcCBTaWduIiwiTXlzdGVyaW91cyBDYW1lcmEiLCJIYXVudGVkIFN3b3JkIiwiU3BpbiBNYW51YWwiLCJIYW1vbiBNYW51YWwiLCJTdG9uZSBNYXNrIiwiQm9tdSBCb211IERldmlsIEZydWl0IiwiTW9jaGkgTW9jaGkgRGV2aWwgRnJ1aXQiLCJCYXJpIEJhcmkgRGV2aWwgRnJ1aXQifSx2Lk5hbWUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlNlbGxJdGVtIik6RmlyZVNlcnZlcih2Lk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBnZXRnZW52KCkuSGlkZVB1cmNoYXNlUHJvbXB0KCk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuNDUpOw0KICAgICAgICBlbmQgICAgDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5SZWJpcnRoaW5nID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1JlYmlydGggPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuRXhwLlZhbHVlID09IDMwNzI1IGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLk1hc3RlcnkuVmFsdWUgfj0gMTUgdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJHbG9iYWxVc2VkUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiVXBncmFkZU1hcyIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjQ1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5CcmVha2luZ1Rocm91Z2ggPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvQnJlYWt0aHJvdWdoID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkV4cC5WYWx1ZSA9PSAzMDcyNSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDE1IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkJyZWFrdGhyb3VnaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjQ1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5QdWJsaWNTZXJ2ZXJBdXRvZmFybSA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBGbG9hdFBhcnQgPSBJbnN0YW5jZS5uZXcoIlBhcnQiLGdhbWUuV29ya3NwYWNlKTsNCiAgICBGbG9hdFBhcnQuTmFtZSA9ICJGbG9hdFBhcnQiDQogICAgRmxvYXRQYXJ0LlNpemUgPSBWZWN0b3IzLm5ldyg2LDAuMSw2KTsNCiAgICBGbG9hdFBhcnQuQW5jaG9yZWQgPSB0cnVlDQogICAgRmxvYXRQYXJ0LlRyYW5zcGFyZW5jeSA9IDENCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2V0Z2VudigpLkF1dG9QdWJsaWNHcmluZGluZyA9PSBmYWxzZSB0aGVuDQogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlJvb3RQYXJ0LkNGcmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuUm9vdFBhcnQuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLDgsMCk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1B1YmxpY0dyaW5kaW5nID09IHRydWUgZG8gDQogICAgICAgICAgICBsb2NhbCBDb25uZWMNCiAgICAgICAgICAgIENvbm5lYyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU3RhdGVDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXyx6KQ0KICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpTZXRTdGF0ZUVuYWJsZWQoMSxmYWxzZSk7DQogICAgICAgICAgICAgICAgICAgIGlmIHogPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5GYWxsaW5nRG93biBvciB6ID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuUmFnZG9sbCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkNoYW5nZVN0YXRlKEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuR2V0dGluZ1VwKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBDb25uZWM6RGlzY29ubmVjdCgpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICB0YXNrLndhaXQoMC4zNSk7DQogICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLkF1dG9QdWJsaWNHcmluZGluZyA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIEZsb2F0UGFydC5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lICsgVmVjdG9yMy5uZXcoMCwtMy4wNSwwKTsNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGZvciBfLGogaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0UGxheWVycygpKSBkbw0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBDaGFyID0gai5DaGFyYWN0ZXINCiAgICAgICAgICAgICAgICAgICAgaWYgQ2hhciB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyxuIGluIHBhaXJzKENoYXI6R2V0RGVzY2VuZGFudHMoKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBuOklzQSgiQmFzZVBhcnQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uQ2FuQ29sbGlkZSA9IGZhbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4xNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1B1YmxpY0dyaW5kaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBub3Qgd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV0uQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIk9uQ29vbGRvd24iKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBGb2xkZXIgPSB7d29ya3NwYWNlLkl0ZW0sd29ya3NwYWNlLkl0ZW0yfTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIE5vcm1hbFBhcnR6ID0ge30NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVW5pcXVlUGFydHogPSB7fQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMoRm9sZGVyKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMoazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJCYXNlUGFydCIpIGFuZCBrLk5hbWUgfj0gIlNvdWxTcGF3biIgYW5kIGsuTmFtZSB+PSAiUGVyY2VwdGlvbk1hc2siIGFuZCBrLlBvc2l0aW9uIH49IFZlY3RvcjMubmV3KDE4MDQuNTM5MDYyNSwtMjk4LjE3MzU4Mzk4NDM3NSwtMzA5LjQ2NDk2NTgyMDMxMjUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChrLk5hbWU6c3ViKDEsMikgPT0gIkJvIiBvciBrLk5hbWU6c3ViKDEsMykgPT0gIlNlYyIpIGFuZCBrOkZpbmRGaXJzdENoaWxkKCJPdXRsaW5lIikpIG9yICgoay5OYW1lOnN1YigxLDIpIH49ICJCbyIgYW5kIGsuTmFtZTpzdWIoMSwzKSB+PSAiU2VjIikgYW5kIG5vdCBrOkZpbmRGaXJzdENoaWxkKCJPdXRsaW5lIikpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAoKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDAgYW5kIGsuTmFtZSA9PSAiU3VrdW5hRmluZ2VyIikgb3IgKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDAgYW5kIGsuTmFtZSA9PSAiSG9neW9rdUZyYWdtZW50Iikgb3IgKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDEgYW5kIExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDIgYW5kIGsuTmFtZSA9PSAiT0EncyBHcmFjZSIpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsuTmFtZSB+PSAiQm94IiBhbmQgay5OYW1lIH49ICJCYXJyZWwiIGFuZCBrLk5hbWUgfj0gIkNoZXN0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoVW5pcXVlUGFydHosayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QgS2V5IikgYW5kIHdvcmtzcGFjZS5JdGVtOkZpbmRGaXJzdENoaWxkKCJDaGVzdCIpIGFuZCBrLk5hbWUgPT0gIkNoZXN0IiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChOb3JtYWxQYXJ0eixrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgbm90IExwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNoZXN0IEtleSIpIGFuZCB3b3Jrc3BhY2UuSXRlbTpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QiKSBhbmQgay5OYW1lIH49ICJDaGVzdCIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoTm9ybWFsUGFydHosayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5vdCB3b3Jrc3BhY2UuSXRlbTpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChOb3JtYWxQYXJ0eixrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIFRlbGVwb3J0VG8oUGFydHMpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAjUGFydHMgPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZWxlY3RlZCA9IFBhcnRzW21hdGgucmFuZG9tKDEsI1BhcnRzKV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJvbXB0ID0gU2VsZWN0ZWQ6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJQcm94aW1pdHlQcm9tcHQiKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VsZWN0ZWQgYW5kIFByb21wdCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyOlNldFByaW1hcnlQYXJ0Q0ZyYW1lKENGcmFtZS5uZXcoU2VsZWN0ZWQuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygwLDcsMCkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9tcHQuSG9sZER1cmF0aW9uID0gMDtQcm9tcHQ6SW5wdXRIb2xkQmVnaW4oKTtQcm9tcHQ6SW5wdXRIb2xkRW5kKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiBtYXRoLnJhbmRvbSgpIDw9IDAuOTAgYW5kICNVbmlxdWVQYXJ0eiA+IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRUbyhVbmlxdWVQYXJ0eik7DQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAjTm9ybWFsUGFydHogPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0VG8oTm9ybWFsUGFydHopOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjI1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIi9lIGhha2FyaSJ9Ow0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDaGF0dGVkIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlByaXZhdGVTZXJ2ZXJBdXRvZmFybSA9IGZ1bmN0aW9uKCkNCiAgICBnZXRnZW52KCkuTGlzdE9mTnBjcyA9IHsiQXJiaXRlciIsIlBpbGxhciIsIlN0YXJyayIsIkJ5Z29uZSIsIlNwYWNlIEN1cnNlIiwiSm90YXJvIEt1am8iLCJUb2ppIiwiUm9sYW5kIiwiQmxhY2tTaWxlbmNlIiwiQW5nZWxpY2FXZWFrIiwiQW5nZWxpY2EiLCIiLCJEaW8iLCJEZWt1IiwiQWRqdWNoYXMiLCJDb250b3J0ZWQgQ3Vyc2UiLCJHbHV0dG9uIEN1cnNlIiwiTW9zcXVpdG8gQ3Vyc2UiLCJTcGlkZXIgQ3Vyc2UiLCJGcm9nIEhvbGxvdyIsIkZpc2hib25lIn07DQoNCiAgICBnYW1lLlBsYXllcnNbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLlBsYXllckd1aS5DaGF0LkZyYW1lLlZpc2libGUgPSBmYWxzZTsNCg0KICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTdGFuZGxlc3MiIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGlucmEgS3VzYWthYmUiIG9yIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGFkb3cgVGhlIFdvcmxkIiB0aGVuDQogICAgICAgIGdldGdlbnYoKS5EaXN0YW5jZSA9IC01LjU7DQogICAgZWxzZWlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJFbXBlcm9yIiB0aGVuDQogICAgICAgIGdldGdlbnYoKS5EaXN0YW5jZSA9IDE5LjU7DQogICAgZWxzZQ0KICAgICAgICBnZXRnZW52KCkuRGlzdGFuY2UgPSAtNi41Ow0KICAgIGVuZA0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuVGFyZ2V0ID0gbmlsIGdldGdlbnYoKS5Gb3VuZEFueXRoaW5nID0gZmFsc2UNCiAgICAgICAgICAgICAgICBmb3IgaSx2IGluIGlwYWlycyhnZXRnZW52KCkuTGlzdE9mTnBjcykgZG8NCiAgICAgICAgICAgICAgICAgICAgaWYgd29ya3NwYWNlLkxpdmluZzpGaW5kRmlyc3RDaGlsZCh2KSBhbmQgd29ya3NwYWNlLkxpdmluZzpGaW5kRmlyc3RDaGlsZCh2KTpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIE5QQyA9IHdvcmtzcGFjZS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQodik7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBOUEMgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5UYXJnZXQgPSBOUEMgZ2V0Z2VudigpLkZvdW5kQW55dGhpbmcgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMy41KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgZG8gDQogICAgICAgICAgICBsb2NhbCBDb25uZWMNCiAgICAgICAgICAgIENvbm5lYyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU3RhdGVDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXyx6KQ0KICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6U2V0U3RhdGVFbmFibGVkKDEsZmFsc2UpOw0KICAgICAgICAgICAgICAgICAgICBpZiB6ID09IEVudW0uSHVtYW5vaWRTdGF0ZVR5cGUuRmFsbGluZ0Rvd24gb3IgeiA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLlJhZ2RvbGwgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpDaGFuZ2VTdGF0ZShFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkdldHRpbmdVcCk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgQ29ubmVjOkRpc2Nvbm5lY3QoKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICAgICAgaWYgbm90IGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgdGhlbg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1ByaXZhdGVHcmluZGluZyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLlRhcmdldCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5UYXJnZXQ6RmluZEZpcnN0Q2hpbGQoIlBhcnRpY2lwYXRlZCIpIGFuZCBnZXRnZW52KCkuVGFyZ2V0LlBhcnRpY2lwYXRlZDpGaW5kRmlyc3RDaGlsZChnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLlRhcmdldC5IdW1hbm9pZC5IZWFsdGggPSAwOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCg0KICAgICAgICAgICAgICAgICAgICBpZiBub3QgZ2V0Z2VudigpLlRhcmdldC5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiT25Db29sZG93biIpIGFuZCBub3QgZ2V0Z2VudigpLlRhcmdldC5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiR3JhYmJlZCIpIGFuZCBub3Qgd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV0uQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIkRhc2hpbmciKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhnZXRnZW52KCkuVGFyZ2V0Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBnZXRnZW52KCkuVGFyZ2V0Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLmxvb2tWZWN0b3IgKiBnZXRnZW52KCkuRGlzdGFuY2UsZ2V0Z2VudigpLlRhcmdldC5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKTt0YXNrLndhaXQoMC4zNSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQpZ2V0Z2VudigpLkF0dGFja2luZygpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzLjE1KTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuRm91bmRBbnl0aGluZyA9PSBmYWxzZSBhbmQgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkluQ29tYmF0LkVuYWJsZWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJraWxsIn07DQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJTdWt1bmFEaWFsb2d1ZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICBlbmQgICAgICAgICAgICANCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgzLjUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9Qcml2YXRlR3JpbmRpbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkZvdW5kQW55dGhpbmcgPT0gZmFsc2UgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBSZXNwYXduTmVlZGVkID0gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gcGFpcnMoZ2FtZS5Xb3Jrc3BhY2UuSXRlbTpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoay5OYW1lID09ICJCb3giIGFuZCBrOkZpbmRGaXJzdENoaWxkKCJPdXRsaW5lIikpIGFuZCBrLlBvc2l0aW9uIH49IFZlY3RvcjMubmV3KDE4MDQuNTM5MDYyNSwtMjk4LjE3MzU4Mzk4NDM3NSwtMzA5LjQ2NDk2NTgyMDMxMjUpKSBvciBrLk5hbWUgPT0gIkJhcnJlbCIgb3Igay5OYW1lID09ICJDaGVzdCIgYW5kIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJDaGVzdCBLZXkiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJlc3Bhd25OZWVkZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIFJlc3Bhd25OZWVkZWQgYW5kIG5vdCB3b3Jrc3BhY2UuTGl2aW5nW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lXS5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiT25Db29sZG93biIpIGFuZCBnZXRnZW52KCkuQXV0b0xldmVsaW5nVXAgPT0gZmFsc2UgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIkV4cGxvaXRlciJ9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJBcHBseUFjaGlldmVtZW50Iik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpO3Rhc2sud2FpdCg0LjUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjQ1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnZXRnZW52KCkuRm91bmRBbnl0aGluZyA9PSBmYWxzZSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIGFuZCBub3Qgd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV0uQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIk9uQ29vbGRvd24iKSBhbmQgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBGb2xkZXIgPSB7d29ya3NwYWNlLkl0ZW0sd29ya3NwYWNlLkl0ZW0yfTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIE5vcm1hbFBhcnRzID0ge30NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgVW5pcXVlUGFydHMgPSB7fQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMoRm9sZGVyKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMoazpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJCYXNlUGFydCIpIGFuZCBrLk5hbWUgfj0gIlNvdWxTcGF3biIgYW5kIGsuTmFtZSB+PSAiUGVyY2VwdGlvbk1hc2siIGFuZCBrLlBvc2l0aW9uIH49IFZlY3RvcjMubmV3KDE4MDQuNTM5MDYyNSwtMjk4LjE3MzU4Mzk4NDM3NSwtMzA5LjQ2NDk2NTgyMDMxMjUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChrLk5hbWU6c3ViKDEsMikgPT0gIkJvIiBvciBrLk5hbWU6c3ViKDEsMykgPT0gIlNlYyIpIGFuZCBrOkZpbmRGaXJzdENoaWxkKCJPdXRsaW5lIikpIG9yICgoay5OYW1lOnN1YigxLDIpIH49ICJCbyIgYW5kIGsuTmFtZTpzdWIoMSwzKSB+PSAiU2VjIikgYW5kIG5vdCBrOkZpbmRGaXJzdENoaWxkKCJPdXRsaW5lIikpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAoKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDAgYW5kIGsuTmFtZSA9PSAiU3VrdW5hRmluZ2VyIikgb3IgKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDAgYW5kIGsuTmFtZSA9PSAiSG9neW9rdUZyYWdtZW50Iikgb3IgKExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDEgYW5kIExwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDIgYW5kIGsuTmFtZSA9PSAiT0EncyBHcmFjZSIpKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsuTmFtZSB+PSAiQm94IiBhbmQgay5OYW1lIH49ICJCYXJyZWwiIGFuZCBrLk5hbWUgfj0gIkNoZXN0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoVW5pcXVlUGFydHMsayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QgS2V5IikgYW5kIHdvcmtzcGFjZS5JdGVtOkZpbmRGaXJzdENoaWxkKCJDaGVzdCIpIGFuZCBrLk5hbWUgPT0gIkNoZXN0IiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChOb3JtYWxQYXJ0cyxrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlaWYgbm90IExwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIkNoZXN0IEtleSIpIGFuZCB3b3Jrc3BhY2UuSXRlbTpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QiKSBhbmQgay5OYW1lIH49ICJDaGVzdCIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoTm9ybWFsUGFydHMsayk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZWlmIG5vdCB3b3Jrc3BhY2UuSXRlbTpGaW5kRmlyc3RDaGlsZCgiQ2hlc3QiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChOb3JtYWxQYXJ0cyxrKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGZ1bmN0aW9uIFRlbGVwb3J0VG8oUGFydHMpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAjUGFydHMgPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZWxlY3RlZCA9IFBhcnRzW21hdGgucmFuZG9tKDEsI1BhcnRzKV07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgUHJvbXB0ID0gU2VsZWN0ZWQ6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJQcm94aW1pdHlQcm9tcHQiKTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgU2VsZWN0ZWQgYW5kIFByb21wdCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyOlNldFByaW1hcnlQYXJ0Q0ZyYW1lKENGcmFtZS5uZXcoU2VsZWN0ZWQuUG9zaXRpb24gLSBWZWN0b3IzLm5ldygwLC0yLjUsMCkpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9tcHQuSG9sZER1cmF0aW9uID0gMDtQcm9tcHQ6SW5wdXRIb2xkQmVnaW4oKTtQcm9tcHQ6SW5wdXRIb2xkRW5kKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiBtYXRoLnJhbmRvbSgpIDw9IDAuODUgYW5kICNVbmlxdWVQYXJ0cyA+IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRUbyhVbmlxdWVQYXJ0cyk7DQogICAgICAgICAgICAgICAgICAgIGVsc2VpZiAjTm9ybWFsUGFydHMgPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIFRlbGVwb3J0VG8oTm9ybWFsUGFydHMpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjI1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUHJpdmF0ZUdyaW5kaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICB3b3Jrc3BhY2UuTGl2aW5nW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lXTpGaW5kRmlyc3RDaGlsZCgiQW5pbWF0ZSIpLmlkbGUuQW5pbWF0aW9uMS5BbmltYXRpb25JZCA9ICJyYnhhc3NldGlkOi8vMTMzMjI3MzM4MjgiOw0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpIA0KZW5kDQoNCmdldGdlbnYoKS5TZWxsaW5nQW55SXRlbSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TZWxsaW5nID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbG9jYWwgSXRlbXMgPSB7IkFycm93IiwiQmFycmVsIiwiUm9rYWtha2EiLCJTdG9wIFNpZ24iLCJNeXN0ZXJpb3VzIENhbWVyYSIsIkhhdW50ZWQgU3dvcmQiLCJTcGluIE1hbnVhbCIsIkhhbW9uIE1hbnVhbCIsIlN0b25lIE1hc2siLCJCb211IEJvbXUgRGV2aWwgRnJ1aXQiLCJNb2NoaSBNb2NoaSBEZXZpbCBGcnVpdCIsIkJhcmkgQmFyaSBEZXZpbCBGcnVpdCJ9Ow0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gaXBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOldhaXRGb3JDaGlsZCgiQmFja3BhY2siKTpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiB0YWJsZS5maW5kKEl0ZW1zLHYuTmFtZSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlNlbGxJdGVtIik6RmlyZVNlcnZlcih2Lk5hbWUpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgzLjUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLldlYXBvbkVxdWlwcGVkID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0VxdWlwV2VhcG9uID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBub3Qgd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV0uQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIlN1bW1vbmVkIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwiUSIsZmFsc2UsZ2FtZSk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4zNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuSWNoaWdvUmVzZXR0ZWQgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUmVzZXRJY2hpZ28gPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJLdXJvc2FraSBJY2hpZ28gfCBTdWJzdGl0dXRlIFNoaW5pZ2FtaSIgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBvciBnZXRnZW52KCkuRm91bmRBbnl0aGluZyA9PSBmYWxzZSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOkVxdWlwVG9vbChnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiUm9rYWtha2EiKSkNCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbSIpOldhaXRGb3JDaGlsZCgiUm9rYWtha2EiKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiUm9rYWtha2EiKTpBY3RpdmF0ZSgpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlN0b3JlZE9GQSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TdG9yZVN0YWdlT25lID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDFdIiBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIG9yIGdldGdlbnYoKS5Gb3VuZEFueXRoaW5nID09IGZhbHNlIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkluQ29tYmF0LkVuYWJsZWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDEsOTUgZG8gLS0gU3VwcG9ydHMgdXAgdG8gOTUgc3RhbmQgc2xvdHMgOk8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIlN0YW5kbGVzcyIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpIDw9IDYgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlLlVzZVN0b3JhZ2VFeHRyYTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC40NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuVXNpbmdBbHRGYXJtaW5nID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0FsdEZhcm1pbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtODUuODIwNzg1NTIyNDYwOTQsLTExNi4zNjk2MDYwMTgwNjY0LDMxNC4wNzEyMjgwMjczNDM3NSk7DQogICAgICAgICAgICAgICAgaWYgd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV06RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuTWF4SGVhbHRoIH49IHdvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpLkhlYWx0aCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuVXNpbmdNYWluQWNjb3VudEZhcm1pbmcgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvTWFpbkZhcm1pbmcgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKSAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTg3LjIzNTc5NDA2NzM4MjgxLC0xMTYuMzY5NjA2MDE4MDY2NCwzMTguMzk3MzY5Mzg0NzY1Nik7DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkJ1dHRvbjFEb3duKFZlY3RvcjIubmV3KCkpOw0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMDE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Vc2luZ0Rla3VBdXRvZmFybTEgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gMzN9Ow0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlF1ZXN0UmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQWNjZXB0UXVlc3QiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSAzM307DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUXVlc3RSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDbGFpbVF1ZXN0Iik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOyAgICAgICAgICAgIA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuTWFzdGVyeS5WYWx1ZSA8IDMgdGhlbg0KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkNhc2guVmFsdWUgPiA3NSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICI5OSJ9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiQnV5SXRlbVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiUm9rYWtha2EiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgIA0KICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIGlwYWlycyhnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjpXYWl0Rm9yQ2hpbGQoIkJhY2twYWNrIik6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHRhYmxlLmZpbmQoeyJBcnJvdyIsIkJhcnJlbCIsIlJva2FrYWthIiwiU3RvcCBTaWduIiwiTXlzdGVyaW91cyBDYW1lcmEiLCJIYXVudGVkIFN3b3JkIiwiU3BpbiBNYW51YWwiLCJIYW1vbiBNYW51YWwiLCJTdG9uZSBNYXNrIiwiQm9tdSBCb211IERldmlsIEZydWl0IiwiTW9jaGkgTW9jaGkgRGV2aWwgRnJ1aXQiLCJCYXJpIEJhcmkgRGV2aWwgRnJ1aXQifSx2Lk5hbWUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJHbG9iYWxVc2VkUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiU2VsbEl0ZW0iKTpGaXJlU2VydmVyKHYuTmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgDQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5IaWRlUHVyY2hhc2VQcm9tcHQoKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyx4IGluIHBhaXJzKHdvcmtzcGFjZS5MaXZpbmc6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgaWYgKHguTmFtZSA9PSAiQnlnb25lIiBvciB4Lk5hbWUgPT0gIkFuZ2VsaWNhIiBvciB4Lk5hbWUgPT0gIkFuZ2VsaWNhV2VhayIgb3IgeC5OYW1lID09ICJCbGFja1NpbGVuY2UiKSBhbmQgeDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICB4Lkh1bWFub2lkLkhlYWx0aCA9IDA7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMDE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIlJvbGFuZCIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGlucmEgS3VzYWthYmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBSb2xhbmRIdW1hbm9pZCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJSb2xhbmQiKS5IdW1hbm9pZA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgUm9sYW5kSHVtYW5vaWQgYW5kIFJvbGFuZEh1bWFub2lkLkhlYWx0aCB+PSBSb2xhbmRIdW1hbm9pZC5NYXhIZWFsdGggdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKXRhc2sud2FpdCg0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUm9sYW5kSHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFJvbGFuZEJvc3MgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIik6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhSb2xhbmRCb3NzLlBvc2l0aW9uIC0gUm9sYW5kQm9zcy5DRnJhbWUubG9va1ZlY3RvciAqIDcsUm9sYW5kQm9zcy5Qb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlB1bmNoIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJGaWVyY2UiKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkNvcm5hIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMy4xNSk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGlucmEgS3VzYWthYmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCBhbmQgbm90IHdvcmtzcGFjZS5MaXZpbmcuRGVrdS5DRFZhbHVlczpGaW5kRmlyc3RDaGlsZCgiQmxvY2tpbmciKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBEZWt1SHVtYW5vaWQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpLkh1bWFub2lkDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBEZWt1SHVtYW5vaWQgYW5kIERla3VIdW1hbm9pZC5IZWFsdGggfj0gRGVrdUh1bWFub2lkLk1heEhlYWx0aCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERla3VIdW1hbm9pZC5IZWFsdGggPSAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGVrdUJvc3MgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0Iik7DQogICAgICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoRGVrdUJvc3MuUG9zaXRpb24gLSBEZWt1Qm9zcy5DRnJhbWUubG9va1ZlY3RvciAqIDcsRGVrdUJvc3MuUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQdW5jaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiRmllcmNlIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJDb3JuYSIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMuMTUpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJEZWt1IikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW0yOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgYW5kIG5vdCBMcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgYW5kIG5vdCBMcGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGlucmEgS3VzYWthYmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLDEwMCBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTHBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJPbmUgZm9yIEFsbCBbU3RhZ2UgNF0iIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGVbIlNsb3QiLi5pXTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNTAuODgxMTc1OTk0ODczMDUsLTExNi4zNjk2MDYwMTgwNjY0LDM0NC41MzU5NDk3MDcwMzEyNSk7DQogICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwxMDAgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIExwbGF5ZXIuUGxheWVyR3VpLlN0YW5kU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lclsiU2xvdCIuLmldLlRleHQuVGV4dCA9PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsiU2xvdCIuLml9Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAzNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MSA9PSB0cnVlIGRvDQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIlJvbGFuZCIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0xNjkuNjI3ODgzOTExMTMyOCwgNzkwLjc2NDUyNjM2NzE4NzUsIC04MDM2Ljg0MjI4NTE1NjI1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5NYXAuUnVpbmVkQ2l0eTpHZXREZXNjZW5kYW50cygpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpcmVwcm94aW1pdHlwcm9tcHQodiwwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4zNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOw0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJEZWt1IikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW0yOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgYW5kIG5vdCBMcGxheWVyLkJhY2twYWNrOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgYW5kIG5vdCBMcGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJPbmUgZm9yIEFsbCBbU3RhZ2UgM10iIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC01MC44ODExNzU5OTQ4NzMwNSwtMTE2LjM2OTYwNjAxODA2NjQsMzQ0LjUzNTk0OTcwNzAzMTI1KTsNCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLDEwMCBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgTHBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJTaGlucmEgS3VzYWthYmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGVbIlNsb3QiLi5pXTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMDM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIlJvbGFuZCIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuSXRlbTI6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSBhbmQgbm90IExwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSBhbmQgbm90IExwbGF5ZXIuUGxheWVyR3VpLkluQ29tYmF0LkVuYWJsZWQgYW5kIExwbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgPT0gIk9uZSBmb3IgQWxsIFtTdGFnZSAzXSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTUwLjg4MTE3NTk5NDg3MzA1LC0xMTYuMzY5NjA2MDE4MDY2NCwzNDQuNTM1OTQ5NzA3MDMxMjUpOw0KICAgICAgICAgICAgICAgICAgICBmb3IgaSA9IDEsMTAwIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBMcGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIlNoaW5yYSBLdXNha2FiZSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpIDw9IDYgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlLlVzZVN0b3JhZ2VFeHRyYTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4wMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJSb2xhbmQiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuSXRlbTI6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSBhbmQgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNTAuODgxMTc1OTk0ODczMDUsLTExNi4zNjk2MDYwMTgwNjY0LDM0NC41MzU5NDk3MDcwMzEyNSk7DQogICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMTAwIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBMcGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIk9uZSBmb3IgQWxsIFtTdGFnZSAzXSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBpIDw9IDYgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlLlVzZVN0b3JhZ2VFeHRyYTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4wMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJSb2xhbmQiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuSXRlbTI6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSBhbmQgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJPbmUgZm9yIEFsbCBbU3RhZ2UgM10iIHRoZW4gdGFzay53YWl0KDAuMTIpOw0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTUwLjg4MTE3NTk5NDg3MzA1LC0xMTYuMzY5NjA2MDE4MDY2NCwzNDQuNTM1OTQ5NzA3MDMxMjUpOw0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtIik6V2FpdEZvckNoaWxkKCJPRkEiKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjUpOw0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZDpFcXVpcFRvb2woTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpKTsNCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJVc2VJdGVtIik6V2FpdEZvckNoaWxkKCJPRkEiKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIik6QWN0aXZhdGUoKTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbSIpOldhaXRGb3JDaGlsZCgiT0ZBIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW0yOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuSXRlbTI6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKS5DRnJhbWU7DQogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnMod29ya3NwYWNlLkl0ZW0yWyJPQSdzIEdyYWNlIl06R2V0RGVzY2VuZGFudHMoKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5Ib2xkRHVyYXRpb24gPSAwO3Y6SW5wdXRIb2xkQmVnaW4oKTt2OklucHV0SG9sZEVuZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW06RmluZEZpcnN0Q2hpbGQoIkdsb3ZlcyIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW06RmluZEZpcnN0Q2hpbGQoIkdsb3ZlcyIpLkNGcmFtZTsNCiAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyh3b3Jrc3BhY2UuSXRlbVsiR2xvdmVzIl06R2V0RGVzY2VuZGFudHMoKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHY6SXNBKCJQcm94aW1pdHlQcm9tcHQiKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdi5Ib2xkRHVyYXRpb24gPSAwO3Y6SW5wdXRIb2xkQmVnaW4oKTt2OklucHV0SG9sZEVuZCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIExwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcjsNCiAgICAgICAgICAgICAgICBpZiBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKSBhbmQgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJSb2xhbmQiKSBhbmQgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDNdIiBvciBMcGxheWVyLlBsYXllckd1aS5JbkNvbWJhdC5FbmFibGVkIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJPbmUgZm9yIEFsbCBbU3RhZ2UgNF0iIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggPSAwOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpICAgIA0KZW5kDQoNCmdldGdlbnYoKS5Vc2luZ0Rla3VBdXRvZmFybTIgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTIgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gMzN9Ow0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlF1ZXN0UmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiQWNjZXB0UXVlc3QiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSAzM307DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiUXVlc3RSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJDbGFpbVF1ZXN0Iik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOyAgICAgICAgICAgIA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MiA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZm9yIF8seCBpbiBwYWlycyh3b3Jrc3BhY2UuTGl2aW5nOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmICh4Lk5hbWUgPT0gIkJ5Z29uZSIgb3IgeC5OYW1lID09ICJBbmdlbGljYSIgb3IgeC5OYW1lID09ICJBbmdlbGljYVdlYWsiIG9yIHguTmFtZSA9PSAiQmxhY2tTaWxlbmNlIikgYW5kIHg6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgeC5IdW1hbm9pZC5IZWFsdGggPSAwOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UyID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIlJvbGFuZCIpIGFuZCBMcGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlID09ICJTaGlucmEgS3VzYWthYmUiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgaWYgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBSb2xhbmRIdW1hbm9pZCA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJSb2xhbmQiKS5IdW1hbm9pZA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgUm9sYW5kSHVtYW5vaWQgYW5kIFJvbGFuZEh1bWFub2lkLkhlYWx0aCB+PSBSb2xhbmRIdW1hbm9pZC5NYXhIZWFsdGggdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKXRhc2sud2FpdCg0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUm9sYW5kSHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIFJvbGFuZEJvc3MgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIik6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhSb2xhbmRCb3NzLlBvc2l0aW9uIC0gUm9sYW5kQm9zcy5DRnJhbWUubG9va1ZlY3RvciAqIDcsUm9sYW5kQm9zcy5Qb3NpdGlvbik7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIklnbml0aW9uIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQdW5jaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiRmllcmNlIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJDb3JuYSIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMuMTUpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UyID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKSBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoIH49IDAgYW5kIG5vdCB3b3Jrc3BhY2UuTGl2aW5nLkRla3UuQ0RWYWx1ZXM6RmluZEZpcnN0Q2hpbGQoIkJsb2NraW5nIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgRGVrdUh1bWFub2lkID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKS5IdW1hbm9pZA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgRGVrdUh1bWFub2lkIGFuZCBEZWt1SHVtYW5vaWQuSGVhbHRoIH49IERla3VIdW1hbm9pZC5NYXhIZWFsdGggdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWt1SHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIERla3VCb3NzID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIkRla3UiKTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KERla3VCb3NzLlBvc2l0aW9uIC0gRGVrdUJvc3MuQ0ZyYW1lLmxvb2tWZWN0b3IgKiA3LERla3VCb3NzLlBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiSWduaXRpb24iKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlB1bmNoIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU2hpbnJhUmVtb3RlIik6V2FpdEZvckNoaWxkKCJGaWVyY2UiKTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkNvcm5hIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMy4xNSk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlVzaW5nRGVrdUF1dG9mYXJtMyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZm9yIF8seCBpbiBwYWlycyh3b3Jrc3BhY2UuTGl2aW5nOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgIGlmICh4Lk5hbWUgPT0gIkJ5Z29uZSIgb3IgeC5OYW1lID09ICJBbmdlbGljYSIgb3IgeC5OYW1lID09ICJBbmdlbGljYVdlYWsiIG9yIHguTmFtZSA9PSAiQmxhY2tTaWxlbmNlIikgYW5kIHg6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgeC5IdW1hbm9pZC5IZWFsdGggPSAwOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjAxNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOw0KICAgICAgICAgICAgICAgIExwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNTAuODgxMTc1OTk0ODczMDUsLTExNi4zNjk2MDYwMTgwNjY0LDM0NC41MzU5NDk3MDcwMzEyNSk7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS4xNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyA9PSB0cnVlIGRvDQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiRGVrdSIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5MaXZpbmc6RmluZEZpcnN0Q2hpbGQoIlJvbGFuZCIpIGFuZCBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5CYWNrcGFjazpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIGFuZCBub3QgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTE2OS42Mjc4ODM5MTExMzI4LCA3OTAuNzY0NTI2MzY3MTg3NSwgLTgwMzYuODQyMjg1MTU2MjUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGksdiBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLk1hcC5SdWluZWRDaXR5OkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlByb3hpbWl0eVByb21wdCIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyZXByb3hpbWl0eXByb21wdCh2LDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UzID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJEZWt1IikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW0yOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikgYW5kIExwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDNdIiB0aGVuIHRhc2sud2FpdCgwLjQ1KTsNCiAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC01MC44ODExNzU5OTQ4NzMwNSwtMTE2LjM2OTYwNjAxODA2NjQsMzQ0LjUzNTk0OTcwNzAzMTI1KTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbSIpOldhaXRGb3JDaGlsZCgiT0ZBIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICB0YXNrLndhaXQoMC41KTsNCiAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6RXF1aXBUb29sKExwbGF5ZXIuQmFja3BhY2s6RmluZEZpcnN0Q2hpbGQoIk9BJ3MgR3JhY2UiKSk7DQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiVXNlSXRlbSIpOldhaXRGb3JDaGlsZCgiT0ZBIik6RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBMcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpOkFjdGl2YXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlVzZUl0ZW0iKTpXYWl0Rm9yQ2hpbGQoIk9GQSIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UzID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5JdGVtMjpGaW5kRmlyc3RDaGlsZCgiT0EncyBHcmFjZSIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkl0ZW0yOkZpbmRGaXJzdENoaWxkKCJPQSdzIEdyYWNlIikuQ0ZyYW1lOw0KICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKHdvcmtzcGFjZS5JdGVtMlsiT0EncyBHcmFjZSJdOkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiB2OklzQSgiUHJveGltaXR5UHJvbXB0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHYuSG9sZER1cmF0aW9uID0gMDt2OklucHV0SG9sZEJlZ2luKCk7djpJbnB1dEhvbGRFbmQoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UzID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBMcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXI7DQogICAgICAgICAgICAgICAgaWYgbm90IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTGl2aW5nOkZpbmRGaXJzdENoaWxkKCJEZWt1IikgYW5kIG5vdCBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZCgiUm9sYW5kIikgYW5kIExwbGF5ZXIuUGxheWVyR3VpLkluQ29tYmF0LkVuYWJsZWQgdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCA9IDA7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS4zNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyOw0KICAgICAgICAgICAgICAgIGlmIExwbGF5ZXIuUGxheWVyR3VpLkluQ29tYmF0LkVuYWJsZWQgYW5kIExwbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgPT0gIk9uZCBmb3IgYWxsIFtTdGFnZSAzXSIgb3IgTHBsYXllci5QbGF5ZXJHdWkuSW5Db21iYXQuRW5hYmxlZCBhbmQgTHBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiT25yIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuSGVhbHRoID0gMDsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgxLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Vc2luZ1Rva2Vuc1RvQ2FzaCA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9Db252ZXJ0VG9rZW5zID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlRva2VuLlZhbHVlID4gNTAwIGFuZCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLkNhc2guVmFsdWUgPCAyMDAwMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwyIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJUNEMifTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJUb2tlbkV4Y2hhbmdlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5TdGVhbGluZ09uZUZvckFsbCA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBQcm9tcHQgPSBmYWxzZTsNCg0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1N0ZWFsaW5nT2ZhID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU3RhbmRsZXNzIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxwbGF5ZXIuRGF0YS5NYXN0ZXJ5LlZhbHVlID09IDIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgd29ya3NwYWNlLk1hcC5OUENzOkZpbmRGaXJzdENoaWxkKCJLdXptYSIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuTWFwLk5QQ3MuS3V6bWE6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIkNsaWNrRGV0ZWN0b3IiKSB0aGVuIGZpcmVjbGlja2RldGVjdG9yKHYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAxLDE1IGRvIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTa2lwRGlhbG9ndWUgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuRGlhbG9ndWUuT3V0ZXIuSW5uZXIuVGV4dExhYmVsOw0KICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KFNraXBEaWFsb2d1ZS5BYnNvbHV0ZVBvc2l0aW9uLlgrU2tpcERpYWxvZ3VlLkFic29sdXRlU2l6ZS5YLzUsU2tpcERpYWxvZ3VlLkFic29sdXRlUG9zaXRpb24uWSs1MCwwLHRydWUsU2tpcERpYWxvZ3VlLDUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRNb3VzZUJ1dHRvbkV2ZW50KFNraXBEaWFsb2d1ZS5BYnNvbHV0ZVBvc2l0aW9uLlgrU2tpcERpYWxvZ3VlLkFic29sdXRlU2l6ZS5YLzUsU2tpcERpYWxvZ3VlLkFic29sdXRlUG9zaXRpb24uWSs1MCwwLGZhbHNlLFNraXBEaWFsb2d1ZSw1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgUHJvbXB0IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiDwn4y4IiwiV2FpdGluZyBmb3IgS3V6bWEgVG8gU3Bhd24iLDEuNSk7UHJvbXB0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgIA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBQcm9tcHQgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIk1hc3RlcnkgaXMgbm90IEVub3VnaCIsMS41KTtQcm9tcHQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IFByb21wdCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViIPCfjLgiLCJZb3UgYXJlIG5vdCBTdGFuZGxlc3MiLDEuNSk7UHJvbXB0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC40NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuU3RlYWxpbmdBbnlJdGVtID0gZnVuY3Rpb24oKQ0KICAgIGxvY2FsIEZsb2F0UGFydCA9IEluc3RhbmNlLm5ldygiUGFydCIsZ2FtZS5Xb3Jrc3BhY2UpOw0KICAgIEZsb2F0UGFydC5OYW1lID0gIkZsb2F0UGFydCINCiAgICBGbG9hdFBhcnQuU2l6ZSA9IFZlY3RvcjMubmV3KDYsMC4xLDYpOw0KICAgIEZsb2F0UGFydC5BbmNob3JlZCA9IHRydWUNCiAgICBGbG9hdFBhcnQuVHJhbnNwYXJlbmN5ID0gMQ0KICAgIA0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnZXRnZW52KCkuQXV0b1N0ZWFsaW5nSXRlbXMgPT0gZmFsc2UgdGhlbg0KICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZC5Sb290UGFydC5DRnJhbWUgPSBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkLlJvb3RQYXJ0LkNGcmFtZSAqIENGcmFtZS5uZXcoMCw4LDApOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQogICAgDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvU3RlYWxpbmdJdGVtcyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgaWYgZ2V0Z2VudigpLkZvdW5kQW55SXRlbSA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgRmxvYXRQYXJ0LkNGcmFtZSA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgKyBWZWN0b3IzLm5ldygwLC0zLjA1LDApOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMDEpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TdGVhbGluZ0l0ZW1zID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBmb3IgXyxqIGluIHBhaXJzKGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpOkdldFBsYXllcnMoKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgQ2hhciA9IGouQ2hhcmFjdGVyDQogICAgICAgICAgICAgICAgICAgIGlmIENoYXIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sbiBpbiBwYWlycyhDaGFyOkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbjpJc0EoIkJhc2VQYXJ0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLkNhbkNvbGxpZGUgPSBmYWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TdGVhbGluZ0l0ZW1zID09IHRydWUgZG8gDQogICAgICAgICAgICBsb2NhbCBDb25uZWMNCiAgICAgICAgICAgIENvbm5lYyA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQuU3RhdGVDaGFuZ2VkOkNvbm5lY3QoZnVuY3Rpb24oXyx6KQ0KICAgICAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvU3RlYWxpbmdJdGVtcyA9PSB0cnVlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkOlNldFN0YXRlRW5hYmxlZCgxLGZhbHNlKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgeiA9PSBFbnVtLkh1bWFub2lkU3RhdGVUeXBlLkZhbGxpbmdEb3duIG9yIHogPT0gRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5SYWdkb2xsIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWQ6Q2hhbmdlU3RhdGUoRW51bS5IdW1hbm9pZFN0YXRlVHlwZS5HZXR0aW5nVXApOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIENvbm5lYzpEaXNjb25uZWN0KCk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgIHRhc2sud2FpdCgwLjM1KTsNCiAgICAgICAgICAgIGlmIG5vdCBnZXRnZW52KCkuQXV0b1N0ZWFsaW5nSXRlbXMgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvU3RlYWxpbmdJdGVtcyA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyDQogICAgICAgICAgICAgICAgbG9jYWwgRm9sZGVyID0ge3dvcmtzcGFjZS5JdGVtLHdvcmtzcGFjZS5JdGVtMn07DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbG9jYWwgVW5pcXVlUGFydHNzID0ge30NCiAgICAgICAgICAgICAgICBnZXRnZW52KCkuRm91bmRBbnlJdGVtID0gZmFsc2U7DQoNCiAgICAgICAgICAgICAgICBmb3IgXyxrIGluIGlwYWlycyhGb2xkZXIpIGRvDQogICAgICAgICAgICAgICAgICAgIGZvciBfLGsgaW4gaXBhaXJzKGs6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6SXNBKCJCYXNlUGFydCIpIGFuZCBrLk5hbWUgfj0gIlNvdWxTcGF3biIgYW5kIGsuTmFtZSB+PSAiUGVyY2VwdGlvbk1hc2siIGFuZCBrLlBvc2l0aW9uIH49IFZlY3RvcjMubmV3KDE4MDQuNTM5MDYyNSwtMjk4LjE3MzU4Mzk4NDM3NSwtMzA5LjQ2NDk2NTgyMDMxMjUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoKGsuTmFtZTpzdWIoMSwyKSA9PSAiQm8iIG9yIGsuTmFtZTpzdWIoMSwzKSA9PSAiU2VjIikgYW5kIGs6RmluZEZpcnN0Q2hpbGQoIk91dGxpbmUiKSkgb3IgKChrLk5hbWU6c3ViKDEsMikgfj0gIkJvIiBhbmQgay5OYW1lOnN1YigxLDMpIH49ICJTZWMiKSBhbmQgbm90IGs6RmluZEZpcnN0Q2hpbGQoIk91dGxpbmUiKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgKChMcGxheWVyLkRhdGEuTWFzdGVyeS5WYWx1ZSA9PSAwIGFuZCBrLk5hbWUgPT0gIlN1a3VuYUZpbmdlciIpIG9yIChMcGxheWVyLkRhdGEuTWFzdGVyeS5WYWx1ZSA9PSAwIGFuZCBrLk5hbWUgPT0gIkhvZ3lva3VGcmFnbWVudCIpIG9yIChMcGxheWVyLkRhdGEuTWFzdGVyeS5WYWx1ZSA9PSAxIGFuZCBMcGxheWVyLkRhdGEuTWFzdGVyeS5WYWx1ZSA9PSAyIGFuZCBrLk5hbWUgPT0gIk9BJ3MgR3JhY2UiKSkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsuTmFtZSB+PSAiQm94IiBhbmQgay5OYW1lIH49ICJCYXJyZWwiIGFuZCBrLk5hbWUgfj0gIkNoZXN0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChVbmlxdWVQYXJ0c3Msayk7Z2V0Z2VudigpLkZvdW5kQW55SXRlbSA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbG9jYWwgZnVuY3Rpb24gVGVsZXBvcnRUbyhQYXJ0cykNCiAgICAgICAgICAgICAgICAgICAgaWYgI1BhcnRzID4gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBTZWxlY3RlZCA9IFBhcnRzW21hdGgucmFuZG9tKDEsI1BhcnRzKV07DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBTZWxlY3RlZCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXI6U2V0UHJpbWFyeVBhcnRDRnJhbWUoQ0ZyYW1lLm5ldyhTZWxlY3RlZC5Qb3NpdGlvbiAtIFZlY3RvcjMubmV3KDAsOCwwKSkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmICNVbmlxdWVQYXJ0c3MgPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgVGVsZXBvcnRUbyhVbmlxdWVQYXJ0c3MpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlBpY2tBdXJhQW55SXRlbSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9QaWNraW5nSXRlbXMgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIEZvbGRlcnMgPSB7d29ya3NwYWNlLkl0ZW0sd29ya3NwYWNlLkl0ZW0yfTsNCiAgICAgICAgICAgICAgICBmb3IgaSx2IGluIHBhaXJzKEZvbGRlcnMpIGRvDQogICAgICAgICAgICAgICAgICAgIGZvciBpLHYgaW4gcGFpcnModjpHZXREZXNjZW5kYW50cygpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgdjpJc0EoIlByb3hpbWl0eVByb21wdCIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2LkhvbGREdXJhdGlvbiA9IDA7djpJbnB1dEhvbGRCZWdpbigpO3Y6SW5wdXRIb2xkRW5kKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4yNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuVXNpbmdTYWZlWm9uZSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9TYWZlWm9uZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTYzNy43MzU5MDA4Nzg5MDYyLC0zMy4zOTMwMzU4ODg2NzE4NzUsMTAzMS45MzM3MTU4MjAzMTI1KTsNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgyLjM1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5PbmVTaG90QW55Qm9zc0FuZE1vYiA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgY29ubmVjdGlvbg0KICAgICAgICBjb25uZWN0aW9uID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikuUmVuZGVyU3RlcHBlZDpDb25uZWN0KGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIGlmIGdldGdlbnYoKS5BdXRvT25lU2hvdHRpbmcgPT0gdHJ1ZSB0aGVuDQogICAgICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgXyxrIGluIGlwYWlycyh3b3Jrc3BhY2UuTGl2aW5nOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiTW9kZWwiKSBhbmQgazpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIGFuZCBrLkhlYWQgfj0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnM6R2V0UGxheWVyRnJvbUNoYXJhY3RlcihrKSA9PSBuaWwgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoay5IZWFkLlBvc2l0aW9uIC0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkLlBvc2l0aW9uKS5tYWduaXR1ZGUgPD0gOWU5IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGs6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpLkhlYWx0aCB+PSBrOkZpbmRGaXJzdENoaWxkT2ZDbGFzcygiSHVtYW5vaWQiKS5NYXhIZWFsdGggdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGs6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJIdW1hbm9pZCIpLkhlYWx0aCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGNvbm5lY3Rpb246RGlzY29ubmVjdCgpOw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkF1dG9mYXJtTmVhcmVzdE1vYiA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9LaWxsTmVhcmVzdE1vYiA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgSWdub3JlU2hpdCA9IHsiQXR0YWNraW5nIER1bW15IiwiRHVtbXkiLCJDb3VudGVyIER1bW15IiwiQmxvY2tpbmcgRHVtbXkiLCJUb3VnaCBEdW1teSIsIkNoYXJpb3QgUmVxdWllbSIsIkJhbmRpdCIsIlRodWcifTsgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgZm9yIF8sayBpbiBpcGFpcnMod29ya3NwYWNlLkxpdmluZzpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICBpZiBrOklzQSgiTW9kZWwiKSBhbmQgazpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIGFuZCBrLkhlYWQgfj0gZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IZWFkIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVyczpHZXRQbGF5ZXJGcm9tQ2hhcmFjdGVyKGspID09IG5pbCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHRhYmxlLmZpbmQoSWdub3JlU2hpdCxrLk5hbWUpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGsuSGVhZC5Qb3NpdGlvbiAtIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbikubWFnbml0dWRlIDw9IDllOSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnNbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgSHVtID0gazpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIEh1bSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KEh1bS5Qb3NpdGlvbiAtIEh1bS5DRnJhbWUubG9va1ZlY3RvciAqIDUsSHVtLlBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF0dGFja2luZygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzLjE1KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5CYW5uZXJSb2xsaW5nID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1JvbGxCYW5uZXIgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7Z2V0Z2VudigpLldoaWNoVHlwZSwiQXJyb3dPZk5vdmFlIn07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkJhbm5lclB1bGwiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS4yNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQ2lkQmFubmVyUm9sbGluZyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9Sb2xsQ2lkQmFubmVyID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge2dldGdlbnYoKS5XaGljaFR5cGUsIlRoZVNoYWRvd0dhcmRlbiJ9Ow0KICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJCYW5uZXJQdWxsIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDEuMjUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkthaWp1QmFubmVyUm9sbGluZyA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9Sb2xsS2FpanVCYW5uZXIgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7Z2V0Z2VudigpLldoaWNoVHlwZSwiS2FpanVOby44In07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkJhbm5lclB1bGwiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMS4yNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuUm9sbERlYXRoQmFubmVyID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1JvbGxEZWF0aHMgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7DQogICAgWzFdID0gIlRva2VuIjsNCn0NCg0KZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlB1cmNoYXNlRGVhdGhBbmltIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpIA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuNDUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLlJvbGxBcmNhZGVCYW5uZXIgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvUm9sbEFyY2FkZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSBmYWxzZSxbMl0gPSBmYWxzZX07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIkFyY2FkZVB1cmNoYXNlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOyAgICAgICAgICAgICANCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjEpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkJyZWFrdGhyb3VnaEZvclRva2VuID0gZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b0I0VCA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSAiQjRUIn07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlRva2VuRXhjaGFuZ2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC43NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQnJlYWt0aHJvdWdoRm9yU3RvcmFnZSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9CNFMgPT0gdHJ1ZSBkbw0KICAgICAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIlN0b3JhZ2UifTsNCiAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCUFB1cmNoYXNlIik6V2FpdEZvckNoaWxkKCJQdXJjaGFzZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsgICAgICAgICAgICAgIA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuNzUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQNCg0KZ2V0Z2VudigpLkJyZWFrdGhyb3VnaEZvclByZXNlbnQgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvQjRUID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJQcmVzZW50In07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiQlBQdXJjaGFzZSIpOldhaXRGb3JDaGlsZCgiUHVyY2hhc2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC43NSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuQnJlYWt0aHJvdWdoRm9yQ2FwYWNpdHkgPSBmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvQjRDID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICJDYXNoIn07DQogICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiQlBQdXJjaGFzZSIpOldhaXRGb3JDaGlsZCgiUHVyY2hhc2UiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7ICAgICAgICAgICAgICANCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjc1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5RdWVzdFBhcnJ5RGFtYWdlID0gZnVuY3Rpb24oKQ0KICAgIGlmIGdldGdlbnYoKS5BdXRvUGFycnlpbmdEYW1hZ2UgPT0gdHJ1ZSB0aGVuDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiU3RhcnRlckd1aSIpOlNldENvcmVHdWlFbmFibGVkKEVudW0uQ29yZUd1aVR5cGUuQ2hhdCxmYWxzZSk7DQogICAgZWxzZQ0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkNoYXQsdHJ1ZSk7DQogICAgZW5kDQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClsb2NhbCBCbG9ja2luZyA9IGZhbHNlOw0KICAgICAgICB3aGlsZSBnZXRnZW52KCkuQXV0b1BhcnJ5aW5nRGFtYWdlID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBBdHRhY2tpbmdEdW1teSA9IGdhbWUuV29ya3NwYWNlLkxpdmluZ1siQXR0YWNraW5nIER1bW15Il07DQogICAgICAgICAgICAgICAgbG9jYWwgQmxvY2tCYXIgPSB0b251bWJlcihnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlN0YXRzLkJHLkJsb2NrQkcuQmxvY2tCYXIuQmxvY2tOLlRleHQpOw0KICAgICAgICAgICAgICAgIGxvY2FsIFBhcnJ5Q29vbGRvd24gPSBnYW1lLldvcmtzcGFjZS5MaXZpbmdbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNEVmFsdWVzOkZpbmRGaXJzdENoaWxkKCJQYXJyeV9Db29sZG93biIpOw0KDQogICAgICAgICAgICAgICAgaWYgQmxvY2tCYXIgPT0gMzAgYW5kIG5vdCBCbG9ja2luZyBhbmQgbm90IFBhcnJ5Q29vbGRvd24gdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lLlZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIkYiLGZhbHNlLGdhbWUpO3Rhc2sud2FpdCgwLjUpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KEF0dGFja2luZ0R1bW15Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBBdHRhY2tpbmdEdW1teS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Mb29rVmVjdG9yICogLTUsQXR0YWNraW5nRHVtbXkuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbik7QmxvY2tpbmcgPSB0cnVlDQogICAgICAgICAgICAgICAgZWxzZWlmIEJsb2NrQmFyIDwgMzAgYW5kIEJsb2NraW5nIGFuZCBub3QgUGFycnlDb29sZG93biB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIkYiLGZhbHNlLGdhbWUpO0Jsb2NraW5nID0gZmFsc2UNCiAgICAgICAgICAgICAgICBlbmQNCg0KICAgICAgICAgICAgICAgIGlmIFBhcnJ5Q29vbGRvd24gdGhlbg0KICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMjEyMi4yMTA2OTMzNTkzNzUsLTExMy45ODU0MjAyMjcwNTA3OCwtNDYzNS41OTEzMDg1OTM3NSk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4xNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuUXVlc3RCbG9ja0RhbWFnZSA9IGZ1bmN0aW9uKCkNCiAgICBpZiBnZXRnZW52KCkuQXV0b0Jsb2NraW5nRGFtYWdlID09IHRydWUgdGhlbg0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkNoYXQsZmFsc2UpOw0KICAgIGVsc2UNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZUd1aUVuYWJsZWQoRW51bS5Db3JlR3VpVHlwZS5DaGF0LHRydWUpOw0KICAgIGVuZA0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpbG9jYWwgQmxvY2tpbmcgPSBmYWxzZTsNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9CbG9ja2luZ0RhbWFnZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgQXR0YWNraW5nRHVtbXkgPSBnYW1lLldvcmtzcGFjZS5MaXZpbmdbIkF0dGFja2luZyBEdW1teSJdOw0KICAgICAgICAgICAgICAgIGxvY2FsIEJsb2NrQmFyID0gdG9udW1iZXIoZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGF0cy5CRy5CbG9ja0JHLkJsb2NrQmFyLkJsb2NrTi5UZXh0KTsNCiAgICANCiAgICAgICAgICAgICAgICBpZiBCbG9ja0JhciA9PSAzMCBhbmQgbm90IEJsb2NraW5nIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCJGIixmYWxzZSxnYW1lKTt0YXNrLndhaXQoMC41KTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhBdHRhY2tpbmdEdW1teS5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gQXR0YWNraW5nRHVtbXkuSHVtYW5vaWRSb290UGFydC5DRnJhbWUuTG9va1ZlY3RvciAqIC01LEF0dGFja2luZ0R1bW15Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pO0Jsb2NraW5nID0gdHJ1ZQ0KICAgICAgICAgICAgICAgIGVsc2VpZiBCbG9ja0JhciA8PSA4IGFuZCBCbG9ja2luZyB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdhbWUuVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQoZmFsc2UsIkYiLGZhbHNlLGdhbWUpO0Jsb2NraW5nID0gZmFsc2U7dGFzay53YWl0KDAuMTUpOw0KICAgICAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMjEyMi4yMTA2OTMzNTkzNzUsLTExMy45ODU0MjAyMjcwNTA3OCwtNDYzNS41OTEzMDg1OTM3NSk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4yNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuUXVlc3REZWF0aERhbWFnZSA9IGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgd2hpbGUgZ2V0Z2VudigpLkF1dG9EeWluZ0RhbWFnZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgQXR0YWNraW5nRHVtbXkgPSBnYW1lLldvcmtzcGFjZS5MaXZpbmdbIkF0dGFja2luZyBEdW1teSJdOw0KICAgICAgICAgICAgICAgIGdhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KEF0dGFja2luZ0R1bW15Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24gLSBBdHRhY2tpbmdEdW1teS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Mb29rVmVjdG9yICogLTUsQXR0YWNraW5nRHVtbXkuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbik7dGFzay53YWl0KDEuNSk7DQoNCiAgICAgICAgICAgICAgICBpZiB3b3Jrc3BhY2UuTGl2aW5nW2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5OYW1lXTpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWQiKS5NYXhIZWFsdGggfj0gd29ya3NwYWNlLkxpdmluZ1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV06RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkIikuSGVhbHRoIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSAia2lsbCJ9Ow0KICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJHbG9iYWxVc2VkUmVtb3RlcyIpOldhaXRGb3JDaGlsZCgiU3VrdW5hRGlhbG9ndWUiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4yNSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQpnZXRnZW52KCkuUXVlc3RUYWtlRGFtYWdlID0gZnVuY3Rpb24oKQ0KICAgIGlmIGdldGdlbnYoKS5BdXRvVGFraW5nRGFtYWdlID09IHRydWUgdGhlbg0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkNoYXQsZmFsc2UpOw0KICAgIGVsc2UNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZUd1aUVuYWJsZWQoRW51bS5Db3JlR3VpVHlwZS5DaGF0LHRydWUpOw0KICAgIGVuZA0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvVGFraW5nRGFtYWdlID09IHRydWUgZG8NCiAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBDb3VudGVyRHVtbXkgPSBnYW1lLldvcmtzcGFjZS5MaXZpbmdbIkNvdW50ZXIgRHVtbXkiXTsNCiAgICAgICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhDb3VudGVyRHVtbXkuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIENvdW50ZXJEdW1teS5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZS5Mb29rVmVjdG9yICogLTUsQ291bnRlckR1bW15Lkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pOw0KICAgICAgICAgICAgICAgIGlmIGdhbWUuUGxheWVyc1tnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZV0uQ2hhcmFjdGVyLkh1bWFub2lkLkhlYWx0aCB+PSAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZ2V0Z2VudigpLkF0dGFja2luZygpOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgdGFzay53YWl0KDMuMTUpOw0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kKQ0KICAgICAgICAgICAgdGFzay53YWl0KDAuMTUpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQgDQoNCmdldGdlbnYoKS5RdWVzdERlYWxEYW1hZ2UgPSBmdW5jdGlvbigpDQogICAgaWYgZ2V0Z2VudigpLkF1dG9EZWFsaW5nRGFtYWdlID09IHRydWUgdGhlbg0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlN0YXJ0ZXJHdWkiKTpTZXRDb3JlR3VpRW5hYmxlZChFbnVtLkNvcmVHdWlUeXBlLkNoYXQsZmFsc2UpOw0KICAgIGVsc2UNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJTdGFydGVyR3VpIik6U2V0Q29yZUd1aUVuYWJsZWQoRW51bS5Db3JlR3VpVHlwZS5DaGF0LHRydWUpOw0KICAgIGVuZA0KDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvRGVhbGluZ0RhbWFnZSA9PSB0cnVlIGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgRHVtbXkgPSBnYW1lLldvcmtzcGFjZS5MaXZpbmdbIkR1bW15Il07DQogICAgICAgICAgICAgICAgZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoRHVtbXkuSHVtYW5vaWRSb290UGFydC5Qb3NpdGlvbiAtIER1bW15Lkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lLkxvb2tWZWN0b3IgKiAtNSxEdW1teS5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uKTsNCiAgICAgICAgICAgICAgICBpZiBnYW1lLlBsYXllcnNbZ2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLk5hbWVdLkNoYXJhY3Rlci5IdW1hbm9pZC5IZWFsdGggfj0gMCB0aGVuDQogICAgICAgICAgICAgICAgICAgIGdldGdlbnYoKS5BdHRhY2tpbmcoKTsNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIHRhc2sud2FpdCgzLjE1KTsNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHRhc2sud2FpdCgwLjE1KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kDQoNCmdldGdlbnYoKS5Mb2FkQ29uZmlndXJhdGlvbnMoKTsNCmxvY2FsIE1haW5XaW5kb3cgPSBEclJheUxpYnJhcnk6TG9hZCgiU2FrdXJhIEh1YiAgIPCfjLgiLCJEZWZhdWx0Iik7DQpsb2NhbCBIb21lVGFiID0gRHJSYXlMaWJyYXJ5Lm5ld1RhYigiSG9tZSIsImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9OTQwNTkyMzY4NyIpOw0KDQotLSAvLyBBcHBseSBDdXN0b20gVUkgQ29sb3IgXFwgLS0NCmdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5LlRvcEJhci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygxMjgsMCwxMjgpOw0KZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXkuTWFpbkJhci5CYWNrZ3JvdW5kQ29sb3IzID0gQ29sb3IzLm5ldygwLDAsMCk7DQpnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5EclJheS5Ub3BCYXIuVG9wQmFyLkJhY2tncm91bmRDb2xvcjMgPSBDb2xvcjMubmV3KDAsMCwwKTsNCmdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5LlRvcEJhci5Qcm9maWxlTWVudS5DbG9jay5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC43NTsNCmdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5LlRvcEJhci5Qcm9maWxlTWVudS5QbGF5ZXJQcm9maWxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjc1Ow0KZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXkuVG9wQmFyLlByb2ZpbGVNZW51LlRpdGxlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjc1Ow0KZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXkuVG9wQmFyLlRvcEJhckNsb3NlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAwLjU1Ow0KZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXkuVG9wQmFyLlRvcEJhckNsb3NlLmlkay5WaXNpYmxlID0gZmFsc2U7DQoNCi0tIC8vIExvYWRlZCBOb3RpZmljYXRpb24gXFwgLS0NCkJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIkN1cnJlbnQgVmVyc2lvbjogIi4uZ2V0Z2VudigpLkN1cnJlbnRWZXJzaW9uLDguMCk7DQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1bWyBNYWluIFNvdXJjZSBDb2RlIPCfkp4gXV0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCkhvbWVUYWIubmV3TGFiZWwoIlNjcmlwdCBIdWIgQ3JlZGl0cyAgIOKchDGkNzHvv4QxpDc3McKkNyIpOw0KSG9tZVRhYi5uZXdCdXR0b24oIlNjcmlwdCBNYWRlIGJ5IEZsYW1lcyBDb250aW51ZSBCeSBCJk0iLCIiLGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBDaGVlcnMgPSAiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0xNjE3NjI0MjIzIg0KICAgIGxvY2FsIFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpO1NvdW5kLk5hbWUgPSAiU291bmQiO1NvdW5kLlNvdW5kSWQgPSBDaGVlcnMNCiAgICBTb3VuZC5Wb2x1bWUgPSAxMDtTb3VuZC5Mb29wZWQgPSBmYWxzZTtTb3VuZC5BcmNoaXZhYmxlID0gZmFsc2U7U291bmQuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2U7U291bmQ6UGxheSgpOw0KICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIgICDwn4y4IiwiVGhhbmsgeW91IE1vbW15IEZsYW1lcyA8MyIsMS41KTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiTG9jYWwgUGxheWVyIFNjcmlwdHMgICDwn5OiIik7DQpIb21lVGFiLm5ld1RvZ2dsZSgiV2Fsa3NwZWVkIiwiIixnZXRnZW52KCkuV2Fsa3NwZWVkQnlwYXNzIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5XYWxrc3BlZWRCeXBhc3MgPSBWYWx1ZQ0KDQogICAgLS0gR290IEZyb20gaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0VkZ2VJWS9pbmZpbml0ZXlpZWxkL21hc3Rlci9zb3VyY2UNCiAgICBnZXRnZW52KCkuU3VwZXJTcGVlZCgpOw0KZW5kKQ0KDQpIb21lVGFiLm5ld1RvZ2dsZSgiSnVtcFBvd2VyIiwiIixnZXRnZW52KCkuSnVtcFBvd2VyQnlwYXNzIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5KdW1wUG93ZXJCeXBhc3MgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdXBlckp1bXAoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIlJlc2V0IENoYXJhY3RlciIsIiIsZnVuY3Rpb24oKQ0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKWxvY2FsIFJldHVybkFmdGVyRGVhdGggPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpIHJlcGVhdCB0YXNrLndhaXQoMSkgdW50aWwgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gUmV0dXJuQWZ0ZXJEZWF0aCBlbmQpDQogICAgbG9jYWwgYXJncyA9IHtbMV0gPSAia2lsbCJ9Ow0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkdsb2JhbFVzZWRSZW1vdGVzIik6V2FpdEZvckNoaWxkKCJTdWt1bmFEaWFsb2d1ZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIlJlc3Bhd24gQ2hhcmFjdGVyIChWb2lkIE1ldGhvZCkiLCJHZXRzIHJpZCBvZiBjb21iYXQgbWFyayIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcg0KICAgICAgICBsb2NhbCBIUlAgPSBMcGxheWVyLkNoYXJhY3RlciBhbmQgTHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQ0KICAgICAgICBpZiBub3QgSFJQIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGxvY2FsIExvY2F0aW9uID0gSFJQLkNGcmFtZQ0KICAgICAgICBsb2NhbCBwb3MgPSBMb2NhdGlvbi5Qb3NpdGlvbg0KICAgICAgICBIUlAuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyhwb3MuWCwgLTExNDcsIHBvcy5aKQ0KCQl0YXNrLndhaXQoMC4xNSkNCiAgICAgICAgLS1McGxheWVyLkNoYXJhY3RlckFkZGVkOldhaXQoKQ0KICAgICAgICByZXBlYXQgdGFzay53YWl0KDAuMDE1KSB1bnRpbCBMcGxheWVyLkNoYXJhY3RlciBhbmQgTHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQ0KICAgICAgICB0YXNrLndhaXQoMC4zNSkNCiAgICAgICAgSFJQID0gTHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKQ0KICAgICAgICBpZiBIUlAgdGhlbg0KICAgICAgICAgICAgSFJQLkNGcmFtZSA9IExvY2F0aW9uDQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIkluc3RhIFJlc3Bhd24gQ2hhcmFjdGVyIiwiIixmdW5jdGlvbigpDQogICAgZ2V0Z2VudigpLkd1aWxkTmFtZSA9ICJIZXJyc2NoZXIgb2YgdGhlIFZvaWQncyBBcm15IjsNCiAgICBnZXRnZW52KCkuUGFzc3dvcmQgPSAiMjAwMCI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgbG9jYWwgTHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcg0KICAgICAgICAgICAgbG9jYWwgTG9jYXRpb24gPSBMcGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZQ0KICAgICAgICAgICAgbG9jYWwgR3VpbGQgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkxpdmluZzpGaW5kRmlyc3RDaGlsZChMcGxheWVyLk5hbWUpLkhlYWQ6RmluZEZpcnN0Q2hpbGQoIkd1aWxkR1VJIik7DQogICAgICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9IEd1aWxkIGFuZCBHdWlsZC5UZXh0LlRleHQgPT0gZ2V0Z2VudigpLkd1aWxkTmFtZSBhbmQgIkxlYXZlIiBvciAiSm9pbiIsWzJdID0gZ2V0Z2VudigpLkd1aWxkTmFtZSxbM10gPSBnZXRnZW52KCkuUGFzc3dvcmQsWzRdID0gIiJ9Ow0KICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiR2xvYmFsVXNlZFJlbW90ZXMiKTpXYWl0Rm9yQ2hpbGQoIlNldEd1aWxkIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KDQogICAgICAgICAgICBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6V2FpdCgpOw0KDQogICAgICAgICAgICByZXBlYXQgdGFzay53YWl0KDAuMDE1KSB1bnRpbCBMcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpO3Rhc2sud2FpdCgwLjM1KTsNCg0KICAgICAgICAgICAgTHBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBMb2NhdGlvbjsNCiAgICAgICAgZW5kKQ0KICAgIGVuZCkNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiVmlzdWFsIFNjcmlwdHMgICDwn5GB77iEMaQ3Me+/hDGkNzcxwqQ3Iik7DQpIb21lVGFiLm5ld1RvZ2dsZSgiRXNwIFBsYXllcnMiLCIiLGdldGdlbnYoKS5Fc3BQbGF5ZXJzIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5Fc3BQbGF5ZXJzID0gVmFsdWUNCiAgICBnZXRnZW52KCkuRXNwT25QbGF5ZXJzKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJFc3AgRW50aXRpZXMiLCIiLGdldGdlbnYoKS5Fc3BFbnRpdGllcyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuRXNwRW50aXRpZXMgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Fc3BPbkVudGl0aWVzKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJFc3AgSXRlbXMiLCIiLGdldGdlbnYoKS5Fc3BJdGVtcyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuRXNwSXRlbXMgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Fc3BPbkl0ZW1zKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJFc3AgTnBjcyIsIiIsZ2V0Z2VudigpLkVzcE5wY3Mgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkVzcE5wY3MgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Fc3BPbk5wY3MoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiU291bmQgU2NyaXB0cyAgIPCflIoiKTsNCkhvbWVUYWIubmV3VG9nZ2xlKCJEZWt1J3MgVGhlbWUiLCIiLGdldGdlbnYoKS5BdXRvRGVrdVRoZW1lIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvRGVrdVRoZW1lID0gVmFsdWUNCiAgICBnZXRnZW52KCkuQWN0aXZhdGVEZWt1VGhlbWUoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkNvbXBhc3MgVGhlbWUiLCIiLGdldGdlbnYoKS5BdXRvQ29tcGFzc1RoZW1lIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvQ29tcGFzc1RoZW1lID0gVmFsdWUNCiAgICBnZXRnZW52KCkuQWN0aXZhdGVDb21wYXNzVGhlbWUoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkJpbmFoJ3MgVGhlbWUiLCIiLGdldGdlbnYoKS5BdXRvQmluYWhUaGVtZSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0JpbmFoVGhlbWUgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5BY3RpdmF0ZUJpbmFoVGhlbWUoKTsgIA0KZW5kKQ0KDQpIb21lVGFiLm5ld1RvZ2dsZSgiUm9sYW5kJ3MgVGhlbWUiLCIiLGdldGdlbnYoKS5BdXRvUm9sYW5kVGhlbWUgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9Sb2xhbmRUaGVtZSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkFjdGl2YXRlUm9sYW5kVGhlbWUoKTsgICAgDQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJDaWRzJ3MgVGhlbWUiLCIiLGdldGdlbnYoKS5BdXRvQ2lkVGhlbWUgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9DaWRUaGVtZSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkFjdGl2YXRlQ2lkVGhlbWUoKTsgICAgDQplbmQpDQoNCkhvbWVUYWIubmV3TGFiZWwoIk1pc2NlbGxhbmVvdXMgU2NyaXB0cyAgIPCfk4wiKTsNCkhvbWVUYWIubmV3VG9nZ2xlKCJBdXRvIEFpbWxvY2sgTmVhcmVzdCBQbGF5ZXIgKE92ZXJwb3dlcmVkKSIsIiIsZ2V0Z2VudigpLkF1dG9BaW1sb2NraW5nIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvQWltbG9ja2luZyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkFpbWxvY2tpbmdPblBsYXllcnMoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkF1dG8gUm9hc3QgRGVhZCBQbGF5ZXJzIChCZSBOZWFyIFRoZW0pIiwiIixnZXRnZW52KCkuQXV0b1JvYXN0aW5nIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUm9hc3RpbmcgPSBWYWx1ZQ0KDQogICAgLS0gLy8gVGhhbmtzIHRvIENoYXRHUFQgdGhlIGdvYXQNCiAgICBnZXRnZW52KCkuTW9ja2luZ1BsYXllcnMoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiRmlnaHRpbmcgU2NyaXB0cyAgIOKalO+4jyIpOw0KSG9tZVRhYi5uZXdUb2dnbGUoIkF1dG8gQ3RybCArIENsaWNrIENvbWJvIFBsYXllcnMgLyBNb2JzIiwiIixnZXRnZW52KCkuQXV0b1RlbGVwb3J0UHVuY2hpbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9UZWxlcG9ydFB1bmNoaW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuVGVsZXBvcnRIaXR0aW5nQmVoaW5kKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJBdXRvIFJlc3Bhd24gV2hlbiBMb3cgSGVhbHRoIiwiIixnZXRnZW52KCkuQXV0b1Jlc3Bhd25pbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9SZXNwYXduaW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuQXV0b0dvZE1vZGRpbmcoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkF1dG8gQ291bnRlciBBdHRhY2sgUGxheWVycyAvIE1vYnMgKFVzZSBTZGlvIG9yIEdvam8pIiwiIixnZXRnZW52KCkuQXV0b0RlZmVuZGluZyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0RlZmVuZGluZyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkRlZmVuZEFnYWluc3RNMXMoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkF1dG8gRGFzaCBQbGF5ZXJzIC8gTW9icyAoT3ZlcnBvd2VyZWQpIiwiIixnZXRnZW52KCkuQXV0b0Rhc2hpbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9EYXNoaW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuRG9kZ2VGcm9tQXR0YWNrcygpOw0KZW5kKQ0KDQpIb21lVGFiLm5ld1RvZ2dsZSgiQXV0byBEb2RnZSBQbGF5ZXJzIC8gTW9icyAg8J+UpSAoVXNlIEluIE9wZW4gQXJlYXMpIiwiIixnZXRnZW52KCkuQXV0b0RvZGdpbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9Eb2RnaW5nID0gVmFsdWUNCiAgICAgICAgDQogICAgLS0gLy8gVGFrZW4gZnJvbSBwcml2YXRlIHNjcmlwdCBvZiBtaW5lDQogICAgZ2V0Z2VudigpLlVzaW5nVWx0cmFJc3RpbmN0KCk7DQplbmQpDQoNCkhvbWVUYWIubmV3VG9nZ2xlKCJBdXRvIEJsb2NrIFdhcm5pbmcgQXR0YWNrcyAoT3ZlcnBvd2VyZWQpIiwiIixnZXRnZW52KCkuQXV0b0Jsb2NrV2FybmluZyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0Jsb2NrV2FybmluZyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkF1dG9CbG9ja2luZ1JlZEF0dGFja3MoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdUb2dnbGUoIkF1dG8gQnVnIFBsYXllcnMgLyBNb2JzIChSZXF1aXJlcyBHcmFiIE1vdmVzKSIsIiIsZ2V0Z2VudigpLkF1dG9HbGl0Y2hpbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9HbGl0Y2hpbmcgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Vc2luZ1ZvaWRPbk90aGVycygpOw0KZW5kKQ0KDQpIb21lVGFiLm5ld0xhYmVsKCJRdWljayBTY3JpcHRzICAg8J+agCIpOw0KSG9tZVRhYi5uZXdCdXR0b24oIkFuaW1hdGlvbiBHcmFiYmVyIiwiIixmdW5jdGlvbigpDQogICAgbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9NYXNIeXBlcmlvbi9TdWZmZXJUb3IvcmVmcy9oZWFkcy9tYWluL0dyYWJiZXIudHh0IikpKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3QnV0dG9uKCJJbmZpbml0ZSBZaWVsZCIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vRWRnZUlZL2luZmluaXRleWllbGQvbWFzdGVyL3NvdXJjZSIpKSgpOw0KZW5kKQ0KDQpIb21lVGFiLm5ld0J1dHRvbigiUmVtb3RlIFNweSIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vNzhuL1NpbXBsZVNweS9tYWluL1NpbXBsZVNweVNvdXJjZS5sdWEiKSkoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIkRhcmsgRXhwbG9yZXIiLCIiLGZ1bmN0aW9uKCkNCiAgICBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2luZnlpZmYvYmFja3VwL21haW4vZGV4Lmx1YSIpKSgpOw0KZW5kKQ0KDQpIb21lVGFiLm5ld0J1dHRvbigiVGVsZXBvcnQgTWFrZXIiLCIiLGZ1bmN0aW9uKCkNCiAgICBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgiaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L0dTZ1VDSm1xIikpKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3QnV0dG9uKCJHb29kIFVuaXZlcnNhbCIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KCJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTVNUVE9QUEVSL1NjcmlwdHMvcmVmcy9oZWFkcy9tYWluL0NhcHlIdWIiKSkoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiU2FrdXJhIEh1YiBTdHVmZiAg8J+MuCIpOw0KSG9tZVRhYi5uZXdUb2dnbGUoIlNha3VyYSBIdWIsIEdvIFJhaW5ib3cgUGxlYXNlIiwiIixnZXRnZW52KCkuQXV0b0dvaW5nUmFpbmJvdyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0dvaW5nUmFpbmJvdyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlVzaW5nUmFpbmJvd1VJKCk7DQplbmQpDQoNCkhvbWVUYWIubmV3QnV0dG9uKCJTYWt1cmEgSHViIENoYW5nZWxvZ3MgR1VJIiwiIixmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAg8J+MuCIsIkxvYWRpbmcgQ2hhbmdlbG9ncy4uLiIsMC43NSk7ZW5kKQ0KDQogICAgbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Mdmw5OTk5L3NzL21haW4vQ2hhbmdlbG9ncyIpKSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDIuMykiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBGaXhlZCBidWcgb24gZGVrdSBmYXJtIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgZGVrdTIgY2FuIG5vdyBiZSB1c2UuIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgbmV3IHRwIHBvaW50cy4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBSZW1vdmVkIHNvbWUgZnVuY3Rpb24uIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgc2VjcmV0IGZ1bmN0aW9uIGZvciBNIik7DQogICAgZ2V0Z2VudigpLkFkZExpbmUoKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlJlY2VudCBDaGFuZ2VzOiAoVmVyc2lvbiAxLjI5OTApIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gUmVtb3ZlZCB0aGUgbGFnZ3kgYW50aWZhbGwsIE1hZGUgc29tZXRoaW5nIGVsc2UgaW5zdGVhZC4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCB1bHRyYSBpbnN0aW5jdCBhdXJhIGFuZCBzb3VuZHMgdG8gYXV0byBkb2RnZS4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMjk5MSkiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBuZXcgbWV0aG9kIG9mIGZhcm1pbmcgKEFsdCBGYXJtaW5nKS4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMjk5MikiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBSZW1vdmVkIGF1dG8gYnVsbHkgbmVhcmVzdCAoSXQgd2FzIHVzZWxlc3MpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIFNvdW5kIHNjcmlwdHMgc2VjdGlvbi4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBXZWF0aGVyIHNjcmlwdHMgc2VjdGlvbi4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBNb3JlIHRlbGVwb3J0IGJ1dHRvbnMgaW4gdGhlIHNlY3Rpb24uIik7DQogICAgZ2V0Z2VudigpLkFkZExpbmUoKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlJlY2VudCBDaGFuZ2VzOiAoVmVyc2lvbiAxLjI5OTMpIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgUmVtb3RlcyBmb3IgdGhlIENvZGVzIChZb3UgY2FuIG5vdyBjbGFpbSB0aGVtKS4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBBdXRvIFJlcm9sbHMgU2VjdGlvbiAoRm9yIGdhbWJsZXJzKS4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBFeHBsYW5hdGlvbiBmb3IgQXV0b2Zhcm0uIik7DQogICAgZ2V0Z2VudigpLkFkZExpbmUoKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlJlY2VudCBDaGFuZ2VzOiAoVmVyc2lvbiAxLjI5OTQpIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQ2hhbmdlZCBhIGJpdCB0ZWxlcG9ydCBidXR0b25zIHBvc2l0aW9uLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIEF1dG8gU3BlbmQgQnJlYWt0aHJvdWdoIHNlY3Rpb24uIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgQXV0byBTcGF3biBCb3NzZXMgc2VjdGlvbiAoU29tZW9uZSBSZXF1ZXN0ZWQpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEN1c3RvbWl6ZWQgdGhlIGh1YiB0byBtYWtlIGl0IGEgYml0IG1vcmUgYXBwZWFsaW5nLiIpOw0KICAgIGdldGdlbnYoKS5BZGRMaW5lKCk7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJSZWNlbnQgQ2hhbmdlczogKFZlcnNpb24gMS4yOTk1KSIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEZpbm5hbHkgbWFkZSBhdXRvIHNwYXduIGZvciBkaW8gYnJhbmRvLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIE5vdyB5b3UgY2FuIHVzZSBhdXRvZmFybSB3aXRoIGFueSBzcGVjLCBNYXJrIG15IHdvcmRzIFNoaW5yYSBLdXNha2FiZSBpcyB0aGUgYmVzdCBzcGVjIGZvciBhdXRvZmFybS4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBGaXhlZCBub3RpZiBub3Qgc2hvd2luZyBvbiBwcml2YXRlIHNlcnZlciBlZGl0aW9uIGF1dG9mYXJtLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIFJldGV4dGVkIGJyZWFrdGhyb3VnaCBwb2ludCBzZWN0aW9uIGNhdXNlIEkgZGlkbnQgbGlrZSBpdC4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBSZW1vdmVkIEVxdWlwIGJlc3QgZmFybWluZyBzcGVjIGRyb3Bkb3duIGluc3RlYWQgaXRzIGEgYnV0dG9uLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIERyYWdvIGlkbGUgYW5pbWF0aW9uIHRvIGF1dG8gZG9kZ2UgY3VzIGNvb2wgaSB0aGluay4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMjk5NikiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBhdXRvIHN0b3JlIGZlYXR1cmUgZm9yIEJpbmFoJ3MgaXRlbSAoVGhlIHNlY3JldCBzcGVjKS4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBSZXRleHRlZCBzb21lIHN0dWZmIGEgbGlsIHRvIG15IGxpa2luZy4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBldmVuIGZhc3RlciBza2lwIG1lbnUgc2NyaXB0LiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIG5wY3MgU3VrdW5hIGFuZCBBcmJpdGVyIHRvIHRoZSBmYXJtaW5nIGxpc3QgaW5jbHVkaW5nIGFkbWluIGJvc3Nlcy4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBbHNvIEFkZGVkIHRoZW0gdG8gdGhlIG9uZSBzaG90IGJvc3NlcyBhbmQgbW9icyBmZWF0dXJlLiIpOw0KICAgIGdldGdlbnYoKS5BZGRMaW5lKCk7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJSZWNlbnQgQ2hhbmdlczogKFZlcnNpb24gMS4yOTk3KSIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEZpeGVkIGEgc21hbGwgaXNzdWUgaW4gYXV0b2Zhcm0gcHVibGljIGVkaXRpb24uIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgYSBmZWF0dXJlIHRvIG1ha2UgaHViIGdvIHJhaW5ib3cuIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQ2hhbmdlZCBTdGF0aXN0aWNzIHVpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEZpeGVkIGh1YiBub3QgZXhlY3V0aW5nIGluIFN1a3VuYSdzIHdvcmxkLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIG9uZSBtb3JlIGNvZGUgdG8gQ2xhaW0gQ29kZXMgc2VjdGlvbi4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMjk5OCkiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBSZW1vdmVkIEF1dG8gRXF1aXAgVGl0bGUgKFNvcnJ5KS4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBBdXRvIFNhdmUgQ29uZmlnLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIGEgZmVhdHVyZSB0byBSZXNldCBDb25maWcuIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gSW5jcmVhc2VkIEF1dG8gQnV5IFJva2FrYWthIHdoZW4gY2FzaCBjYXBhY2l0eSBmdWxsLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIFJlbW92ZWQgQXV0byBzZWxsIGl0ZW1zIChUaGV5IHdlcmUgdXNlbGVzcykiKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMjk5OSkiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBzdXBwb3J0IGZvciBFbXBlcm9yLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIEF1dG8gRXF1aXAgV2VhcG9uIChTb21lb25lIFJlcXVlc3RlZCkuIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgQW50aSBmYWxsIHNjcmlwdHMgb24gYXV0b2Zhcm1zIChDYW50IGZhaWwgYW55bW9yZSkiKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBBZGRlZCBBdXRvIFJlc2V0IEljaGlnbyAoU29tZW9uZSBSZXF1ZXN0ZWQpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIEF1dG8gU3RvcmUgT0ZBLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIEVzcCBmb3IgTnBjcy4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMzApIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgT25lIEZvciBBbGwgRmFybWVyLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEZpeGVkIGEgc21hbGwgYnVnIGluIEFudGkgRmFsbC4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBJbXByb3ZlZCBWb2lkIFRwIChCZWNhdXNlIGNpZCB1c2VycyBlc2NhcGVkIHZvaWQpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIE15IFByaXZhdGUgU2NyaXB0IChBdXRvIFJlc3Bhd24vR29kIE1vZGUpLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIERlY3JlYXNlZCBTdGVhbCBJdGVtIGxvb3AgcmF0ZSAwLjAxNSAtPj4gMC4xNS4iKTsNCiAgICBnZXRnZW52KCkuQWRkTGluZSgpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiUmVjZW50IENoYW5nZXM6IChWZXJzaW9uIDEuMzEpIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgRGVrdSBTbGF5ZXIgRmFybWVyLiIpOw0KICAgIGdldGdlbnYoKS5DaGFuZ2Vsb2dMYWJlbCgiWytdIEFkZGVkIFRva2VucyBUbyBDYXNoIENvbnZlcnRlci4iKTsNCiAgICBnZXRnZW52KCkuQ2hhbmdlbG9nTGFiZWwoIlsrXSBMb3dlcmVkIFZvaWQgVFAuIik7DQogICAgZ2V0Z2VudigpLkNoYW5nZWxvZ0xhYmVsKCJbK10gQWRkZWQgTmV3IFdvcmtpbmcgQ29kZXMuIik7DQogICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KZW5kKQ0KDQpIb21lVGFiLm5ld0J1dHRvbigiUmVsb2FkIFNha3VyYSBIdWIiLCIiLGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICDwn4y4IiwiUmVsb2FkaW5nIEh1Yi4uLiIsMC43NSk7ZW5kKQ0KICAgIGdldGdlbnYoKS5TYWt1cmFIdWIgPSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL01hc0h5cGVyaW9uL1N1ZmZlclRvci9yZWZzL2hlYWRzL21haW4vc2FrdXJhLmx1YSI7DQoNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5Db25maWd1cmF0aW9ucygpO2xvYWRzdHJpbmcoZ2FtZTpIdHRwR2V0KGdldGdlbnYoKS5TYWt1cmFIdWIpKSgpOw0KICAgIGVuZCkNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIkdvb2RieWUgU2FrdXJhIEh1YiAgIPCfkYsiLCIiLGZ1bmN0aW9uKCkNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClwY2FsbChmdW5jdGlvbigpZ2V0Z2VudigpLkNvbmZpZ3VyYXRpb25zKCk7Z2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXk6RGVzdHJveSgpO2VuZCk7ZW5kKTsNCiAgICBCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICDwn4y4IiwiR29vZGJ5ZSA6KSIsMC41KTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdMYWJlbCgiU2FrdXJhIEh1YiBDb25maWdzICAg4pqZ77iPIik7DQpIb21lVGFiLm5ld0J1dHRvbigiU2F2ZSBTYWt1cmEgSHViIENvbmZpZyIsIiIsZnVuY3Rpb24oKQ0KICAgIGdldGdlbnYoKS5TYXZlQ29uZmlndXJhdGlvbnMoKTsNCmVuZCkNCg0KSG9tZVRhYi5uZXdCdXR0b24oIlJlc2V0IFNha3VyYSBIdWIgQ29uZmlnIiwiIixmdW5jdGlvbigpDQogICAgdGFzay5zcGF3bihmdW5jdGlvbigpZ2V0Z2VudigpLkNvbmZpZ3VyYXRpb25zKCk7Z2V0Z2VudigpLlJlc2V0Q29uZmlndXJhdGlvbnMoKTtlbmQpDQogICAgZ2V0Z2VudigpLlNha3VyYUh1YiA9ICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vTWFzSHlwZXJpb24vU3VmZmVyVG9yL3JlZnMvaGVhZHMvbWFpbi9zYWt1cmEubHVhIjsNCg0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLkNvbmZpZ3VyYXRpb25zKCk7bG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoZ2V0Z2VudigpLlNha3VyYUh1YikpKCk7DQogICAgZW5kKQ0KZW5kKQ0KDQpIb21lVGFiLm5ld0lucHV0KCJSZXBvcnQgQnVncyAvIEZlZWRiYWNrIiwiVHlwZSBoZXJlIGFueXRoaW5nIHlvdSB3YW50IG1lIHRvIGtub3cgOikiLGZ1bmN0aW9uKHRleHQpDQogICAgZ2V0Z2VudigpLk1lc3NhZ2UgPSB0ZXh0DQogICAgZ2V0Z2VudigpLldlYkhvb2sgPSAiaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTM4Mzg3MDI5NTczMDgxOTE1NS9TUkowZGhRUGZCbmY1Zldoc0ltZEU0SWRvNDJpanpvNTljRHA2OWk2OEdDUGNYMFluZDNaTElsakVaMTNKUTk4eXdaZiI7DQoNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2V0Z2VudigpLk1lc3NhZ2Ugfj0gIiIgdGhlbg0KICAgICAgICAgICAgbG9jYWwgZGF0YSA9IHtjb250ZW50ID0gIiIsZW1iZWRzID0ge3thdXRob3IgPSB7bmFtZSA9IChnZXRnZW52KCkuUHJpdmFjeU1vZGUgPT0gdHJ1ZSBhbmQgIlVua25vd24iKSBvciBnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuTmFtZSx9LHRpdGxlID0gIlJlcG9ydGVkOiIsZGVzY3JpcHRpb24gPSBnZXRnZW52KCkuTWVzc2FnZSx0eXBlID0gInJpY2giLGNvbG9yID0gdG9udW1iZXIoMHhmZjAwMDApLGZvb3RlciA9IHt0ZXh0ID0gc3RyaW5nLmZvcm1hdCgiUmVwb3J0ZWQgYXQgJXMiLG9zLmRhdGUoIiVZLSVtLSVkICVYIikpfX19fTsNCiAgICAgICAgICAgIGxvY2FsIHJlcXVlc3QgPSBodHRwX3JlcXVlc3Qgb3IgcmVxdWVzdCBvciBIdHRwUG9zdCBvciBzeW4ucmVxdWVzdDsNCiAgICAgICAgICAgIHJlcXVlc3Qoe1VybCA9IGdldGdlbnYoKS5XZWJIb29rLEJvZHkgPSBnYW1lOkdldFNlcnZpY2UoIkh0dHBTZXJ2aWNlIik6SlNPTkVuY29kZShkYXRhKSxNZXRob2QgPSAiUE9TVCIsSGVhZGVycyA9IHtbImNvbnRlbnQtdHlwZSJdID0gImFwcGxpY2F0aW9uL2pzb24ifX0pOw0KICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAg8J+MuCIsIk1lc3NhZ2UgU2VudCAgIOKchDGkNzHvv4QxpDc3McKkNyIsMS41KTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpIb21lVGFiLm5ld0J1dHRvbigiSGlkZSB5b3VyIHVzZXJuYW1lIChVc2UgQmVmb3JlIFR5cGluZywgT3B0aW9uYWwpIiwiIixmdW5jdGlvbigpDQogICAgaWYgbm90IGdldGdlbnYoKS5IaWRlZE5hbWUgPT0gdHJ1ZSB0aGVuIGdldGdlbnYoKS5IaWRlZE5hbWUgPSB0cnVlDQogICAgICAgIGdldGdlbnYoKS5Qcml2YWN5TW9kZSA9IHRydWU7DQogICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIgIPCfjLgiLCJIaWRlZCBZb3VyIE5hbWUgICDinIQxpDcx77+EMaQ3NzHCpDciLDEuNSk7DQogICAgZW5kDQplbmQpDQoNCmxvY2FsIFN0b3JhZ2VUYWIgPSBEclJheUxpYnJhcnkubmV3VGFiKCJTdG9yYWdlIiwiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD02ODcwNzI5Mjk1Iik7DQoNClN0b3JhZ2VUYWIubmV3TGFiZWwoIlN0b3JhZ2UgU3R1ZmYgICDwn5OBIik7DQpTdG9yYWdlVGFiLm5ld0J1dHRvbigiQ2xvc2UgLyBPcGVuIFN0YW5kIFN0b3JhZ2UiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuRW5hYmxlZCA9IG5vdCBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLkVuYWJsZWQ7DQogICAgZW5kKQ0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld0J1dHRvbigiQ2xvc2UgLyBPcGVuIEl0ZW0gU3RvcmFnZSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLlZpc2libGUgPSBub3QgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLkl0ZW1TdG9yYWdlLk91dGVyLlZpc2libGU7DQogICAgZW5kKQ0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld0xhYmVsKCJTdG9yaW5nIFN0dWZmICAg8J+TgiIpOw0KU3RvcmFnZVRhYi5uZXdUb2dnbGUoIkF1dG8gU3RvcmUgRXZlcnkgSXRlbSBJbiBIZXJlIiwiIixnZXRnZW52KCkuU3RvcmluZ0FueUV2ZXJ5dGhpbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdBbnlFdmVyeXRoaW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVFdmVyeXRoaW5nKCk7DQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIE5pa3l1IE5pa3l1IERldmlsIEZydWl0IiwiIixnZXRnZW52KCkuU3RvcmluZ05pa3l1TmlreXUgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdOaWt5dU5pa3l1ID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVOaWt5dSgpOyAgICANCmVuZCkNCg0KU3RvcmFnZVRhYi5uZXdUb2dnbGUoIkF1dG8gU3RvcmUgU2luZ3VsYXJpdHkgRXNzZW5jZSIsIiIsZ2V0Z2VudigpLlN0b3JpbmdTaW5ndWxhcml0eSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ1Npbmd1bGFyaXR5ID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVTaW5ndWxhcml0eSgpOyAgICANCmVuZCkNCg0KU3RvcmFnZVRhYi5uZXdUb2dnbGUoIkF1dG8gU3RvcmUgU3VrdW5hJ3MgRmluZ2VyIiwiIixnZXRnZW52KCkuU3RvcmluZ0ZpbmdlciBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0ZpbmdlciA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlN0b3JlU3VrdW5hKCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBJbnZlcnRlZCBTcGVhciBPZiBIZWF2ZW4iLCIiLGdldGdlbnYoKS5TdG9yaW5nSW52ZXJ0ZWQgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdJbnZlcnRlZCA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlN0b3JlSW52ZXJ0ZWQoKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIFNwbGl0IFNvdWwgS2F0YW5hIiwiIixnZXRnZW52KCkuU3RvcmluZ1NwbGl0IG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5TdG9yaW5nU3BsaXQgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZVNwbGl0KCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBDaGFpbiBvZiBBIFRob3VzYW5kIE1pbGVzIiwiIixnZXRnZW52KCkuU3RvcmluZ0NoYWluIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5TdG9yaW5nQ2hhaW4gPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZUNoYWluKCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBDb3J0ZXggU3VwcG9ydCIsIiIsZ2V0Z2VudigpLlN0b3JpbmdDb3J0ZXggb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdDb3J0ZXggPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZUNvcnRleCgpOyAgICANCmVuZCkNCg0KU3RvcmFnZVRhYi5uZXdUb2dnbGUoIkF1dG8gU3RvcmUgQ3JpbXNvbiBDeWJlcmRlY2siLCIiLGdldGdlbnYoKS5TdG9yaW5nQ3JpbXNvbiBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0NyaW1zb24gPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZUNyaW1zb24oKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIEN5YW4gQ3liZXJkZWNrIiwiIixnZXRnZW52KCkuU3RvcmluZ0N5YW4gb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdDeWFuID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVDeWFuKCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBUZWNoIE1vbml0b3IiLCIiLGdldGdlbnYoKS5TdG9yaW5nVGVjaCBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ1RlY2ggPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZVRlY2goKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIEFyYXNha2EgU3VpdGNhc2UiLCIiLGdldGdlbnYoKS5TdG9yaW5nQXJhc2FrYSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0FyYXNha2EgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZUFyYXNha2EoKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIEt1am8ncyBIYXQiLCIiLGdldGdlbnYoKS5TdG9yaW5nS3Vqb0hhdCBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0t1am9IYXQgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZUt1am9IYXQoKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIERpbydzIEJvbmUiLCIiLGdldGdlbnYoKS5TdG9yaW5nRGlvc0JvbmUgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdEaW9zQm9uZSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlN0b3JlRGlvc0JvbmUoKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIERpbydzIERpYXJ5IiwiIixnZXRnZW52KCkuU3RvcmluZ0Rpb3NEaWFyeSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0Rpb3NEaWFyeSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlN0b3JlRGlvc0RpYXJ5KCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBIb2d5b2t1IEZyYWdtZW50IiwiIixnZXRnZW52KCkuU3RvcmluZ0hvZ3lva3Ugb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlN0b3JpbmdIb2d5b2t1ID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVIb2d5b2t1KCk7ICAgIA0KZW5kKQ0KDQpTdG9yYWdlVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBSb2xhbmQgR2xvdmUiLCIiLGdldGdlbnYoKS5TdG9yaW5nR2xvdmVzIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5TdG9yaW5nR2xvdmVzID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVHbG92ZXMoKTsgICAgDQplbmQpDQoNClN0b3JhZ2VUYWIubmV3VG9nZ2xlKCJBdXRvIFN0b3JlIE9mYSBHcmFjZSIsIiIsZ2V0Z2VudigpLlN0b3JpbmdHcmFjZSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuU3RvcmluZ0dyYWNlID0gVmFsdWUNCiAgICBnZXRnZW52KCkuU3RvcmVPQXMoKTsgICAgDQplbmQpDQoNCmxvY2FsIFNob3BUYWIgPSBEclJheUxpYnJhcnkubmV3VGFiKCJTaG9wIiwiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD05NDA1OTMzMjE3Iik7DQoNCmdldGdlbnYoKS5IaWRlUHVyY2hhc2VQcm9tcHQgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgTHBsYXllckd1aSA9IGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aTsNCg0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VGYWlsZWQuU3BpbjEuVmlzaWJsZSA9IGZhbHNlOw0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VGYWlsZWQuU3BpbjIuVmlzaWJsZSA9IGZhbHNlOw0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VGYWlsZWQuU3BpbjMuVmlzaWJsZSA9IGZhbHNlOw0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VGYWlsZWQuT3V0ZXIuVmlzaWJsZSA9IGZhbHNlOw0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VGYWlsZWQuQ29uZmlybWF0aW9uVGV4dC5WaXNpYmxlID0gZmFsc2U7DQoNCiAgICBMcGxheWVyR3VpLlB1cmNoYXNlU3VjY2Vzcy5TcGluMS5WaXNpYmxlID0gZmFsc2U7DQogICAgTHBsYXllckd1aS5QdXJjaGFzZVN1Y2Nlc3MuU3BpbjIuVmlzaWJsZSA9IGZhbHNlOw0KICAgIExwbGF5ZXJHdWkuUHVyY2hhc2VTdWNjZXNzLlNwaW4zLlZpc2libGUgPSBmYWxzZTsNCiAgICBMcGxheWVyR3VpLlB1cmNoYXNlU3VjY2Vzcy5PdXRlci5WaXNpYmxlID0gZmFsc2U7DQogICAgTHBsYXllckd1aS5QdXJjaGFzZVN1Y2Nlc3MuQ29uZmlybWF0aW9uVGV4dC5WaXNpYmxlID0gZmFsc2U7DQplbmQNCg0KZ2V0Z2VudigpLkF0dGFja2luZyA9IGZ1bmN0aW9uKCkNCiAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU3RhbmRsZXNzIiB0aGVuDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlN0YW5kbGVzc1JlbW90ZSIpOldhaXRGb3JDaGlsZCgiU3RhYiIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU3RhbmRsZXNzUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQYW4iKTpGaXJlU2VydmVyKCk7DQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlN0YW5kbGVzc1JlbW90ZSIpOldhaXRGb3JDaGlsZCgiS2ljayIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU3RhbmRsZXNzUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQdW5jaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU3RhbmRsZXNzUmVtb3RlIik6V2FpdEZvckNoaWxkKCJIZWF2eSIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU3RhbmRsZXNzUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQdW5jaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSBmYWxzZX07Z2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU3RhbmRsZXNzUmVtb3RlIik6V2FpdEZvckNoaWxkKCJCYXJyYWdlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiSWduaXRpb24iKTpGaXJlU2VydmVyKCk7DQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiUHVuY2giKTpGaXJlU2VydmVyKCk7DQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIlNoaW5yYVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiRmllcmNlIik6RmlyZVNlcnZlcigpOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTaGlucmFSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkNvcm5hIik6RmlyZVNlcnZlcigpOw0KICAgICAgICBlbHNlaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgPT0gIlRoZSBBcmJpdGVyIiB0aGVuDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkFyYml0ZXJSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlNob2Nrd2F2ZSIpOkZpcmVTZXJ2ZXIoKQ0KICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiU2hhZG93IFRoZSBXb3JsZCIgdGhlbg0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTVFdSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlRTIik6RmlyZVNlcnZlcigpOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTVFdSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIktuaWZlIik6RmlyZVNlcnZlcigpOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTVFdSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkRvbnV0Iik6RmlyZVNlcnZlcigpOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTVFdSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkV5ZSIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiU1RXUmVtb3RlIik6V2FpdEZvckNoaWxkKCJLaWNrIik6RmlyZVNlcnZlcigpOw0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJTVFdSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlB1bmNoIik6RmlyZVNlcnZlcigpOw0KICAgIGVsc2VpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSA9PSAiRW1wZXJvciIgdGhlbg0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJFbXBlcm9yUmVtb3RlIik6V2FpdEZvckNoaWxkKCJQdW5jaCIpOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSBmYWxzZX07DQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkVtcGVyb3JSZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkNvbnNlY3V0aXZlIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9IGdldGdlbnYoKS5UYXJnZXQsWzJdID0gZmFsc2V9Ow0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJFbXBlcm9yUmVtb3RlIik6V2FpdEZvckNoaWxkKCJBaXJTaG90Iik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICBsb2NhbCBhcmdzID0ge1sxXSA9IGdldGdlbnYoKS5UYXJnZXQsWzJdID0gZmFsc2V9Ow0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJFbXBlcm9yUmVtb3RlIik6V2FpdEZvckNoaWxkKCJDdXJ2ZSIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgbG9jYWwgYXJncyA9IHtbMV0gPSBnZXRnZW52KCkuVGFyZ2V0LFsyXSA9IGZhbHNlfTsNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiRW1wZXJvclJlbW90ZSIpOldhaXRGb3JDaGlsZCgiSG9taW5nIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgIGVsc2UgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsVXNlciIpOkNsaWNrQnV0dG9uMShWZWN0b3IyLm5ldygpKTsNCiAgICAgICAgZ2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCJFIixmYWxzZSxnYW1lKTtnYW1lLlZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KHRydWUsIkciLGZhbHNlLGdhbWUpO2dhbWUuVmlydHVhbElucHV0TWFuYWdlcjpTZW5kS2V5RXZlbnQodHJ1ZSwiVCIsZmFsc2UsZ2FtZSk7Z2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudCh0cnVlLCJSIixmYWxzZSxnYW1lKTtnYW1lLlZpcnR1YWxJbnB1dE1hbmFnZXI6U2VuZEtleUV2ZW50KGZhbHNlLCJZIixmYWxzZSxnYW1lKTsNCiAgICAgICAgZ2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwiRSIsZmFsc2UsZ2FtZSk7Z2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwiRyIsZmFsc2UsZ2FtZSk7Z2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwiVCIsZmFsc2UsZ2FtZSk7Z2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwiUiIsZmFsc2UsZ2FtZSk7Z2FtZS5WaXJ0dWFsSW5wdXRNYW5hZ2VyOlNlbmRLZXlFdmVudChmYWxzZSwiWSIsZmFsc2UsZ2FtZSk7DQogICAgZW5kDQplbmQNCg0KU2hvcFRhYi5uZXdMYWJlbCgiUXVpY2sgU2hvcCAg8J+PqiIpOw0KU2hvcFRhYi5uZXdCdXR0b24oIkJ1eSBBcnJvdyIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjEifTsNCiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJBcnJvdyIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICBnZXRnZW52KCkuSGlkZVB1cmNoYXNlUHJvbXB0KCk7DQplbmQpDQoNClNob3BUYWIubmV3QnV0dG9uKCJCdXkgUm9rYWtha2EiLCIiLGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBhcmdzID0ge1sxXSA9ICIxIn07DQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpOldhaXRGb3JDaGlsZCgiQnV5SXRlbVJlbW90ZSIpOldhaXRGb3JDaGlsZCgiUm9rYWtha2EiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgZ2V0Z2VudigpLkhpZGVQdXJjaGFzZVByb21wdCgpOw0KZW5kKQ0KDQpTaG9wVGFiLm5ld0J1dHRvbigiQnV5IFN0b3AgU2lnbiIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjEifTsNCiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJTdG9wU2lnbiIpOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICBnZXRnZW52KCkuSGlkZVB1cmNoYXNlUHJvbXB0KCk7DQplbmQpDQoNClNob3BUYWIubmV3QnV0dG9uKCJCdXkgSGFtb24gTWFudWFsIiwiIixmdW5jdGlvbigpDQogICAgbG9jYWwgYXJncyA9IHtbMV0gPSAiMSJ9Ow0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkJ1eUl0ZW1SZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIkhhbW9uIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgIGdldGdlbnYoKS5IaWRlUHVyY2hhc2VQcm9tcHQoKTsNCmVuZCkNCg0KU2hvcFRhYi5uZXdCdXR0b24oIkJ1eSBTcGluIE1hbnVhbCIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjEifTsNCiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJTcGluIik6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgIGdldGdlbnYoKS5IaWRlUHVyY2hhc2VQcm9tcHQoKTsNCmVuZCkNCg0KU2hvcFRhYi5uZXdCdXR0b24oIkJ1eSBTdG9uZSBNYXNrIiwiIixmdW5jdGlvbigpDQogICAgbG9jYWwgYXJncyA9IHtbMV0gPSAiMSJ9Ow0KICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKTpXYWl0Rm9yQ2hpbGQoIkJ1eUl0ZW1SZW1vdGUiKTpXYWl0Rm9yQ2hpbGQoIlZhbXBpcmUiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgZ2V0Z2VudigpLkhpZGVQdXJjaGFzZVByb21wdCgpOw0KZW5kKQ0KDQpTaG9wVGFiLm5ld0J1dHRvbigiQnV5IENhbWVyYSIsIiIsZnVuY3Rpb24oKQ0KICAgIGxvY2FsIGFyZ3MgPSB7WzFdID0gIjEifTsNCiAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIik6V2FpdEZvckNoaWxkKCJCdXlJdGVtUmVtb3RlIik6V2FpdEZvckNoaWxkKCJDYW1lcmEiKTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgZ2V0Z2VudigpLkhpZGVQdXJjaGFzZVByb21wdCgpOw0KZW5kKQ0KDQpsb2NhbCBGYXJtaW5nVGFiID0gRHJSYXlMaWJyYXJ5Lm5ld1RhYigiRmFybWluZyIsImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9MTIzMzQ2NTY2MTUiKTsNCg0KRmFybWluZ1RhYi5uZXdMYWJlbCgiV2Vla2x5IFJlbWluZGVyICAg8J+ThSIpOw0KRmFybWluZ1RhYi5uZXdCdXR0b24oIlJlYWQgVGhpcyAoVmVyeSBJbXBvcnRhbnQpIiwiIixmdW5jdGlvbigpDQogICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIPCfjLgiLCJVc2Ugb25lIHRlbGVwb3J0IHRvZ2dsZSBhdCBhIHRpbWUhIiwxLjUpOw0KICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBHcnJyID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9ODYwMzIyNzM1MCI7DQogICAgICAgIGxvY2FsIFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpOw0KICAgICAgICBTb3VuZC5OYW1lID0gIlNvdW5kIjsNCiAgICAgICAgU291bmQuU291bmRJZCA9IEdycnI7DQogICAgICAgIFNvdW5kLlZvbHVtZSA9IDEwOw0KICAgICAgICBTb3VuZC5Mb29wZWQgPSBmYWxzZTsNCiAgICAgICAgU291bmQuQXJjaGl2YWJsZSA9IGZhbHNlOw0KICAgICAgICBTb3VuZC5QYXJlbnQgPSBnYW1lLldvcmtzcGFjZQ0KICAgICAgICBTb3VuZDpQbGF5KCk7DQogICAgZW5kKUJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIgICDwn4y4IiwiRG9udCBhc2sgbWUgYWJvdXQgVXBkYXRlIERhdGUhIiwyLjUpO3Rhc2sud2FpdCgxLjg1KTsNCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgRHJpcCA9ICJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTY4MjA0NjY4MTIiOw0KICAgICAgICBsb2NhbCBTb3VuZCA9IEluc3RhbmNlLm5ldygiU291bmQiKTsNCiAgICAgICAgU291bmQuTmFtZSA9ICJTb3VuZCI7DQogICAgICAgIFNvdW5kLlNvdW5kSWQgPSBEcmlwOw0KICAgICAgICBTb3VuZC5Wb2x1bWUgPSAxMDsNCiAgICAgICAgU291bmQuTG9vcGVkID0gZmFsc2U7DQogICAgICAgIFNvdW5kLkFyY2hpdmFibGUgPSBmYWxzZTsNCiAgICAgICAgU291bmQuUGFyZW50ID0gZ2FtZS5Xb3Jrc3BhY2UNCiAgICAgICAgU291bmQ6UGxheSgpOw0KICAgIGVuZCkNCiAgICANCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgU2NyZWVuR3VpID0gSW5zdGFuY2UubmV3KCJTY3JlZW5HdWkiKTsNCiAgICAgICAgU2NyZWVuR3VpLk5hbWUgPSAiRHJpcEdva3UiOw0KICAgICAgICBTY3JlZW5HdWkuUGFyZW50ID0gZ2FtZS5Db3JlR3VpOw0KICAgICAgICBsb2NhbCBJbWFnZUxhYmVsID0gSW5zdGFuY2UubmV3KCJJbWFnZUxhYmVsIik7DQogICAgICAgIEltYWdlTGFiZWwuUGFyZW50ID0gU2NyZWVuR3VpDQogICAgICAgIEltYWdlTGFiZWwuQmFja2dyb3VuZENvbG9yMyA9IENvbG9yMy5mcm9tUkdCKDI1NSwyNTUsMjU1KTsNCiAgICAgICAgSW1hZ2VMYWJlbC5Cb3JkZXJDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigwLDAsMCk7DQogICAgICAgIEltYWdlTGFiZWwuQm9yZGVyU2l6ZVBpeGVsID0gMDsNCiAgICAgICAgSW1hZ2VMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygwLDAsMCwwKTsNCiAgICAgICAgSW1hZ2VMYWJlbC5TaXplID0gVURpbTIubmV3KDEsMCwxLDApOw0KICAgICAgICBJbWFnZUxhYmVsLkltYWdlID0gImh0dHA6Ly93d3cucm9ibG94LmNvbS9hc3NldC8/aWQ9NjI1Nzc1NjMyMiI7DQogICAgICAgIEltYWdlTGFiZWwuSW1hZ2VUcmFuc3BhcmVuY3kgPSAwOw0KICAgICAgICB0YXNrLndhaXQoMC41MCk7DQogICAgICAgIFNjcmVlbkd1aTpEZXN0cm95KCk7DQogICAgZW5kKQ0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJFcXVpcCBCZXN0IEZhcm1pbmcgU3BlYyAgIPCfk4wiKTsNCkZhcm1pbmdUYWIubmV3QnV0dG9uKCJFcXVpcCBTaGlucmEgS3VzYWthYmUoQmVzdCBmb3IgUHJpdmF0ZSBTZXJ2ZXIgQXV0b2Zhcm0pIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSB+PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsMTAwIGRvDQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlN0YW5kU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lclsiU2xvdCIuLmldLlRleHQuVGV4dCA9PSAiU2hpbnJhIEt1c2FrYWJlIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg8J+MuCIsIllvdSBhcmUgQWxyZWFkeSBTaGlucmEgS3VzYWthYmUiLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJTdGF0aXN0aWNzIEdVSSAgIPCfk4oiKTsNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJTaG93IC8gSGlkZSBTdGF0aXN0aWNzIEdVSSIsIiIsZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLlRvZ2dsZVN0YXRpc3RpY3NHVUkgPSBWYWx1ZQ0KICAgIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLlN0YXRpc3RpY3NHVUkuRW5hYmxlZCA9IGdldGdlbnYoKS5Ub2dnbGVTdGF0aXN0aWNzR1VJOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIExldmVsaW5nICDwn5OIIik7DQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBCdXkgKyBBdXRvIFNlbGwgUm9rYWtha2EgKFVzZSBBdCAyeCBXZWVrZW5kKSIsIiIsZ2V0Z2VudigpLkF1dG9MZXZlbGluZ1VwIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvTGV2ZWxpbmdVcCA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkxldmVsaW5nVXAoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gQnV5ICsgQXV0byBTZWxsIFJva2FrYWthIChXaGVuIENhc2ggQ2FwYWNpdHkgRnVsbCkiLCIiLGdldGdlbnYoKS5BdXRvU2F2aW5nQ2FzaCBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1NhdmluZ0Nhc2ggPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TYXZpbmdVcENhc2goKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdMYWJlbCgiQXV0byBUYXNrcyAgIPCfk50iKTsNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIFVwZ3JhZGUgTWFzdGVyeSIsIiIsZ2V0Z2VudigpLkF1dG9SZWJpcnRoIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUmViaXJ0aCA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlJlYmlydGhpbmcoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gQnJlYWt0aHJvdWdoIiwiIixnZXRnZW52KCkuQXV0b0JyZWFrdGhyb3VnaCBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0JyZWFrdGhyb3VnaCA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkJyZWFraW5nVGhyb3VnaCgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIEZhcm1pbmcgSXRlbXMgKyBBdXRvIEZhcm1pbmcgQm9zc2VzIC8gTW9icyAgIPCfkqQiKTsNCkZhcm1pbmdUYWIubmV3QnV0dG9uKCJRdWljayBFeHBsYW5hdGlvbiAoT3BlbiBGOSBDb25zb2xlKSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJWaXJ0dWFsSW5wdXRNYW5hZ2VyIik6U2VuZEtleUV2ZW50KHRydWUsIkY5IixmYWxzZSxnYW1lKTsNCiAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiDwn4y4IiwiT3BlbiBGOSBDb25zb2xlIiwxLjUpOw0KICAgICAgICB3YXJuKCItLS0tLS0tLS0tLS0tLS1bQXV0byBGYXJtaW5nXS0tLS0tLS0tLS0tLS0tLSIpOw0KICAgICAgICBwcmludCgiVGhpcyBzY3JpcHQgYWxsb3dzIHUgdG8gZ2V0IGxldmVscyBhbmQgaXRlbXMgZmFzdGVyIHRoYW4gdXN1YWwuIik7DQogICAgICAgIHByaW50KCJZb3UgY2FuIG9uZSBzaG90IG1vYnMgYnkgZ3JhYmJpbmcgdGhlbS4iKTsNCiAgICAgICAgcHJpbnQoIldoeSBzaGlucmEgaXMgdGhlIGJlc3Q/IEJlY2F1c2UgdGhlIHNwZWMgaGFzIDMgZ3JhYiBtb3ZlcyB3aXRoIHNob3J0IGNvb2xkb3duLiIpOw0KICAgICAgICBwcmludCgiSSBkb250IHdhbnQgeW91IHRvIGdldCBiYW5uZWQgc28gcGxzIGRvbnQgdXNlIHBzIGVkaXRpb24gaW4gYSBwdWJsaWMgc2VydmVyLiIpOw0KICAgICAgICBwcmludCgiV2h5IGRvIEkgbmVlZCB0byBzZWxlY3QgdGl0bGUgYmVmb3JlIGF1dG9mYXJtaW5nPyBUaGlzIHdpbGwga2VlcCB1IHNhZmUgZnJvbSB0aGUgZ2FtZSBmb3JjaW5nIHUgdG8gY2hhbmdlIHRpdGxlLiIpOw0KICAgICAgICBwcmludCgiV2h5IGRvZXMgaXQgbm90IGdvIGFmdGVyIE1lbm9zPyBCZWNhdXNlIG1lbm9zIGhhcyBhbnRpIGdyYWIgc28gaXRzIGltcG9zc2libGUgdG8gb25lIHNob3QgaGltLiIpOw0KICAgICAgICBwcmludCgiV2h5IGRvZXMgaXQgbm90IGdvIGFmdGVyIFBhcGVyIEN1cnNlcz8gQmVjYXVzZSB0aGV5IGFyZSBhbm5veWluZyB0byBkZWFsIHdpdGggYW5kIGl0cyB0aW1lIGNvbnN1bWluZy4iKTsNCiAgICAgICAgcHJpbnQoIldoeSBkb2VzIGl0IG5vdCBnbyBhZnRlciBUaHVncyBvciBCYW5kaXRzPyBCZWNhdXNlIHRoZXkgaXRzIG5vdCB3b3J0aCB0aW1lIHRyeWluZyB0byBkZWFsIHdpdGggdGhlbS4iKTsNCiAgICAgICAgd2FybigiLS0tLS0tLS0tLS0tLS1bQmVzdCBTZXR0aW5nc10tLS0tLS0tLS0tLS0tLSIpOw0KICAgICAgICBwcmludCgiVGhlIGJlc3Qgc3BlYyB0byB1c2UgdGhlIGF1dG9mYXJtIHdpdGg6IChTaGlucmEgS3VzYWthYmUpLiIpOw0KICAgICAgICBwcmludCgiVGhlIGJlc3QgdGl0bGUgdG8gdXNlIHRoZSBhdXRvZmFybSB3aXRoOiAoVGhlIEludGVsbGlnZW50KS4iKTsNCiAgICAgICAgcHJpbnQoIkkgcmVjb21tZW5kIHlvdSB0byB1c2UgQXV0byBVcGdyYWRlIE1hc3RlcnkgYW5kIEF1dG8gQnJlYWt0aHJvdWdoIGFsb25nIHdpdGggQXV0byBTZWxsIEFueSBJdGVtLiIpOw0KICAgIGVuZCkNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIlN0YXJ0IEZhcm1pbmcgIFtQdWJsaWMgU2VydmVyIEVkaXRpb25dIiwiIixnZXRnZW52KCkuQXV0b1B1YmxpY0dyaW5kaW5nIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUHVibGljR3JpbmRpbmcgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5QdWJsaWNTZXJ2ZXJBdXRvZmFybSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiU3RhcnQgRmFybWluZyAgW1ByaXZhdGUgU2VydmVyIEVkaXRpb25dIiwiIixnZXRnZW52KCkuQXV0b1ByaXZhdGVHcmluZGluZyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1ByaXZhdGVHcmluZGluZyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlByaXZhdGVTZXJ2ZXJBdXRvZmFybSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIFNlbGxpbmcgICDwn5K1Iik7DQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBTZWxsIEV2ZXJ5dGhpbmciLCIiLGdldGdlbnYoKS5BdXRvU2VsbGluZyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1NlbGxpbmcgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TZWxsaW5nQW55SXRlbSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvZmFybWluZyBNaXNjZWxsYW5lb3VzICAg8J+TjCIpOw0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gRXF1aXAgV2VhcG9uIChSZXF1aXJlcyBVbmVxdWlwcGVkIFdlYXBvbiBTcGVjcyBvbmx5KSIsIiIsZ2V0Z2VudigpLkF1dG9FcXVpcFdlYXBvbiBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0VxdWlwV2VhcG9uID0gVmFsdWUNCiAgICBnZXRnZW52KCkuV2VhcG9uRXF1aXBwZWQoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gUm9rYWtha2EgSWNoaWdvIFN0YWdlIE9uZSAoUmVxdWlyZXMgUm9rYWtha2EgRnJ1aXQpIiwiIixnZXRnZW52KCkuQXV0b1Jlc2V0SWNoaWdvIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUmVzZXRJY2hpZ28gPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5JY2hpZ29SZXNldHRlZCgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBTdG9yZSBPRkEgU3RhZ2UgT25lIChSZXF1aXJlcyBTdGFuZGxlc3Mgc2xvdCkiLCIiLGdldGdlbnYoKS5BdXRvU3RvcmVTdGFnZU9uZSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1N0b3JlU3RhZ2VPbmUgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdG9yZWRPRkEoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdMYWJlbCgiQXV0byBBbHQgRXhwIEZhcm1pbmcgICDwn5SlICBbUHJpdmF0ZSBTZXJ2ZXJzIE9ubHldIik7DQpGYXJtaW5nVGFiLm5ld0J1dHRvbigiUXVpY2sgRXhwbGFuYXRpb24gKE9wZW4gRjkgQ29uc29sZSkiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdhbWU6R2V0U2VydmljZSgiVmlydHVhbElucHV0TWFuYWdlciIpOlNlbmRLZXlFdmVudCh0cnVlLCJGOSIsZmFsc2UsZ2FtZSk7DQogICAgICAgIEJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIg8J+MuCIsIk9wZW4gRjkgQ29uc29sZSIsMS41KTsNCiAgICAgICAgd2FybigiLS0tLS0tLS0tLS0tLS0tW0FsdCBFeHAgRmFybWluZ10tLS0tLS0tLS0tLS0tLS0iKTsNCiAgICAgICAgcHJpbnQoIlRoaXMgc2NyaXB0IGlzIG11bHRpcGxlIHRpbWVzIGZhc3RlciB0aGFuIGJvdGggYXV0b2Zhcm0gdmFyaWFudHMgKFB1YmxpYyAvIFByaXZhdGUpLiIpOw0KICAgICAgICBwcmludCgiVGhpcyBzY3JpcHQgYWxsb3dzIHUgdG8gZ2V0IG1hc3RlcmllcyAvIGZpbmdlcnMgLyBtYXNrcyByZWFsbHkgZmFzdC4iKTsNCiAgICAgICAgcHJpbnQoIllvdSBjYW4gaGVscCBsZWdpdCBwbGF5ZXJzIGxldmVsIHVwIHJlYWxseSBmYXN0IHRvby4iKTsNCiAgICAgICAgcHJpbnQoIkl0IGJhc2ljYWxseSB0ZWxlcG9ydHMgdSB0byBsaWJyYXJ5IGFuZCByZXNldHMgeW91IG9uY2UgeW91IGdldCBoaXQuIik7DQogICAgICAgIHByaW50KCJXaHk/IGJlY2F1c2Ugd2hlbiB1IHJlc2V0IGl0IGNvdW50cyBhcyBhIGtpbGwgYW5kIGl0IGdpdmVzIHRoZSBwbGF5ZXIgd2hvIGhpdCB1IGV4cC4iKTsNCiAgICAgICAgcHJpbnQoIkFuZCB0aGUgbW9yZSBhbHRzIHUgbWFrZSB0aGVtIHVzZSB0aGlzIHRoZSBiZXR0ZXIgdGhlIGV4cCByYXRlLiIpOw0KICAgICAgICBwcmludCgiVG8gZ2V0IHRoaXMgdG8gd29yayB5b3Ugd2lsbCBuZWVkIGV4ZWN1dG9yIGxpa2Ugd2F2ZSBiZWNhdXNlIGl0IGNhbiBleGVjdXRlIG9uIG11bHRpIGFjYy4iKTsNCiAgICAgICAgcHJpbnQoIk9yIHlvdSBjYW4gdXNlIEVtdWxhdG9yIE11bHRpcGxheWVyLCBBbm90aGVyIGNvcHkgb2YgeW91ciBlbXVsYXRvciBhbmQgam9pbiBpbiB3aXRoIGEgZGlmZnJlbnQgYWNjLiIpOw0KICAgICAgICB3YXJuKCItLS0tLS0tLS0tLS0tLVtCZXN0IFNldHRpbmdzXS0tLS0tLS0tLS0tLS0tIik7DQogICAgICAgIHByaW50KCJUaGUgYmVzdCBzcGVjIHRvIHVzZSAoRm9yIHRoZSBvbmUgd2hvIGdldHMgdGhlIGV4cCkgaXMgU2hhZG93IFRoZSBXb3JsZCwgV2h5PyBiZWNhdXNlIGhpcyBtMSBjb29sZG93biBpcyBzaG9ydC4iKTsNCiAgICAgICAgcHJpbnQoIlRoZSBiZXN0IHRpdGxlIHRvIHVzZSAoRm9yIHRoZSBvbmUgd2hvIGdldHMgdGhlIGV4cCkgaXMgVGhlIEludGVsbGlnZW50IChPYnRhaW5lZCBieSBidXlpbmcgZnJvbSBsYXB0b3ApLiIpOw0KICAgICAgICBwcmludCgiSSByZWNvbW1lbmQgeW91IHRvIHVzZSBBdXRvIFBpY2sgQXVyYSBmcm9tIFN0ZWFsaW5nIFN0dWZmIHNlY3Rpb24uIik7DQogICAgZW5kKQ0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiU3RhcnQgRmFybWluZyAoQWx0IEFjY291bnQpIiwiIixnZXRnZW52KCkuQXV0b0FsdEZhcm1pbmcgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9BbHRGYXJtaW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuVXNpbmdBbHRGYXJtaW5nKCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJTdGFydCBGYXJtaW5nIChNYWluIEFjY291bnQpIiwiIixnZXRnZW52KCkuQXV0b01haW5GYXJtaW5nIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvTWFpbkZhcm1pbmcgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Vc2luZ01haW5BY2NvdW50RmFybWluZygpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIERla3UgU2xheWVyIEZhcm1lciAgIOKalO+4jyAgW1ByaXZhdGUgU2VydmVycyBPbmx5XSIpOw0KRmFybWluZ1RhYi5uZXdCdXR0b24oIlF1aWNrIEV4cGxhbmF0aW9uIChPcGVuIEY5IENvbnNvbGUpIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlZpcnR1YWxJbnB1dE1hbmFnZXIiKTpTZW5kS2V5RXZlbnQodHJ1ZSwiRjkiLGZhbHNlLGdhbWUpOw0KICAgICAgICBCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViIPCfjLgiLCJPcGVuIEY5IENvbnNvbGUiLDEuNSk7DQogICAgICAgIHdhcm4oIi0tLS0tLS0tLS0tLS0tLVtBbHQgRXhwIEZhcm1pbmddLS0tLS0tLS0tLS0tLS0tIik7DQogICAgICAgIHByaW50KCJUaGlzIHNjcmlwdCBpcyBtdWx0aXBsZSB0aW1lcyBmYXN0ZXIgdGhhbiBib3RoIGF1dG9mYXJtIHZhcmlhbnRzIChQdWJsaWMgLyBQcml2YXRlKS4iKTsNCiAgICAgICAgcHJpbnQoIllvdSBtdXN0IGhhdmUgc3RhZ2UgNCBlcXVpcHBlZCIpOw0KICAgICAgICBwcmludCgiWW91IG11c3QgaGF2ZSBzaGlucmEga3VzYWthYmUgaW4gc3RvcmFnZSIpOw0KICAgICAgICBwcmludCgiSXQgZ2V0cyB1IHRvIG1hc3RlcnkgMyBhdXRvbWF0aWNhbGx5LCBhcyBsb25nIGFzIHUgZG9udCBydW4gb3V0IG9mIGNhc2giKTsNCiAgICAgICAgcHJpbnQoIlRoaXMgc2NyaXB0IGFsbG93cyB1IHRvIGdldCBtYXN0ZXJpZXMgLyBnbG92ZXMgLyB0b2tlbnMgcmVhbGx5IGZhc3QuIik7DQogICAgICAgIHByaW50KCJJdCBiYXNpY2FsbHkgZG9lcyB0aGUgdGFzayBvZiBzcGF3bmluZyBkZWt1L3JvbGFuZCBhbmQga2lsbGluZyBpdCBvdmVyIGFuZCBvdmVyIik7DQogICAgICAgIHByaW50KCJXaXRob3V0IFN1cHBvcnQgbWVhbmluZyB1IHdsbCBkbyBhdXRvZmFybSBhbG9uZSBqdXN0IGJ5IHVyc2VsZiB1bnRpbCBjYXNoIHJ1bnMgb3V0LiIpOw0KICAgICAgICBwcmludCgiV2l0aCBTdXBwb3J0IG1lYW5pbmcgdSB3bGwgZG8gYXV0b2Zhcm0gb25seSB3aGVuIGRla3Ugb3Igcm9sYW5kIHNwYXducy4gKFNvb24pIik7DQogICAgICAgIHByaW50KCJTdXBwb3J0IEFjY291bnQgbWVhbmluZyB1IHdsbCBkbyBzcGF3biBkZWt1L3JvbGFuZCBmb3IgJ1dpdGggU3VwcG9ydCBBY2NvdW50Jy4iKTsNCiAgICAgICAgd2FybigiLS0tLS0tLS0tLS0tLS1bQmVzdCBTZXR0aW5nc10tLS0tLS0tLS0tLS0tLSIpOw0KICAgICAgICBwcmludCgiVGhlIGJlc3QgdGl0bGUgdG8gdXNlIGlzIFRoZSBJbnRlbGxpZ2VudCAoT2J0YWluZWQgYnkgYnV5aW5nIGZyb20gbGFwdG9wKS4iKTsNCiAgICBlbmQpDQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJTdGFydCBGYXJtaW5nIChXaXRob3V0IFN1cHBvcnQpIiwiIixnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UxIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTEgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Vc2luZ0Rla3VBdXRvZmFybTEoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIlN0YXJ0IEZhcm1pbmcgKFdpdGggU3VwcG9ydCkiLCIiLGdldGdlbnYoKS5BdXRvZmFybU9uRGVrdTIgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MiA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlVzaW5nRGVrdUF1dG9mYXJtMigpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiU3RhcnQgRmFybWluZyAoU3VwcG9ydCBBY2NvdW50KSIsIiIsZ2V0Z2VudigpLkF1dG9mYXJtT25EZWt1MyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b2Zhcm1PbkRla3UzID0gVmFsdWUNCiAgICBnZXRnZW52KCkuVXNpbmdEZWt1QXV0b2Zhcm0zKCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3TGFiZWwoIkF1dG8gVG9rZW5zIENvbnZlcnRlciIpOw0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gRXhjaGFuZ2UgVG9rZW5zIFRvIENhc2ggKFdoZW4gQnJva2UpIiwiIixnZXRnZW52KCkuQXV0b0NvbnZlcnRUb2tlbnMgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9Db252ZXJ0VG9rZW5zID0gVmFsdWUNCiAgICBnZXRnZW52KCkuVXNpbmdUb2tlbnNUb0Nhc2goKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdMYWJlbCgiQXV0byBTdGVhbGluZyBTdHVmZiAgIPCfp6QiKTsNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIFN0ZWFsIE9uZSBGb3IgQWxsIChSZXF1aXJlcyBTdGFuZGxlc3MpIiwiIixnZXRnZW52KCkuQXV0b1N0ZWFsaW5nT2ZhIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvU3RlYWxpbmdPZmEgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5TdGVhbGluZ09uZUZvckFsbCgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBTdGVhbCBBbnkgSXRlbSAgKERvZXNudCBnbyB3aXRoIEF1dG9mYXJtKSIsIiIsZ2V0Z2VudigpLkF1dG9TdGVhbGluZ0l0ZW1zIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvU3RlYWxpbmdJdGVtcyA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlN0ZWFsaW5nQW55SXRlbSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBQaWNrIEF1cmEgKEFueSBJdGVtKSIsIiIsZ2V0Z2VudigpLkF1dG9QaWNraW5nSXRlbXMgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9QaWNraW5nSXRlbXMgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5QaWNrQXVyYUFueUl0ZW0oKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gU2FmZSBab25lIChPcHRpb25hbCkiLCIiLGdldGdlbnYoKS5BdXRvU2FmZVpvbmUgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9TYWZlWm9uZSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlVzaW5nU2FmZVpvbmUoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdMYWJlbCgiQXV0byBCb3NzIC8gTW9iIEtpbGxlciAgIPCflKogIChEb2VzbnQgZ28gd2l0aCBBdXRvZmFybSkiKTsNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIHNldCBOZWFyZXN0IEJvc3NlcyAvIE1vYnMgSGVhbHRoIFRvIDAgKFVzZSBHcmFiIE1vdmVzKSIsIiIsZ2V0Z2VudigpLkF1dG9PbmVTaG90dGluZyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b09uZVNob3R0aW5nID0gVmFsdWUNCiAgICBnZXRnZW52KCkuT25lU2hvdEFueUJvc3NBbmRNb2IoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8ga2lsbCBOZWFyZXN0IEJvc3NlcyAvIE1vYnMiLCIiLGdldGdlbnYoKS5BdXRvS2lsbE5lYXJlc3RNb2Igb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9LaWxsTmVhcmVzdE1vYiA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkF1dG9mYXJtTmVhcmVzdE1vYigpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIFJlcm9sbHMgICDwn4yAIikNCkZhcm1pbmdUYWIubmV3RHJvcGRvd24oIlR5cGUgT2YgUm9sbHMiLCJCYW5uZXJzIix7Ik11bHRpIiwiU2luZ2xlIn0sZnVuY3Rpb24oVmFsdWUpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuV2hpY2hUeXBlID0gVmFsdWU7DQogICAgZW5kKQ0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBSb2xsIEFycm93IE9mIE5vdmFlIEJhbm5lciIsIiIsZ2V0Z2VudigpLkF1dG9Sb2xsQmFubmVyIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUm9sbEJhbm5lciA9IFZhbHVlDQogICAgZ2V0Z2VudigpLkJhbm5lclJvbGxpbmcoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gUm9sbCBDaWQgQmFubmVyIiwiIixnZXRnZW52KCkuQXV0b1JvbGxDaWRCYW5uZXIgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9Sb2xsQ2lkQmFubmVyID0gVmFsdWUNCiAgICBnZXRnZW52KCkuQ2lkQmFubmVyUm9sbGluZygpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBSb2xsIEthaWp1IEJhbm5lciIsIiIsZ2V0Z2VudigpLkF1dG9Sb2xsS2FpanVCYW5uZXIgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9Sb2xsS2FpanVCYW5uZXIgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5LYWlqdUJhbm5lclJvbGxpbmcoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdEcm9wZG93bigiVHlwZXMgT2YgUGF5bWVudHMiLCJEZWF0aCBBbmltYXRpb25zIix7IkNhc2giLCJUb2tlbiJ9LGZ1bmN0aW9uKFZhbHVlKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLldoaWNoVHlwZXogPSBWYWx1ZTsNCiAgICBlbmQpDQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIFJvbGwgRGVhdGggQW5pbWF0aW9ucyBCYW5uZXIiLCIiLGdldGdlbnYoKS5BdXRvUm9sbERlYXRocyBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1JvbGxEZWF0aHMgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Sb2xsRGVhdGhCYW5uZSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBSb2xsIEFyY2FkZSBCYW5uZXIgKFVzZXMgQ2FzaCkiLCIiLGdldGdlbnYoKS5BdXRvUm9sbEFyY2FkZSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b1JvbGxBcmNhZGUgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5Sb2xsQXJjYWRlQmFubmVyKCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3TGFiZWwoIkF1dG8gVXNlIEJyZWFrdGhyb3VnaCBQb2ludHMgICDwn6esIik7DQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQ29udmVydCBCcmVha3Rocm91Z2ggZm9yIFRva2VucyIsIiIsZ2V0Z2VudigpLkF1dG9CNFQgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9CNFQgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5CcmVha3Rocm91Z2hGb3JUb2tlbigpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQ29udmVydCBCcmVha3Rocm91Z2ggZm9yIFN0b3JhZ2UgQ2FwYWNpdHkiLCIiLGdldGdlbnYoKS5BdXRvQjRTIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvQjRTID0gVmFsdWUNCiAgICBnZXRnZW52KCkuQnJlYWt0aHJvdWdoRm9yU3RvcmFnZSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQ29udmVydCBCcmVha3Rocm91Z2ggZm9yIDUgQmFncyBPZiBQcmVzZW50cyIsIiIsZ2V0Z2VudigpLkF1dG9CNFAgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9CNFAgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5CcmVha3Rocm91Z2hGb3JQcmVzZW50KCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJDb252ZXJ0IEJyZWFrdGhyb3VnaCBmb3IgQ2FzaCBDYXBhY2l0eSIsIiIsZ2V0Z2VudigpLkF1dG9CNEMgb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9CNEMgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5CcmVha3Rocm91Z2hGb3JDYXBhY2l0eSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld0xhYmVsKCJBdXRvIFF1ZXN0cyAg8J+TiyIpOw0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gUGFycnkgRGFtYWdlIiwiIixnZXRnZW52KCkuQXV0b1BhcnJ5aW5nRGFtYWdlIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvUGFycnlpbmdEYW1hZ2UgPSBWYWx1ZQ0KICAgIGdldGdlbnYoKS5RdWVzdFBhcnJ5RGFtYWdlKCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIEJsb2NrIERhbWFnZSIsIiIsZ2V0Z2VudigpLkF1dG9CbG9ja2luZ0RhbWFnZSBvciBmYWxzZSxmdW5jdGlvbihWYWx1ZSkNCiAgICBnZXRnZW52KCkuQXV0b0Jsb2NraW5nRGFtYWdlID0gVmFsdWUNCiAgICBnZXRnZW52KCkuUXVlc3RCbG9ja0RhbWFnZSgpOw0KZW5kKQ0KDQpGYXJtaW5nVGFiLm5ld1RvZ2dsZSgiQXV0byBEZWF0aCBEYW1hZ2UiLCIiLGdldGdlbnYoKS5BdXRvRHlpbmdEYW1hZ2Ugb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9EeWluZ0RhbWFnZSA9IFZhbHVlDQogICAgZ2V0Z2VudigpLlF1ZXN0RGVhdGhEYW1hZ2UoKTsNCmVuZCkNCg0KRmFybWluZ1RhYi5uZXdUb2dnbGUoIkF1dG8gVGFrZSBEYW1hZ2UiLCIiLGdldGdlbnYoKS5BdXRvVGFraW5nRGFtYWdlIG9yIGZhbHNlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIGdldGdlbnYoKS5BdXRvVGFraW5nRGFtYWdlID0gVmFsdWUNCiAgICBnZXRnZW52KCkuUXVlc3RUYWtlRGFtYWdlKCk7DQplbmQpDQoNCkZhcm1pbmdUYWIubmV3VG9nZ2xlKCJBdXRvIERlYWwgRGFtYWdlIiwiIixnZXRnZW52KCkuQXV0b0RlYWxpbmdEYW1hZ2Ugb3IgZmFsc2UsZnVuY3Rpb24oVmFsdWUpDQogICAgZ2V0Z2VudigpLkF1dG9EZWFsaW5nRGFtYWdlID0gVmFsdWUNCiAgICBnZXRnZW52KCkuUXVlc3REZWFsRGFtYWdlKCk7DQplbmQpDQoNCmxvY2FsIEFyZWFzVGFiID0gRHJSYXlMaWJyYXJ5Lm5ld1RhYigiQXJlYXMiLCJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTY3MjM3NDI5NTIiKTsNCg0KZ2V0Z2VudigpLlBsYXlTb3VuZCA9IGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBQbGF5bGlzdCA9IHsiaHR0cDovL3d3dy5yb2Jsb3guY29tL2Fzc2V0Lz9pZD0yODk1NTY0NTAiLCJodHRwOi8vd3d3LnJvYmxveC5jb20vYXNzZXQvP2lkPTI2NDI5Njk4MTQifTsNCg0KICAgIGxvY2FsIFNvdW5kID0gSW5zdGFuY2UubmV3KCJTb3VuZCIpO1NvdW5kLk5hbWUgPSAiU291bmQiO1NvdW5kLlNvdW5kSWQgPSBQbGF5bGlzdFttYXRoLnJhbmRvbSgxLCNQbGF5bGlzdCldOw0KICAgIFNvdW5kLlZvbHVtZSA9IDU7U291bmQuTG9vcGVkID0gZmFsc2U7U291bmQuQXJjaGl2YWJsZSA9IGZhbHNlO1NvdW5kLlBhcmVudCA9IGdhbWUuV29ya3NwYWNlO1NvdW5kOlBsYXkoKTsNCmVuZA0KDQpBcmVhc1RhYi5uZXdMYWJlbCgiVGVsZXBvcnRzICAg8J+Xuu+4hDGkNzHvv4QxpDc3McKkNyAgKFlvdSBjYW4gVGVsZXBvcnQgcGVvcGxlIHdpdGggeW91LCBKdXN0IGdyYWIgdGhlbSBmaXJzdCkiKTsNCkFyZWFzVGFiLm5ld0J1dHRvbigiU2hvcCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05NTIyLjEzODY3MTg3NSwgODA1LjAwODA1NjY0MDYyNSwgOTAzOC4wMjM0Mzc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiQ2FmZSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05ODc5Ljg1OTM3NSwgODA1LjAwODMwMDc4MTI1LCA4NjkwLjcxMzg2NzE4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJCYXNrZXRiYWxsIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTEwMDk5LjU0MTAxNTYyNSwgODIwLjgxNTMwNzYxNzE4NzUsIDkyNDEuMjU5NzY1NjI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiVGhlIEZvcmVzdCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0xMDEyNS4wNDI5Njg3NSwgODM4LjE5NDE1MjgzMjAzMTIsIDg3NjEuMDU2NjQwNjI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiUGFyayIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05MjgwLjU5MDgyMDMxMjUsIDg0NC43ODE2NzcyNDYwOTM4LCA5MjIzLjQ1NjA1NDY4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJQYXJrIDIiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtOTE1My44NDU3MDMxMjUsIDgwNS4wNTIwMDE5NTMxMjUsIDg4MzMuOTg0Mzc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiU2hpbmUiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtOTgzOS45MDkxNzk2ODc1LCA4MjcuMjU3MjAyMTQ4NDM3NSwgOTM0Ni40Mjg3MTA5Mzc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRm9yYmlkZGVuIEdyb3ZlcyIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05MDE1LjMxMzQ3NjU2MjUsIDU3MS45OTkwMjM0Mzc1LCA3NTMzLjY4NTU0Njg3NSk7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkh1ZWNvIE11bmRvIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTkzMzAuMjM0MjM2NDIzOCw0MjguMjM1MjM1NzYsMTcyNS4yMzA1MjM2NzU5NTM1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiQWxsZXkiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtNTk2LjkzMDM1ODg4NjcxODgsLTMzLjAxNDk3NjUwMTQ2NDg0NCwxODk0LjQxODgyMzI0MjE4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJCaXJkIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLkVmZmVjdHM6RmluZEZpcnN0Q2hpbGQoIkJpcmQiKSB0aGVuDQogICAgICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikuRWZmZWN0czpGaW5kRmlyc3RDaGlsZCgiQmlyZCIpLlByaW1hcnlQYXJ0LkNGcmFtZTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIPCfjLgiLCJUaGUgYmlyZCBpcyBub3QgaGVyZSA6KCIsMSk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJTYWt1cmEgT2ZmaWNlIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTYzNy45ODk1NjI5ODgyODEyLDQuMTM1MDAwMjI4ODgxODM2LC0zMjUuOTQ4ODgzMDU2NjQwNik7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIlNlY3JldCBXYXRlcmZhbGwiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTI1NjYuNzY0NjQ4NDM3NSwgMzMyLjI0Njc5NTY1NDI5NjksIDg2NTEuNDYxOTE0MDYyNSk7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIlRoZSBCZWFjaCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05MzAwLjcyNTU4NTkzNzUsIDgyMC4zNzc1NjM0NzY1NjI1LCA5NTA0LjA2MzQ3NjU2MjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJCYXR0bGUgRmllbGQiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtOTI5MC41MDQ4ODI4MTI1LCA4MDUuMjc3NTg3ODkwNjI1LCA4OTY4LjYyNzkyOTY4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJMaWJyYXJ5IiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTUwLjg4MTE3NTk5NDg3MzA1LC0xMTYuMzY5NjA2MDE4MDY2NCwzNDQuNTM1OTQ5NzA3MDMxMjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJSdWluZWQgQ2l0eSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0xNzAuNTgzNTI2NjExMzI4MTIsIDc5MC43NjQ1MjYzNjcxODc1LCAtODAzNi45ODczMDQ2ODc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiV2hpdGUgUm9vbSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0zMC43ODc1NjE0MTY2MjU5NzcsLTIuMTE5MjcxNTE2Nzk5OTI2OCwxNTEwLjAyNDQxNDA2MjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJNaWRrbmlnaHQgQXJlbmEiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyg4OTAxLjI2NzU3ODEyNSwtMzcxLjA3ODIxNjU1MjczNDQsLTc2NTAuNjI5Mzk0NTMxMjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJQdlAgQXJlbmEiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldyg4NTUuNDI3MzA3MTI4OTA2MiwtMzk1LjA3NTU5MjA0MTAxNTYsLTc0OS44MjUyNTYzNDc2NTYyKTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiQW51YmlzIERpbWVuc2lvbiIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDM1MDUuNjI5ODgyODEyNSwtMzk5LjA4NTAyMTk3MjY1NjI1LDExNDQuMjgzMzI1MTk1MzEyNSk7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIlRlc3RpbmcgUGxhY2UiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTE4NS4yOTk5MjY3NTc4MTI1LCAtNzUuNTc1MzI1MDEyMjA3MDMsIC0yNzUuMDgwNDc0ODUzNTE1Nik7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVzcGFkYSBQbGFjZSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDYxMi45MjczNjgxNjQwNjI1LC02LjEyMzg2ODQ2NTQyMzU4NCwxNjkwLjg5MDAxNDY0ODQzNzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJTYW5pdHkgUm9vbSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDM0ODcuMDUzMjIyNjU2MjUsLTM3NC4wNzUyODY4NjUyMzQ0LDQ4NC4zNzc2NTUwMjkyOTY5KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiTmV3IE1hcCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05MzAwLjcyNTU4NTkzNzUsIDgyMC4zNzc1NjM0NzY1NjI1LCA5NTA0LjA2MzQ3NjU2MjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJSZWQgTWlzdCBSb29tIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTI0OC41NjY0ODI1NDM5NDUzLCA0Ni44NjkyMzU5OTI0MzE2NCwgLTI4ODkuOTEzMzMwMDc4MTI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRWx5c2lhIERvbWFpbiIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDE1NjY0LjIwODk4NDM3NSwtMzczLjAxMzI3NTE0NjQ4NDQsMjUyODcuMDgyMDMxMjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJEZXB0aHMiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gQ0ZyYW1lLm5ldygtMTIxMDMuMTIyMDcwMzEyNSwgMjYxLjI3MDk5NjA5Mzc1LCA5NjE4LjI1NjgzNTkzNzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJDYXZlIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTExMDcxLjg0NTcwMzEyNSwgNTM0LjI4MzAyMDAxOTUzMTIsIDg4MzUuMzY3MTg3NSk7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkhvbHkgR3JhaWwgV2FyIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoMzkzMi4zMDEyNjk1MzEyNSwtMjM0LjE2OTYxNjY5OTIxODc1LDQ1MzkuODA4MTA1NDY4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJFdGhyaXhMYW1lIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTIwMzYuNjk0NzAyMTQ4NDM3NSwtMzg2LjQwODc1MjQ0MTQwNjI1LC01MzU1Ljg1ODg4NjcxODc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiSGlnaGVzdCBQZWFrIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTEwOTU1LjMyNjE3MTg3NSwgNTgyLjUxNTYyNSwgODM2OC43NjU2MjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJIaWdoIFZpZXcgQ2l0eSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05NTIzLjY1NjI1LCAxMDgzLjU5NDk3MDcwMzEyNSwgOTAxOS4wODMwMDc4MTI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiQmFpa2VuIFBsYWNlIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTE0NDQ2LjkzMTY0MDYyNSwgLTMxLjkyNDc4NzUyMTM2MjMwNSwgLTM1NDcuMzc2NzA4OTg0Mzc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiV3V0aGVyaW5nIEhlaWdodCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC0zMDIzLjg4MTM0NzY1NjI1LCA0LjAwMDAzMDUxNzU3ODEyNSwgLTEwNTY3LjU0NDkyMTg3NSk7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkJpZyBSdWluZWQgQ2l0eSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KDM4OS44Mjc1NzU2ODM1OTM3NSwgODEwLjU5NjU1NzYxNzE4NzUsIC03OTEzLjIyMjE2Nzk2ODc1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiQmx1ZSBMb2NrIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoNzA5Ny41MzQxNzk2ODc1LCAyMDcuNjQxMDUyMjQ2MDkzNzUsIDMwMzQuOTg3NTQ4ODI4MTI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiVm9pZCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC05NDguMDE0NTI2MzY3MTg3NSwgOTI2Ljc1LCA0My4xNjg4NjUyMDM4NTc0Mik7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkJydW5pbmdIYWxsIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTI2MDIuODA1OTA4MjAzMTI1LCA2MzEuOTc1NTI0OTAyMzQzOCwgLTMzNTUuNzU2MTAzNTE1NjI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiUm9rYUxhYiIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgZ2V0Z2VudigpLlBsYXlTb3VuZCgpO2dhbWUuUGxheWVycy5Mb2NhbFBsYXllci5DaGFyYWN0ZXIuSHVtYW5vaWRSb290UGFydC5DRnJhbWUgPSBDRnJhbWUubmV3KC02MTIuMTgzNTkzNzUsIC0xMjAuMTI4NDk0MjYyNjk1MzEsIDIwODguNjQxODQ1NzAzMTI1KTsNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiV2FsbCBFeWVzIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTE4NDI2LjcwNTA3ODEyNSwgOTQ4LjE3ODE2MTYyMTA5MzgsIDcxOTMuNDA2MjUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJUdXNrIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBnZXRnZW52KCkuUGxheVNvdW5kKCk7Z2FtZS5QbGF5ZXJzLkxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LkNGcmFtZSA9IENGcmFtZS5uZXcoLTk0NzAuODA1NjY0MDYyNSwgODU5LjQ5NzE5MjM4MjgxMjUsIDkwMDQuMzI0MjE4NzUpOw0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3TGFiZWwoIk5QQyBUZWxlcG9ydHMgKyBJbnRlcmFjdGlvbnMgICDwn5OMIik7DQpsb2NhbCBTZWxlY3RlZE5wYyA9IG5pbA0KDQpsb2NhbCBUYWJsZSA9IHt9DQpmb3IgaSx2IGluIGlwYWlycyh3b3Jrc3BhY2UuTWFwLk5QQ3M6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICBpZiB2OklzQSgiTW9kZWwiKSB0aGVuDQogICAgICAgIHRhYmxlLmluc2VydChUYWJsZSx2Lk5hbWUpOw0KICAgIGVuZA0KZW5kDQoNCkFyZWFzVGFiLm5ld0Ryb3Bkb3duKCIiLCIiLFRhYmxlLGZ1bmN0aW9uKFZhbHVlKQ0KICAgIFNlbGVjdGVkTnBjID0gd29ya3NwYWNlLk1hcC5OUENzOkZpbmRGaXJzdENoaWxkKFZhbHVlKTsNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJUZWxlcG9ydCBUbyBOcGMiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGdldGdlbnYoKS5QbGF5U291bmQoKTtnYW1lLlBsYXllcnMuTG9jYWxQbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuQ0ZyYW1lID0gU2VsZWN0ZWROcGMuSHVtYW5vaWRSb290UGFydC5DRnJhbWU7DQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdMYWJlbCgiRXF1aXAgU3BlYyAobm90IHdvcmsgaWYgaGFkIG11bHRpcGxlIHNhbWUgc3BlYykiKTsNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJFcXVpcCBDcm9zcyIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgfj0gIkNyb3NzIiB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsMTAwMCBkbw0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIkNyb3NzIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg8J+MuCIsIllvdSBhcmUgQWxyZWFkeSBDcm9zcyIsMC41KTtlbmQpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRXF1aXAgT25lIGZvciBBbGwgW1N0YWdlIDRdIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSB+PSAiT25lIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsMzAwIGRvDQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlN0YW5kU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lclsiU2xvdCIuLmldLlRleHQuVGV4dCA9PSAiT25lIGZvciBBbGwgW1N0YWdlIDRdIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg77+EMaQ3Oe+/hDGkNzQiLCJZb3UgYXJlIEFscmVhZHkgdXNlIG9hIiwwLjUpO2VuZCk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJFcXVpcCBMdW5hdGljIiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSB+PSAiRW1wZXJvciB8IEx1bmF0aWMgUmVkIEV5ZXMiIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwzMDAgZG8NCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJFbXBlcm9yIHwgTHVuYXRpYyBSZWQgRXllcyIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IEx1bmF0aWMiLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVxdWlwIEFudWJpcyB8IE1hc3F1ZXJhZGUgTWVsdGRvd24iLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlIH49ICJBbnViaXMgfCBNYXNxdWVyYWRlIE1lbHRkb3duIiB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsMzAwIGRvDQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlN0YW5kU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lclsiU2xvdCIuLmldLlRleHQuVGV4dCA9PSAiQW51YmlzIHwgTWFzcXVlcmFkZSBNZWx0ZG93biIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IEFudWJpcyB8IE1hc3F1ZXJhZGUgTWVsdGRvd24iLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVxdWlwIENyb3NzIHwgQnV0dGVyZmxpZXMnIEZ1bmVyYWwiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlIH49ICJDcm9zcyB8IEJ1dHRlcmZsaWVzJyBGdW5lcmFsIiB0aGVuDQogICAgICAgICAgICBmb3IgaSA9IDEsMzAwIGRvDQogICAgICAgICAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyR3VpLlN0YW5kU3RvcmFnZS5PdXRlci5Jbm5lci5Jbm5lclsiU2xvdCIuLmldLlRleHQuVGV4dCA9PSAiQ3Jvc3MgfCBCdXR0ZXJmbGllcycgRnVuZXJhbCIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IENyb3NzIHwgQnV0dGVyZmxpZXMnIEZ1bmVyYWwiLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVxdWlwIE1ldGFsbGljYSB8IEZhY2VsZXNzIE9uZSIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgfj0gIk1ldGFsbGljYSB8IEZhY2VsZXNzIE9uZSIgdGhlbg0KICAgICAgICAgICAgZm9yIGkgPSAxLDMwMCBkbw0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIk1ldGFsbGljYSB8IEZhY2VsZXNzIE9uZSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IE1ldGFsbGljYSB8IEZhY2VsZXNzIE9uZSIsMC41KTtlbmQpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRXF1aXAgU3RvcCBTaWduIHwgSW5mZXJuYWwgQmFyZCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgfj0gIlN0b3AgU2lnbiB8IEluZmVybmFsIEJhcmQiIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwzMDAgZG8NCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJTdG9wIFNpZ24gfCBJbmZlcm5hbCBCYXJkIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg77+EMaQ3Oe+/hDGkNzQiLCJZb3UgYXJlIEFscmVhZHkgU3RvcCBTaWduIHwgSW5mZXJuYWwgQmFyZCIsMC41KTtlbmQpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRXF1aXAgQ295b3RlIFN0YXJrayIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgfj0gIkNveW90ZSBTdGFya2siIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwzMDAgZG8NCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJDb3lvdGUgU3RhcmtrIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg77+EMaQ3Oe+/hDGkNzQiLCJZb3UgYXJlIEFscmVhZHkgQ295b3RlIFN0YXJrayIsMC41KTtlbmQpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCkFyZWFzVGFiLm5ld0J1dHRvbigiRXF1aXAgVGhlIEFyYml0ZXIiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlIH49ICJUaGUgQXJiaXRlciIgdGhlbg0KICAgICAgICAgICAgZm9yIGkgPSAxLDMwMCBkbw0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIlRoZSBBcmJpdGVyIiB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGFyZ3MgPSB7IlNsb3QiLi5pfTsNCiAgICAgICAgICAgICAgICAgICAgaWYgaSA8PSA2IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlWyJTbG90Ii4uaV06RmlyZVNlcnZlcigpOw0KICAgICAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZS5Vc2VTdG9yYWdlRXh0cmE6RmlyZVNlcnZlcih1bnBhY2soYXJncykpOw0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKClCb3JlZExpYnJhcnkucHJvbXB0KCJTYWt1cmEgSHViICAg77+EMaQ3Oe+/hDGkNzQiLCJZb3UgYXJlIEFscmVhZHkgVGhlIEFyYml0ZXIiLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVxdWlwIEthaWp1IE5vLjggfCBLYWlqdSBvZiAxOTg3IiwiIixmdW5jdGlvbigpDQogICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5EYXRhLlN0YW5kTmFtZS5WYWx1ZSB+PSAiS2FpanUgTm8uOCB8IEthaWp1IG9mIDE5ODciIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwzMDAgZG8NCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJLYWlqdSBOby44IHwgS2FpanUgb2YgMTk4NyIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IEthaWp1IE5vLjggfCBLYWlqdSBvZiAxOTg3IiwwLjUpO2VuZCk7DQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZCkNCg0KQXJlYXNUYWIubmV3QnV0dG9uKCJFcXVpcCBTb3VsIE9mIENpbmRlcnMiLCIiLGZ1bmN0aW9uKCkNCiAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLkRhdGEuU3RhbmROYW1lLlZhbHVlIH49ICJTb3VsIE9mIENpbmRlcnMiIHRoZW4NCiAgICAgICAgICAgIGZvciBpID0gMSwzMDAgZG8NCiAgICAgICAgICAgICAgICBpZiBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJHdWkuU3RhbmRTdG9yYWdlLk91dGVyLklubmVyLklubmVyWyJTbG90Ii4uaV0uVGV4dC5UZXh0ID09ICJTb3VsIE9mIENpbmRlcnMiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJncyA9IHsiU2xvdCIuLml9Ow0KICAgICAgICAgICAgICAgICAgICBpZiBpIDw9IDYgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGVbIlNsb3QiLi5pXTpGaXJlU2VydmVyKCk7DQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKS5TdG9yYWdlUmVtb3RlLlVzZVN0b3JhZ2VFeHRyYTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSk7DQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKUJvcmVkTGlicmFyeS5wcm9tcHQoIlNha3VyYSBIdWIgICDvv4QxpDc577+EMaQ3NCIsIllvdSBhcmUgQWxyZWFkeSBTb3VsIE9mIENpbmRlcnMiLDAuNSk7ZW5kKTsNCiAgICAgICAgZW5kDQogICAgZW5kKQ0KZW5kKQ0KDQpBcmVhc1RhYi5uZXdCdXR0b24oIkVxdWlwIFdpbGQgSHVudCIsIiIsZnVuY3Rpb24oKQ0KICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgaWYgZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgfj0gIldpbGQgSHVudCIgdGhlbg0KICAgICAgICAgICAgZm9yIGkgPSAxLDMwMCBkbw0KICAgICAgICAgICAgICAgIGlmIGdhbWU6R2V0U2VydmljZSgiUGxheWVycyIpLkxvY2FsUGxheWVyLlBsYXllckd1aS5TdGFuZFN0b3JhZ2UuT3V0ZXIuSW5uZXIuSW5uZXJbIlNsb3QiLi5pXS5UZXh0LlRleHQgPT0gIldpbGQgSHVudCIgdGhlbg0KICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX07DQogICAgICAgICAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lOkdldFNlcnZpY2UoIlJlcGxpY2F0ZWRTdG9yYWdlIikuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpLlN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhOkZpcmVTZXJ2ZXIodW5wYWNrKGFyZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiAgIO+/hDGkNznvv4QxpDc0IiwiWW91IGFyZSBBbHJlYWR5IFdpbGQgSHVudCIsMC41KTtlbmQpOw0KICAgICAgICBlbmQNCiAgICBlbmQpDQplbmQpDQoNCi0tIC8vIEFwcGx5IEN1c3RvbSBUYWIgQ29sb3JzIFxcIC0tDQpsb2NhbCBUYWJzID0gew0KICAgIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5Lk1haW5CYXIuSG9tZTsNCiAgICBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5EclJheS5NYWluQmFyLlN0b3JhZ2U7DQogICAgZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikuRHJSYXkuTWFpbkJhci5TaG9wOw0KICAgIGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpLkRyUmF5Lk1haW5CYXIuRmFybWluZzsNCiAgICBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKS5EclJheS5NYWluQmFyLkFyZWFzOw0KfQ0KDQpmb3IgXyxrIGluIGlwYWlycyhUYWJzKSBkbw0KICAgIGZvciBfLHYgaW4gaXBhaXJzKGs6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgdi5OYW1lID09ICJMYWJlbCIgdGhlbg0KICAgICAgICAgICAgdi5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMC41NTsNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQNCg0KDQotLSBUcmFjayB0aGUgY3VycmVudCByYWluYm93IHRocmVhZCBzbyB3ZSBkb24ndCBkdXBsaWNhdGUgaXQNCmlmIGdldGdlbnYoKS5SYWluYm93VGhyZWFkIGFuZCBjb3JvdXRpbmUuc3RhdHVzKGdldGdlbnYoKS5SYWluYm93VGhyZWFkKSB+PSAiZGVhZCIgdGhlbg0KICAgIGNvcm91dGluZS5jbG9zZShnZXRnZW52KCkuUmFpbmJvd1RocmVhZCkNCmVuZA0KDQpnZXRnZW52KCkuVXNpbmdSYWluYm93VUkgPSBmdW5jdGlvbigpDQogICAgbG9jYWwgZ3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikNCiAgICBsb2NhbCB0b3BCYXIgPSBndWk6RmluZEZpcnN0Q2hpbGQoIkRyUmF5IikgYW5kIGd1aS5EclJheTpGaW5kRmlyc3RDaGlsZCgiVG9wQmFyIikNCiAgICBsb2NhbCBtYWluQmFyID0gZ3VpOkZpbmRGaXJzdENoaWxkKCJEclJheSIpIGFuZCBndWkuRHJSYXk6RmluZEZpcnN0Q2hpbGQoIk1haW5CYXIiKQ0KICAgIGxvY2FsIHN0YXRzRnJhbWUgPSBndWk6RmluZEZpcnN0Q2hpbGQoIlN0YXRpc3RpY3NHVUkiKSBhbmQgZ3VpLlN0YXRpc3RpY3NHVUk6RmluZEZpcnN0Q2hpbGQoIkZyYW1lIikNCg0KICAgIGxvY2FsIGZ1bmN0aW9uIHNldENvbG9yKGNvbG9yKQ0KICAgICAgICBpZiB0b3BCYXIgdGhlbg0KICAgICAgICAgICAgdG9wQmFyLkJhY2tncm91bmRDb2xvcjMgPSBjb2xvcg0KICAgICAgICAgICAgaWYgdG9wQmFyOkZpbmRGaXJzdENoaWxkKCJUb3BCYXIiKSB0aGVuDQogICAgICAgICAgICAgICAgdG9wQmFyLlRvcEJhci5CYWNrZ3JvdW5kQ29sb3IzID0gY29sb3INCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICAgICAgaWYgbWFpbkJhciB0aGVuDQogICAgICAgICAgICBtYWluQmFyLkJhY2tncm91bmRDb2xvcjMgPSBjb2xvcg0KICAgICAgICBlbmQNCiAgICAgICAgaWYgc3RhdHNGcmFtZSB0aGVuDQogICAgICAgICAgICBzdGF0c0ZyYW1lLkJhY2tncm91bmRDb2xvcjMgPSBjb2xvcg0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIC0tIElmIGRpc2FibGVkLCByZXNldCB0byBibGFjayBhbmQgZXhpdA0KICAgIGlmIG5vdCBnZXRnZW52KCkuQXV0b0dvaW5nUmFpbmJvdyB0aGVuDQogICAgICAgIHNldENvbG9yKENvbG9yMy5uZXcoMCwgMCwgMCkpDQogICAgICAgIHJldHVybg0KICAgIGVuZA0KDQogICAgLS0gU3RhcnQgdGhlIHJhaW5ib3cgbG9vcA0KICAgIGdldGdlbnYoKS5SYWluYm93VGhyZWFkID0gY29yb3V0aW5lLmNyZWF0ZShmdW5jdGlvbigpDQogICAgICAgIHdoaWxlIGdldGdlbnYoKS5BdXRvR29pbmdSYWluYm93IGRvDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgbG9jYWwgdCA9IHRpY2soKSAlIDENCiAgICAgICAgICAgICAgICBsb2NhbCByID0gbWF0aC5zaW4odCAqIDIgKiBtYXRoLnBpKSAqIDAuNSArIDAuNQ0KICAgICAgICAgICAgICAgIGxvY2FsIGcgPSBtYXRoLnNpbih0ICogMiAqIG1hdGgucGkgKyAyICogbWF0aC5waSAvIDMpICogMC41ICsgMC41DQogICAgICAgICAgICAgICAgbG9jYWwgYiA9IG1hdGguc2luKHQgKiAyICogbWF0aC5waSArIDQgKiBtYXRoLnBpIC8gMykgKiAwLjUgKyAwLjUNCg0KICAgICAgICAgICAgICAgIHNldENvbG9yKENvbG9yMy5uZXcociwgZywgYikpDQogICAgICAgICAgICBlbmQpDQogICAgICAgICAgICB0YXNrLndhaXQoMC4zNSkNCiAgICAgICAgZW5kDQogICAgICAgIHNldENvbG9yKENvbG9yMy5uZXcoMCwgMCwgMCkpIC0tIHJlc2V0IHdoZW4gbG9vcCBlbmRzDQogICAgZW5kKQ0KDQogICAgY29yb3V0aW5lLnJlc3VtZShnZXRnZW52KCkuUmFpbmJvd1RocmVhZCkNCmVuZA0KDQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikNCmxvY2FsIFJlcGxpY2F0ZWRTdG9yYWdlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSZXBsaWNhdGVkU3RvcmFnZSIpDQpsb2NhbCBMb2NhbFBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXINCg0KbG9jYWwgYXV0b1NjYW4gPSBmYWxzZQ0KbG9jYWwgc2NhbkludGVydmFsID0gNQ0KbG9jYWwgYXZhaWxhYmxlU3RhbmRzID0ge30NCmxvY2FsIHNlbGVjdGVkU3RhbmQgPSBuaWwNCmxvY2FsIGZpbHRlclRleHQgPSAiIg0KDQotLSBTYWZlIGdldCBTdGFuZFN0b3JhZ2UNCmxvY2FsIGZ1bmN0aW9uIGdldFN0YW5kU3RvcmFnZSgpDQogICAgbG9jYWwgZ3VpID0gTG9jYWxQbGF5ZXI6RmluZEZpcnN0Q2hpbGQoIlBsYXllckd1aSIpDQogICAgaWYgbm90IGd1aSB0aGVuIHJldHVybiBuaWwgZW5kDQogICAgbG9jYWwgb3V0ZXIgPSBndWk6RmluZEZpcnN0Q2hpbGQoIlN0YW5kU3RvcmFnZSIpIGFuZCBndWkuU3RhbmRTdG9yYWdlOkZpbmRGaXJzdENoaWxkKCJPdXRlciIpDQogICAgbG9jYWwgaW5uZXIgPSBvdXRlciBhbmQgb3V0ZXI6RmluZEZpcnN0Q2hpbGQoIklubmVyIikNCiAgICBpbm5lciA9IGlubmVyIGFuZCBpbm5lcjpGaW5kRmlyc3RDaGlsZCgiSW5uZXIiKQ0KICAgIHJldHVybiBpbm5lcg0KZW5kDQoNCi0tIFNjYW4gYXZhaWxhYmxlIHN0YW5kcw0KbG9jYWwgZnVuY3Rpb24gc2NhblN0YW5kU3RvcmFnZSgpDQogICAgbG9jYWwgY29udGFpbmVyID0gZ2V0U3RhbmRTdG9yYWdlKCkNCiAgICBpZiBub3QgY29udGFpbmVyIHRoZW4gcmV0dXJuIHt9IGVuZA0KICAgIGxvY2FsIGZvdW5kID0ge30NCiAgICBmb3IgaSA9IDEsMzAwIGRvDQogICAgICAgIGxvY2FsIHNsb3QgPSBjb250YWluZXI6RmluZEZpcnN0Q2hpbGQoIlNsb3QiLi5pKQ0KICAgICAgICBpZiBzbG90IGFuZCBzbG90OkZpbmRGaXJzdENoaWxkKCJUZXh0IikgYW5kIHNsb3QuVGV4dC5UZXh0IH49ICIiIHRoZW4NCiAgICAgICAgICAgIHRhYmxlLmluc2VydChmb3VuZCwge3Nsb3Q9c2xvdCwgbmFtZT0iU2xvdCIuLmksIHN0YW5kPXNsb3QuVGV4dC5UZXh0LCBpbmRleD1pfSkNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgcmV0dXJuIGZvdW5kDQplbmQNCg0KLS0gRGVkdXBsaWNhdGUNCmxvY2FsIGZ1bmN0aW9uIGRlZHVwZVN0YW5kcyhsaXN0KQ0KICAgIGxvY2FsIHNlZW4gPSB7fQ0KICAgIGxvY2FsIHJlc3VsdCA9IHt9DQogICAgZm9yIF8sIGUgaW4gaXBhaXJzKGxpc3QpIGRvDQogICAgICAgIGlmIG5vdCBzZWVuW2Uuc3RhbmRdIHRoZW4NCiAgICAgICAgICAgIHNlZW5bZS5zdGFuZF0gPSB0cnVlDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0LCBlKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4gcmVzdWx0DQplbmQNCg0KLS0gRXF1aXAgc2VsZWN0ZWQgc3RhbmQNCmxvY2FsIGZ1bmN0aW9uIGVxdWlwU3RhbmQoc3RhbmROYW1lKQ0KICAgIGlmIG5vdCBzdGFuZE5hbWUgdGhlbg0KICAgICAgICByZXR1cm4gZmFsc2UsICJObyBzdGFuZCBzZWxlY3RlZC4iDQogICAgZW5kDQogICAgaWYgTG9jYWxQbGF5ZXIuRGF0YS5TdGFuZE5hbWUuVmFsdWUgPT0gc3RhbmROYW1lIHRoZW4NCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgICAgICBwY2FsbChmdW5jdGlvbigpDQogICAgICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiIsICJZb3UgYXJlIEFscmVhZHkgVXNpbmcgSXQiLCAwLjUpDQogICAgICAgICAgICBlbmQpDQogICAgICAgIGVuZCkNCiAgICAgICAgcmV0dXJuIGZhbHNlLCAiQWxyZWFkeSBlcXVpcHBlZC4iDQogICAgZW5kDQoNCiAgICBsb2NhbCBjb250YWluZXIgPSBnZXRTdGFuZFN0b3JhZ2UoKQ0KICAgIGlmIG5vdCBjb250YWluZXIgdGhlbiByZXR1cm4gZmFsc2UsICJTdGFuZFN0b3JhZ2Ugbm90IGZvdW5kLiIgZW5kDQoNCiAgICBmb3IgaSA9IDEsMzAwIGRvDQogICAgICAgIGxvY2FsIHNsb3QgPSBjb250YWluZXI6RmluZEZpcnN0Q2hpbGQoIlNsb3QiLi5pKQ0KICAgICAgICBpZiBzbG90IGFuZCBzbG90OkZpbmRGaXJzdENoaWxkKCJUZXh0IikgYW5kIHNsb3QuVGV4dC5UZXh0ID09IHN0YW5kTmFtZSB0aGVuDQogICAgICAgICAgICBsb2NhbCBhcmdzID0geyJTbG90Ii4uaX0NCiAgICAgICAgICAgIGlmIGkgPD0gNiB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgb2ssIGVyciA9IHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRlZFN0b3JhZ2UuU3RvcmFnZVJlbW90ZVsiU2xvdCIuLmldOkZpcmVTZXJ2ZXIoKQ0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgICAgICBpZiBvayB0aGVuIHJldHVybiB0cnVlLCAiRmlyZWQgU3RvcmFnZVJlbW90ZSBTbG90Ii4uaSBlbmQNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBsb2NhbCBvaywgZXJyID0gcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGVkU3RvcmFnZS5TdG9yYWdlUmVtb3RlLlVzZVN0b3JhZ2VFeHRyYTpGaXJlU2VydmVyKHVucGFjayhhcmdzKSkNCiAgICAgICAgICAgICAgICBlbmQpDQogICAgICAgICAgICAgICAgaWYgb2sgdGhlbiByZXR1cm4gdHJ1ZSwgIkZpcmVkIFN0b3JhZ2VSZW1vdGUuVXNlU3RvcmFnZUV4dHJhIHdpdGggIi4uc3RhbmROYW1lIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KICAgIHJldHVybiBmYWxzZSwgIlN0YW5kIG5vdCBmb3VuZCBpbiBTdG9yYWdlLiINCmVuZA0KDQotLSBCdWlsZCBVSSAoYXR0YWNoZWQgdG8gQXJlYXNUYWIpDQpsb2NhbCBmdW5jdGlvbiByZWZyZXNoVUkoKQ0KICAgIGF2YWlsYWJsZVN0YW5kcyA9IGRlZHVwZVN0YW5kcyhzY2FuU3RhbmRTdG9yYWdlKCkpDQogICAgc2VsZWN0ZWRTdGFuZCA9IG5pbA0KDQogICAgaWYgdHlwZShBcmVhc1RhYi5DbGVhcikgPT0gImZ1bmN0aW9uIiB0aGVuIHBjYWxsKGZ1bmN0aW9uKCkgQXJlYXNUYWI6Q2xlYXIoKSBlbmQpIGVuZA0KDQogICAgQXJlYXNUYWIubmV3TGFiZWwoIlN0YW5kIFNjYW5uZXIiKQ0KICAgIEFyZWFzVGFiLm5ld0xhYmVsKCJVbmlxdWUgc3RhbmRzIGZvdW5kOiAiLi4jYXZhaWxhYmxlU3RhbmRzKQ0KDQogICAgaWYgI2F2YWlsYWJsZVN0YW5kcyA9PSAwIHRoZW4NCiAgICAgICAgQXJlYXNUYWIubmV3TGFiZWwoIk5vIHN0YW5kcyBhdmFpbGFibGUuIikNCiAgICBlbHNlDQogICAgICAgIGxvY2FsIG9wdGlvbnMgPSB7fQ0KICAgICAgICBmb3IgXywgZSBpbiBpcGFpcnMoYXZhaWxhYmxlU3RhbmRzKSBkbw0KICAgICAgICAgICAgaWYgZmlsdGVyVGV4dCA9PSAiIiBvciBzdHJpbmcuZmluZChzdHJpbmcubG93ZXIoZS5zdGFuZCksIHN0cmluZy5sb3dlcihmaWx0ZXJUZXh0KSwgMSwgdHJ1ZSkgdGhlbg0KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChvcHRpb25zLCBlLnN0YW5kKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICBBcmVhc1RhYi5uZXdEcm9wZG93bigiQXZhaWxhYmxlIFN0YW5kcyIsICJTZWxlY3QgYSBzdGFuZCB0byBlcXVpcCIsIG9wdGlvbnMsIGZ1bmN0aW9uKGNob2ljZSkNCiAgICAgICAgICAgIHNlbGVjdGVkU3RhbmQgPSBjaG9pY2UNCiAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiIsICJTZWxlY3RlZDogIi4uY2hvaWNlLCAxKQ0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgZW5kKQ0KICAgIGVuZA0KDQogICAgQXJlYXNUYWIubmV3QnV0dG9uKCJFcXVpcCBTZWxlY3RlZCBTdGFuZCIsICJFcXVpcCB0aGUgc2VsZWN0ZWQgc3RhbmQiLCBmdW5jdGlvbigpDQogICAgICAgIGlmIG5vdCBzZWxlY3RlZFN0YW5kIHRoZW4NCiAgICAgICAgICAgIHRhc2suc3Bhd24oZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgIHBjYWxsKGZ1bmN0aW9uKCkNCiAgICAgICAgICAgICAgICAgICAgQm9yZWRMaWJyYXJ5LnByb21wdCgiU2FrdXJhIEh1YiIsICJObyBzdGFuZCBzZWxlY3RlZC4iLCAxKQ0KICAgICAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIGVuZCkNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBlbmQNCiAgICAgICAgdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgICAgICAgICBsb2NhbCBvaywgbXNnID0gZXF1aXBTdGFuZChzZWxlY3RlZFN0YW5kKQ0KICAgICAgICAgICAgbm90aWZ5KCJFcXVpcCBTdGFuZCIsIG1zZywgMikNCiAgICAgICAgZW5kKQ0KICAgIGVuZCkNCg0KICAgIEFyZWFzVGFiLm5ld0J1dHRvbigiUmVmcmVzaCIsICJSZXNjYW4gU3RhbmRTdG9yYWdlIiwgZnVuY3Rpb24oKQ0KICAgICAgICByZWZyZXNoVUkoKQ0KICAgIGVuZCkNCg0KICAgIEFyZWFzVGFiLm5ld1RvZ2dsZSgiQXV0byBTY2FuIiwgIkF1dG9tYXRpY2FsbHkgcmVmcmVzaCBldmVyeSAiLi5zY2FuSW50ZXJ2YWwuLiIgc2Vjb25kcyIsIGF1dG9TY2FuLCBmdW5jdGlvbihzdGF0ZSkNCiAgICAgICAgYXV0b1NjYW4gPSBzdGF0ZQ0KICAgIGVuZCkNCmVuZA0KDQotLSBTaW1wbGUgbm90aWZ5IHdyYXBwZXINCmZ1bmN0aW9uIG5vdGlmeSh0aXRsZSwgbXNnLCBkdXJhdGlvbikNCiAgICBkdXJhdGlvbiA9IGR1cmF0aW9uIG9yIDMNCiAgICBpZiByYXdnZXQoX0csIkJvcmVkTGlicmFyeSIpIGFuZCB0eXBlKF9HLkJvcmVkTGlicmFyeS5wcm9tcHQpID09ICJmdW5jdGlvbiIgdGhlbg0KICAgICAgICBwY2FsbChmdW5jdGlvbigpIF9HLkJvcmVkTGlicmFyeS5wcm9tcHQodGl0bGUsIG1zZywgZHVyYXRpb24pIGVuZCkNCiAgICBlbHNlDQogICAgICAgIHByaW50KCJbIi4udGl0bGUuLiJdICIuLm1zZykNCiAgICBlbmQNCmVuZA0KDQotLSBJbml0aWFsIFVJIGJ1aWxkDQpyZWZyZXNoVUkoKQ0KDQotLSBBdXRvLXNjYW4gbG9vcA0KdGFzay5zcGF3bihmdW5jdGlvbigpDQogICAgd2hpbGUgdHJ1ZSBkbw0KICAgICAgICB0YXNrLndhaXQoc2NhbkludGVydmFsKQ0KICAgICAgICBpZiBhdXRvU2NhbiB0aGVuDQogICAgICAgICAgICBwY2FsbChyZWZyZXNoVUkpDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kKQ0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg==]]
local function base64decode(data)
  local b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'
  data = string.gsub(data, '[^'..b..'=]', '')
  return (data:gsub('.', function(x)
    if x == '=' then return '' end
    local r,f='',(b:find(x)-1)
    for i=6,1,-1 do
      r = r .. (math.floor(f/2^(i-1)) % 2 == 1 and '1' or '0')
    end
    return r
  end):gsub('%d%d%d%d%d%d%d%d', function(x)
    local c=0
    for i=1,8 do
      c = c + (x:sub(i,i) == '1' and 2^(8-i) or 0)
    end
    return string.char(c)
  end))
end

local decoded = base64decode(_b)
local ok, res = pcall(function()
  local f,err = loadstring(decoded)
  if not f then error(err) end
  return f()
end)
if not ok then error(res) end
